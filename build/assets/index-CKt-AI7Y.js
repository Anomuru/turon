import{u as E,r as c,j as n,ah as H,d as J,h as w,A as $,i as K,ai as Y,o as N,n as B,a as P,aj as U,D as W,ak as z,al as G,am as Q,an as X}from"./index-DJEj1NQv.js";import{C as Z}from"./confirmModal-DZpNvp7H.js";const ee="_calendarList_1mi5e_1",te={calendarList:ee},se=i=>{const{setActive:u,currentData:I,loading:A,data:S,onSubmit:L,isChanged:m,setIsChanged:a}=i,{request:g}=w(),C=E(),[y,j]=c.useState([]),[x,f]=c.useState(!1),[b,s]=c.useState(null),p=()=>{g(`${$}Calendar/delete-type/`,"DELETE",JSON.stringify({days:b}),K()).then(e=>{C(Y(e)),C(N({type:"success",status:!0,msg:`${e.length>1?"Kunlar":"Kun"} o'chirildi`})),f(!1)}).catch(e=>console.log(e))},D=e=>{s(e),f(!0)};c.useEffect(()=>{m?(j([]),a(!1)):y.length&&u(e=>({...e,days:y}))},[m,y]);const O=(e,t,h,r,o)=>{let l=h.map((d,R)=>{if(d.startId&&!d?.finishId){const _=d.startId<e?d.startId:e,k=d.startId<e?e:d.startId;return u(V=>({...V,finishValue:t,startId:_,finishId:k})),{startId:_,finishId:k}}else return!d?.startId&&h[R-1]?.finishId!==e?{startId:e}:d});const v=l[l.length-1].startId&&l[l.length-1].finishId?[...l,{}]:l;r(v),o([])};function T(e,t){let h=[...e].sort(q),r=0,o=[],l=[];const v=h.length+t<=35?35:42;for(;r<v;)r<t?o.push(""):r-t<h.length?o.push({id:h[r-t],value:h[r-t]}):o.push(""),o.length===7&&(l.push(o),o=[]),r=r+1;return l}function q(e,t){return e.id-t.id}const F=c.useCallback(()=>S&&[...S].map((e,t)=>n.jsx(H,{month:t,setActive:u,data:e.months,onActiveDays:O,sortWeeksDays:T,currentData:I.id===t?I:{},setSelected:j,onSubmit:L,isChanged:m,setIsChanged:a,onSubmitDelete:D},t)),[I,S]),M=A?n.jsx(J,{}):F();return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:te.calendarList,children:M}),n.jsx(Z,{type:"danger",active:x,setActive:f,onClick:p})]})},ae=i=>i.calendarSlice?.data,ne=i=>i.calendarSlice?.loading,re="_calendarPage_1oety_1",le={calendarPage:re},ce={calendarSlice:z},ie=()=>{const{request:i}=w(),u=E(),{register:I,handleSubmit:A,setValue:S}=B(),L=P(ae),m=P(ne),[a,g]=c.useState({}),[C,y]=c.useState({}),[j,x]=c.useState(!1),f=new Date().getFullYear(),b=s=>{let p;y({...s,...a,color:s?.color??"black"}),a?.length?p={...s,days:a,color:s?.color??"black"}:a?.selected?.length?p={...s,days:a?.selected,color:s?.color??"black"}:p={...s,...a,color:s?.color??"black"},i(`${$}Calendar/change-type/`,"POST",JSON.stringify(p),K()).then(D=>{u(X(D)),u(N({type:"success",status:!0,msg:`${D.length>1?"Kunlar":"Kun"} qo'shildi`}))}).catch(D=>console.log(D)),g({}),x(!0)};return c.useEffect(()=>{u(U({current_year:f,next_year:f+1}))},[]),n.jsx(W,{reducers:ce,children:n.jsxs("div",{className:le.calendarPage,children:[n.jsx(G,{}),n.jsx(se,{setActive:g,currentData:C,loading:m,data:L,onSubmit:g,onDelete:s=>s([{}]),isChanged:j,setIsChanged:x}),n.jsx(Q,{active:a?.finishValue||a?.length,setActive:g,onSubmit:A(b),register:I,setValue:S,success:C})]})})};export{ie as CalendarPage};
