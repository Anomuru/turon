import{u as v,a as d,g as D,b as N,r as l,f as F,c as A,d as H,e as B,j as n,D as E,h as O,P as T,B as y,F as G,i as R,A as q,k as z,o as J}from"./index-B1KXs2zi.js";import{g as M}from"./searchSelector-CJfw-E7m.js";const U="_flow_14ck2_1",V="_flowListHeader_14ck2_4",$="_table__footer_14ck2_24",K="_active_14ck2_31",Q="_table__btn_14ck2_35",c={flow:U,flowListHeader:V,table__footer:$,active:K,table__btn:Q},ss=()=>{const{request:x}=R(),i=v(),u=d(D)?.id,L=N();l.useEffect(()=>{u&&(i(F()),i(A({userBranchId:u})))},[u]);const g=d(H),k=d(B),b=d(M);let p=l.useMemo(()=>50,[]);const[S,f]=l.useState([]),[h,w]=l.useState(1),[o,_]=l.useState([]),C=l.useMemo(()=>{const t=g?.slice();return w(1),b?t.filter(a=>a.name?.toLowerCase().includes(b.toLowerCase())):t},[g]),j=t=>{f(a=>a.map(e=>e?.id===+t?e.isCheck?(_(s=>s.filter(r=>r?.classId!==e?.id)),{isCheck:!1,id:e.id,students:e.students.map(s=>({...s,isCheck:!1,id:s.id})),class_number:e.class_number,color:e.color}):(_(s=>s.filter(r=>r?.classId===e?.id)[0]?[...s.filter(r=>r?.classId!==e.id),{classId:e?.id,students:e?.students?.map(r=>r?.id)}]:[...s,{classId:e?.id,students:e?.students?.map(r=>r?.id)}]),{isCheck:!0,id:e.id,students:e.students.map(s=>({...s,isCheck:!0,id:s.id})),class_number:e.class_number,color:e.color}):e))},m=(t,a)=>{_(e=>e.filter(s=>s?.classId===+a)[0]?e.map(s=>{if(s?.classId===a)return{classId:s?.classId,students:s?.students.includes(+t)?s.students.filter(r=>r!==+t):[...s.students,+t]}}):[...e,{classId:+a,students:[+t]}])};l.useEffect(()=>{f(t=>t.map(a=>{const e=o.filter(s=>s?.classId===a.id)[0];return e?{isCheck:e?.students?.length===a.students.length,id:a.id,students:a.students.map(s=>e?.students?.includes(s.id)?{...s,isCheck:!0,id:s.id}:{...s,isCheck:!1,id:s.id}),class_number:a.class_number,color:a.color}:a}))},[o,h]);const I=()=>{let t=[];o.map(s=>{s?.students?.map(r=>t.push(r))});const a=localStorage.getItem("flowData"),e={...JSON.parse(a),students:t,classes:[]};x(`${q}Flow/flow-list-create/`,"POST",JSON.stringify(e),z()).then(s=>{i(J({type:"success",msg:s.msg,status:!0})),localStorage.removeItem("flowData")}).then(()=>{L(-2)})},P=S.map((t,a)=>n.jsx(G,{currentPage:h,flowList:t,onChangeAll:j,onChangeSingle:m,number:a},a));return n.jsxs("div",{className:c.flow,children:[n.jsx("div",{className:c.flowListHeader,children:n.jsxs("div",{children:[n.jsx("span",{children:"No"}),n.jsx("span",{children:"Sinf Raqami"})]})}),k?n.jsx(E,{}):n.jsxs("div",{className:c.table,children:[n.jsx("div",{children:P}),n.jsxs("div",{className:O(c.table__footer,{[c.active]:p<=C.length}),children:[n.jsx(T,{setCurrentTableData:f,users:C,currentPage:h,pageSize:p,onPageChange:t=>{w(t)}}),n.jsx(y,{extraClass:c.table__btn,onClick:I,type:o.filter(t=>t?.students?.length>0)[0]?"":"disabled",disabled:o.filter(t=>t?.students?.length>0)[0]?"":"disabled",children:"Create"})]})]})]})};export{ss as FlowListPage};
