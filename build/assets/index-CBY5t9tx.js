import{b as H,n as $,r as o,u as T,j as e,B as v,T as O,d as z,z as y,I as q,F as L,S as P,ad as V,a as _,g as B,ae as U,af as G,D as J,h as K,A as Q,i as W,ag as X}from"./index-D6a-L2Nf.js";import{a as Y,F as Z,b as ee}from"./flowsSlice-DNMv6eIQ.js";import{g as R,a as se,b as te,f as ae,c as le,d as oe,e as de,h as ne}from"./index-D1ABK5Oh.js";import{P as re}from"./pagination-BdhDfYIy.js";import{g as ce}from"./searchSelector-B3qtoac4.js";import"./groupProfileRating-BU8gajPE.js";import{g as ie}from"./groupTimeTableForm-CM1rZlWy.js";import"./teachers-BCgOOOqv.js";import"./editableCard-6FckkYw6.js";import"./groupsList-BWXVSWn9.js";import"./confirmModal-BQZtw_hD.js";import"./teachingTeacher-CnoExvDG.js";import"./alert-BnIk75ig.js";import"./roomsSelectors-BrI_i2qA.js";const ue="_flow_f432b_1",fe="_flowMain_f432b_8",_e="_flowMain__wrapper_f432b_13",he="_flowMain__table_f432b_16",me="_flow__header_f432b_20",xe="_flow__filter_f432b_28",we="_modal_f432b_62",je="_flowModal_f432b_66",be="_flowModalHeader_f432b_69",pe="_flowModalForm_f432b_74",i={flow:ue,flowMain:fe,flowMain__wrapper:_e,flowMain__table:he,flow__header:me,flow__filter:xe,modal:we,flowModal:je,flowModalHeader:be,flowModalForm:pe},Fe=({currentTableData:N,teacherData:b,loading:p,levelData:h,getLevelData:k,setActive:m,branchId:S})=>{const u=H(),{register:n,handleSubmit:w,setValue:I}=$(),[f,C]=o.useState(!1),[F,M]=o.useState(!1),[j,A]=o.useState(!1),[d,x]=o.useState([]);T();const[r,E]=o.useState(!1),D=t=>{const s={...t,activity:r,branch:S};localStorage.setItem("flowData",JSON.stringify(s)),u("flow-list")};o.useEffect(()=>{d&&I("subject",d[0]?.id)},[d]);const l=()=>N?.map((t,s)=>e.jsxs("tr",{onClick:()=>u(`./flowsProfile/${t?.id}`),children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:t?.name}),e.jsxs("td",{children:[t?.subject_name,t?.level_name?` / ${t?.level_name}`:null]}),e.jsx("td",{children:t?.student_count}),e.jsx("td",{children:`${t?.teacher_name} ${t?.teacher_surname}`})]}));return e.jsxs("div",{className:i.flowMain,children:[e.jsxs("div",{className:i.flow__filter,children:[e.jsx(v,{onClick:()=>A(!j),type:"simple-add",children:"Filter"}),e.jsxs("div",{className:i.flowMain__wrapper,children:[e.jsx(v,{onClick:()=>C(!f),type:"simple",children:"Create Flow"}),e.jsx(v,{type:"simple-add",onClick:()=>m(!0),children:"Add Flow"})]})]}),e.jsx("div",{className:i.flowMain__table,children:e.jsxs(O,{children:[e.jsx("thead",{style:{top:"0"},children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Nomi"}),e.jsx("th",{children:"Fan Level"}),e.jsx("th",{children:"O'quvchi soni"}),e.jsx("th",{children:"O'qituvchisi"})]})}),p==="loading"?e.jsx(z,{}):e.jsx("tbody",{children:l()})]})}),e.jsxs(y,{active:f,setActive:C,extraClass:i.modal,children:[e.jsx("h2",{children:"Create Flow"}),e.jsxs("div",{className:i.flowModal,children:[e.jsxs("div",{className:i.flowModalHeader,children:[e.jsx("h3",{children:"Activity"}),e.jsx(q,{onChange:()=>E(!r),type:"checkbox"})]}),e.jsx("div",{className:i.flowModalForm,children:e.jsxs(L,{typeSubmit:"",onSubmit:w(D),action:"",children:[e.jsx(q,{placeholder:"Nomi",register:n,name:"name",required:!0}),r?null:e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"O'qituvchini tanlang",options:b,onChangeOption:t=>{t&&k(t),x(b.filter(s=>s.id===+t)[0]?.subject)},register:n,name:"teacher"}),d?.length?e.jsx(P,{title:"Fan",options:d,register:n,name:"subject",defaultValue:d[0]?.id}):null,h?.length?e.jsx(P,{title:"Level",options:h,register:n,name:"level"}):null,e.jsx(V,{placeholder:"Koment",register:n,name:"comment"})]}),e.jsx(v,{children:"Next"})]})})]})]}),e.jsxs(y,{active:F,setActive:M,children:[e.jsx("h2",{children:"Add Flow"}),e.jsx("div",{className:i.flowModalForm,children:e.jsxs(L,{typeSubmit:"",children:[e.jsx(P,{}),e.jsx(v,{type:"simple",children:"Add"})]})})]}),e.jsx(Y,{active:j,setActive:A})]})},Me="_addForm_1tbfl_1",ge="_addForm__btn_1tbfl_7",ve="_addModal_1tbfl_12",Se="_addModal__header_1tbfl_21",Ce="_addModal__inner_1tbfl_31",Ae="_addModal__container_1tbfl_37",Ne="_addModal__btn_1tbfl_95",g={addForm:Me,addForm__btn:ge,addModal:ve,addModal__header:Se,addModal__inner:Ce,addModal__container:Ae,addModal__btn:Ne},ke=o.memo(N=>{const{active:b,setActive:p}=N,h=T(),{register:k,handleSubmit:m}=$(),S=_(R),u=_(se),n=_(B),w=_(te);console.log(w,"filteredStudents");const[I,f]=o.useState([]),[C,F]=o.useState(!1),[M,j]=o.useState([]);o.useEffect(()=>{w&&f(w)},[w]),o.useEffect(()=>{n&&u&&h(ae({flow:u?.id,branch:n,res:{ignore_students:u?.students.map(l=>l?.id)}}))},[n,u]);const A=l=>{h(le({id:l?.flow})),F(!0)},d=()=>{let l=[];M.map(s=>{s?.students?.map(a=>l.push(a))});const t={update_type:"add_students",students:l};h(oe({id:u?.id,res:t}))},x=l=>{f(t=>t.map(s=>s.id===+l?s.isCheck?(j(a=>a.filter(c=>c.classId!==s.id)),{isCheck:!1,id:s.id,students:s.students.map(a=>({isCheck:!1,id:a.id,extra_info:a.extra_info,user:a.user})),class_number:s.class_number,color:s.color}):(j(a=>a.filter(c=>c.classId===s.id)[0]?[...a.filter(c=>c.classId!==s.id),{classId:s.id,students:s?.students?.map(c=>c?.id)}]:[...a,{classId:s.id,students:s?.students?.map(c=>c?.id)}]),{isCheck:!0,id:s.id,students:s.students.map(a=>({isCheck:!0,id:a.id,extra_info:a.extra_info,user:a.user})),class_number:s.class_number,color:s.color}):s))},r=(l,t)=>{j(s=>s.filter(a=>a?.classId===+t)[0]?s.map(a=>{if(a?.classId===t)return{classId:a.classId,students:a.students.includes(+l)?a.students.filter(c=>c!==+l):[...a.students,+l]}}):[...s,{classId:+t,students:[+l]}])};o.useEffect(()=>{f(l=>l.map(t=>{const s=M.filter(a=>a?.classId===t.id)[0];return s?{isCheck:s?.students?.length===t.students.length,id:t.id,students:t.students.map(a=>s?.students?.includes(a.id)?{isCheck:!0,id:a.id,extra_info:a.extra_info,user:a.user}:{isCheck:!1,id:a.id,extra_info:a.extra_info,user:a.user}),class_number:t.class_number,color:t.color}:t}))},[M]);const D=I.map((l,t)=>e.jsx(Z,{flowList:l,onChangeAll:x,onChangeSingle:r,number:t},t));return e.jsxs(e.Fragment,{children:[e.jsx(y,{active:b,setActive:p,children:e.jsxs(L,{extraClassname:g.addForm,onSubmit:m(A),typeSubmit:"",children:[e.jsx("h2",{children:"Add Flow"}),e.jsx(P,{options:S,register:k,title:"Patok",name:"flow"}),e.jsx(v,{extraClass:g.addForm__btn,children:"Tekshirmoq"})]})}),e.jsxs(y,{active:C,setActive:F,extraClass:g.addModal,children:[e.jsx("div",{className:g.addModal__header,children:e.jsxs("div",{className:g.addModal__inner,children:[e.jsx("span",{children:"No"}),e.jsx("span",{children:"Sinf Raqami"})]})}),e.jsx("div",{className:g.addModal__container,children:D}),e.jsx(v,{extraClass:g.addModal__btn,onClick:d,children:"Add"})]})]})}),Ie={flowsSlice:ee,flowsProfileSlice:ne},Ue=()=>{const{request:N}=K(),b=T(),p=_(ce),h=_(R),k=_(de),m=_(B),S=_(U),u=_(ie),[n,w]=o.useState([]),[I,f]=o.useState(1),[C,F]=o.useState(!1);let M=o.useMemo(()=>50,[]);const j=o.useMemo(()=>{const d=h?.filter(x=>!x.deleted)||[];return f(1),p?d.filter(x=>x?.name?.toLowerCase().includes(p.toLowerCase())):d},[h,p]);o.useEffect(()=>{m&&b(G(m))},[m]);const A=d=>{const x=S.filter(r=>r.id===+d)[0]?.subject[0]?.id;N(`${Q}Subjects/level-for-subject/${x}/`,"GET",null,W()).then(r=>{b(X(r))}).catch(r=>console.log(r))};return e.jsx(J,{reducers:Ie,children:e.jsxs("div",{className:i.flow,children:[e.jsx("div",{className:i.flow__header}),e.jsx(Fe,{branchId:m,currentTableData:n,loading:k,teacherData:S,levelData:u,getLevelData:A,setActive:F}),e.jsx(re,{setCurrentTableData:w,users:j,setCurrentPage:f,currentPage:I,pageSize:M,onPageChange:d=>{f(d)},type:"custom"}),e.jsx(ke,{userBranchId:m,active:C,setActive:F})]})})};export{Ue as FlowsPage};
