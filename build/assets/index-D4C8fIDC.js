import{r as s,l as B,n,j as e,T as de,B as ie,D as N,I as R,u as ue,A as me,h as _e,f as he,J as ge,o as pe,K as Se,p as v}from"./index-Cux8sda1.js";import{C as fe}from"./classAddForm-MVg7oxld.js";import{l as xe,m as Ce,a as je,g as be,i as ye,n as we,o as ve,p as De,N as Ne}from"./studentsSelector-TVQxHXsm.js";import{o as Le}from"./alertSlice-XeBTN8B3.js";import"./index-Dyh4sQR2.js";import{M as J}from"./modal-BR27MEf1.js";import{d as z,e as Fe,c as Pe,l as Me}from"./studentsSlice-JQcNq_2O.js";import{P as Te}from"./pagination-Cj0p_t2O.js";import"./workerSelect-N9ju4zO7.js";import"./teacherParseSlice-z7KSx3F7.js";import"./teacherThunk-qU_2Y3xX.js";import"./filterRoomsSlice-ClpK4_Fa.js";import{F as Oe}from"./form-C3mZZqBW.js";import"./textArea-1604NtUh.js";import"./editableCard-BNSd-vHU.js";import"./index-CO9axSa1.js";import{d as qe,e as ke,h as Ae,i as Ie,j as Ee,f as Be,k as Re,l as Je}from"./oftenUsedSelector-B4R2CTqR.js";import{S as ze,D as He,a as Ue}from"./studentsHeader-DqsMjGKi.js";import{getSearchValue as $e}from"./index-Dvh1lTlU.js";import{u as Ge}from"./index.esm-DQmSsb0O.js";import{R as Ke}from"./radio-c1ywR2KC.js";import{StudentsFilter as Ve}from"./index-BHfqywPW.js";import{M as Ye}from"./MultiPage-CgDPt1S_.js";import"./user_image-CruVt77w.js";import"./confirmModal-DiNALKc8.js";import"./groupsAttendanceSlice-DmRNDpcI.js";import"./userProfileSlice-BflEK4KO.js";import"./index-B-IQsIPc.js";import"./roomsSelectors-Dutms6Wd.js";import"./switch-sjHY-EbU.js";import"./cross-BXlnQeE0.js";import"./Transition-CosWKtpf.js";import"./room_image-CsXp1EfD.js";import"./filters.module-C8GjSCwu.js";import"./link-B95gzaLk.js";import"./multiPageSlice-CecU3CKU.js";import"./index-sxu4Z6A5.js";const Qe="_createClass_s3igw_1",We="_createClass__input_s3igw_6",Xe="_createClass__btn_s3igw_9",Ze="_createClass__inner_s3igw_13",D={createClass:Qe,createClass__input:We,createClass__btn:Xe,createClass__inner:Ze},et=s.memo(u=>{const{active:o,setActive:S,data:m,branch:L,deactiveModal:f}=u,{request:F}=ue(),a=B(),i=n(xe),_=n(Ce),[h,C]=s.useState([]);s.useEffect(()=>{C([])},[i]);const P=()=>{const r={...m,students:h};F(`${me}Group/groups/create/`,"POST",JSON.stringify(r),_e()).then(x=>{a(Le({type:"success",status:!0,msg:"Sinf yaratildi"})),a(z({userBranchId:L})),S(!1),f(!1)})},j=_==="loading"||_==="idle"?e.jsx(N,{}):i?.map((r,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:x+1}),e.jsxs("td",{children:[r.user?.surname," ",r.user?.name]}),e.jsx("td",{children:r.user?.age}),e.jsx("td",{children:r.user?.language}),e.jsx("td",{children:r?.class_number}),e.jsx("td",{children:r.user?.registered_date}),e.jsx("td",{children:e.jsx(R,{extraClassName:D.createClass__input,type:"checkbox",onChange:()=>C(g=>g.filter(p=>p===r.id)[0]?g.filter(p=>p!==r.id):[...g,r.id])})})]}));return e.jsx(J,{active:o,setActive:S,children:e.jsxs("div",{className:D.createClass,children:[e.jsx("h1",{children:"O'quvchi tanlang"}),e.jsx("div",{className:D.createClass__inner,children:e.jsxs(de,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"â„–"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:j})]})}),e.jsx(ie,{onClick:P,extraClass:D.createClass__btn,children:"Create"})]})})}),tt=(u,o)=>{localStorage.setItem(u,o)},st=u=>localStorage.getItem(u),at="_tableMain_c2dxc_1",nt="_modal_c2dxc_16",rt="_modal__error_c2dxc_21",ot="_modal__form_c2dxc_26",ct="_modal__select_c2dxc_31",lt="_modal__radios_c2dxc_34",dt="_modal__inner_c2dxc_40",it="_modal__item_c2dxc_46",ut="_modal__input_c2dxc_49",c={tableMain:at,modal:nt,modal__error:rt,modal__form:ot,modal__select:ct,modal__radios:lt,modal__inner:dt,modal__item:it,modal__input:ut},E=[{name:"new_students",label:"New Students"},{name:"studying_students",label:"Studying Students"},{name:"deleted_students",label:"Deleted Students"}],Xt=()=>{const{theme:u}=he(),o=B(),[S]=ge(),{register:m,handleSubmit:L}=Ge(),f=JSON.parse(localStorage.getItem("selectedSystem")),{id:F}=n(pe),a=F,i=n($e),_=n(qe),h=n(ke),C=n(Ae),P=n(Ie),M=n(je),j=n(be),r=n(ye),x=n(we),g=n(ve),p=n(De),[mt,_t]=s.useState(null),[l,q]=s.useState(st("selectedRadio")||E[0].name),[H,U]=s.useState({}),[T,$]=s.useState(),[G,k]=s.useState(!1),[K,V]=s.useState(),[A,b]=s.useState(!1),[I,y]=s.useState(""),[Y,Q]=s.useState(""),[w,W]=s.useState([]),[X,O]=s.useState(1),[Z,ee]=s.useState(!0),te=n(Se);let se=s.useMemo(()=>50,[]);const ae=s.useMemo(()=>{let t=[];switch(l){case"new_students":t=j?.slice();break;case"studying_students":t=M?.slice();break;case"deleted_students":t=r?.slice();break;default:t=[]}return O(1),i?t.filter(d=>d.user?.name?.toLowerCase().includes(i.toLowerCase())||d.user?.surname?.toLowerCase().includes(i.toLowerCase())||d?.student?.user?.name.toLowerCase().includes(i.toLowerCase())||d?.student?.user?.surname.toLowerCase().includes(i.toLowerCase())):t},[j,M,r,i,l,Y]);s.useEffect(()=>{a&&(o(Ee(a)),o(Be()))},[a]),s.useEffect(()=>{f?.name==="school"&&a&&(o(Re()),o(Je({branch:a})))},[f?.name,a]);const ne=t=>{if(!T&&h.length<=3)return k(!0),null;const d={...t,teacher:[+K],color:t?.color??T,branch:a,create_type:"school",system:f.id};U(d),y("post")},re=t=>{ee(_.filter(d=>d.id===+t)[0]?.price===0||!_.filter(d=>d.id===+t)[0]?.price),o(Me({branch:a,number:t}))};s.useEffect(()=>{if(a)switch(l){case"new_students":o(z({userBranchId:a}));break;case"studying_students":o(Pe({userBranchId:a}));break;case"deleted_students":o(Fe({id:a}));break}},[o,l,a]),s.useEffect(()=>{const t=S.get("type");t&&q(t)},[S]),s.useEffect(()=>{tt("selectedRadio",l)},[l]);const oe=t=>{q(t)},ce=s.useCallback(()=>{switch(l){case"new_students":return x==="loading"?e.jsx(N,{}):e.jsx(Ne,{branchId:a,theme:u==="app_school_theme",currentTableData:w});case"deleted_students":return p==="loading"?e.jsx(N,{}):e.jsx(He,{currentTableData:w});case"studying_students":return g==="loading"?e.jsx(N,{}):e.jsx(ze,{currentTableData:w});default:return null}},[x,p,g,l,w])(),le=s.useMemo(()=>[{name:"Yangi o'quvchilar",type:"new_students"},{name:"O'chirilgan o'quvchilar",type:"deleted_students"},{name:"O'qiyotgan o'quvchilar",type:"studying_students"}],[]);return e.jsxs(Ye,{types:le,page:"students",children:[e.jsx(Ue,{setActive:y,onChange:oe,selectedRadio:l,peoples:E,onClick:b}),e.jsx("div",{className:c.tableMain,children:ce}),e.jsx(Te,{setCurrentTableData:W,users:ae,setCurrentPage:O,currentPage:X,pageSize:se,onPageChange:t=>{O(t)},type:"custom"}),e.jsx(Ve,{active:I==="filter",setActive:y,activePage:l,setIsFilter:Q,branchId:a}),e.jsx(J,{active:A==="create",setActive:b,children:e.jsxs("div",{className:c.modal,children:[e.jsx("h1",{children:"Sinf yaratish"}),e.jsxs(Oe,{onSubmit:L(ne),extraClassname:c.modal__form,typeSubmit:Z?"":"inside",children:[te.name==="school"?null:e.jsx(R,{required:!0,extraClassName:c.modal__input,placeholder:"Sinf nomi",name:"name",register:m}),e.jsx(v,{required:!0,extraClass:c.modal__select,title:"O'qituvchi",options:C,onChangeOption:V}),e.jsx(v,{required:!0,extraClass:c.modal__select,title:"Til",options:P,register:m,name:"language"}),e.jsx(v,{required:!0,extraClass:c.modal__select,title:"Sinf raqami",options:_,register:m,onChangeOption:re,name:"class_number"}),G?e.jsx("span",{className:c.modal__error,children:"Sinfga rang tanlang"}):null,h.length<=3?e.jsx("div",{className:c.modal__radios,children:h?.map(t=>e.jsxs("div",{className:c.modal__inner,children:[e.jsx(Ke,{extraClasses:c.modal__item,onChange:()=>{$(t.id),k(!1)},checked:T===t.id,name:"color"}),t.name]}))}):e.jsx(v,{required:!0,extraClass:c.modal__select,title:"Sinf rangi",name:"color",options:h,register:m})]})]})}),e.jsx(fe,{branch:a,setActive:b,active:A==="add"}),e.jsx(et,{deactiveModal:b,setActive:y,active:I==="post",data:H,branch:a})]})};export{Xt as StudentsPage};
