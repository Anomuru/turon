import{r as o,l as E,n,j as t,p as y,B as L,o as R,u as q,A as $,h as z}from"./index-Cux8sda1.js";import"./userProfileSlice-BflEK4KO.js";import"./index-Dyh4sQR2.js";import{M as k}from"./modal-BR27MEf1.js";import{j as U}from"./studentsSlice-JQcNq_2O.js";import"./alertSlice-XeBTN8B3.js";import{b as G}from"./studentsSelector-TVQxHXsm.js";import{P as H}from"./pagination-Cj0p_t2O.js";import{getSearchValue as V}from"./index-Dvh1lTlU.js";import"./workerSelect-N9ju4zO7.js";import{g as J}from"./teacherParseSlice-z7KSx3F7.js";import{f as K}from"./teacherThunk-qU_2Y3xX.js";import"./filterRoomsSlice-ClpK4_Fa.js";import{F as O}from"./form-C3mZZqBW.js";import"./textArea-1604NtUh.js";import"./editableCard-BNSd-vHU.js";import"./index-CO9axSa1.js";import"./oftenUsedSelector-B4R2CTqR.js";import{F as Q}from"./flowList-DzAYIuIr.js";import{a as N}from"./flowsSlice-BXoIT3Tq.js";import{u as W}from"./index.esm-DQmSsb0O.js";import{g as T,a as X}from"./flowsSelector-BUggl1rg.js";import{g as Y,a as Z,f as ee,b as se,c as te}from"./flowsProfileThunk-CL9pqjRO.js";import{g as ae}from"./index-B-IQsIPc.js";import{c as B,F as re}from"./index-BknVp2T2.js";import{M as oe}from"./MultiPage-CgDPt1S_.js";import"./user_image-CruVt77w.js";import"./cross-BXlnQeE0.js";import"./confirmModal-DiNALKc8.js";import"./groupsAttendanceSlice-DmRNDpcI.js";import"./roomsSelectors-Dutms6Wd.js";import"./switch-sjHY-EbU.js";import"./Transition-CosWKtpf.js";import"./room_image-CsXp1EfD.js";import"./filters.module-C8GjSCwu.js";import"./link-B95gzaLk.js";import"./multiPageSlice-CecU3CKU.js";import"./index-sxu4Z6A5.js";const de="_addForm_1tbfl_1",ne="_addForm__btn_1tbfl_7",le="_addModal_1tbfl_12",ce="_addModal__header_1tbfl_21",ie="_addModal__inner_1tbfl_31",ue="_addModal__container_1tbfl_37",fe="_addModal__btn_1tbfl_95",m={addForm:de,addForm__btn:ne,addModal:le,addModal__header:ce,addModal__inner:ie,addModal__container:ue,addModal__btn:fe},me=o.memo(S=>{const{active:C,setActive:I}=S,_=E(),{register:b,handleSubmit:x}=W(),F=n(T),u=n(Y),l=n(ae),p=n(Z),[v,c]=o.useState([]),[M,j]=o.useState(!1),[w,h]=o.useState([]);o.useEffect(()=>{_(N(l))},[]),o.useEffect(()=>{p&&c(p)},[p]),o.useEffect(()=>{l&&u&&_(ee({flow:u?.id,branch:l,res:{ignore_students:u?.students.map(r=>r?.id)}}))},[l,u]);const P=r=>{_(se({id:r?.flow})),j(!0)},A=()=>{let r=[];w.map(s=>{s?.students?.map(e=>r.push(e))});const a={update_type:"add_students",students:r};_(te({id:u?.id,res:a}))},D=r=>{c(a=>a.map(s=>s.id===+r?s.isCheck?(h(e=>e.filter(d=>d.classId!==s.id)),{isCheck:!1,id:s.id,students:s.students.map(e=>({isCheck:!1,id:e.id,extra_info:e.extra_info,user:e.user})),class_number:s.class_number,color:s.color}):(h(e=>e.filter(d=>d.classId===s.id)[0]?[...e.filter(d=>d.classId!==s.id),{classId:s.id,students:s?.students?.map(d=>d?.id)}]:[...e,{classId:s.id,students:s?.students?.map(d=>d?.id)}]),{isCheck:!0,id:s.id,students:s.students.map(e=>({isCheck:!0,id:e.id,extra_info:e.extra_info,user:e.user})),class_number:s.class_number,color:s.color}):s))},i=(r,a)=>{h(s=>s.filter(e=>e?.classId===+a)[0]?s.map(e=>{if(e?.classId===a)return{classId:e.classId,students:e.students.includes(+r)?e.students.filter(d=>d!==+r):[...e.students,+r]}}):[...s,{classId:+a,students:[+r]}])};o.useEffect(()=>{c(r=>r.map(a=>{const s=w.filter(e=>e?.classId===a.id)[0];return s?{isCheck:s?.students?.length===a.students.length,id:a.id,students:a.students.map(e=>s?.students?.includes(e.id)?{isCheck:!0,id:e.id,extra_info:e.extra_info,user:e.user}:{isCheck:!1,id:e.id,extra_info:e.extra_info,user:e.user}),class_number:a.class_number,color:a.color}:a}))},[w]);const f=v.map((r,a)=>t.jsx(Q,{flowList:r,onChangeAll:D,onChangeSingle:i,number:a},a));return t.jsxs(t.Fragment,{children:[t.jsx(k,{active:C,setActive:I,children:t.jsxs(O,{extraClassname:m.addForm,onSubmit:x(P),typeSubmit:"",children:[t.jsx("h2",{children:"Add Flow"}),t.jsx(y,{options:F,register:b,title:"Patok",name:"flow"}),t.jsx(L,{extraClass:m.addForm__btn,children:"Tekshirmoq"})]})}),t.jsxs(k,{active:M,setActive:j,extraClass:m.addModal,children:[t.jsx("div",{className:m.addModal__header,children:t.jsxs("div",{className:m.addModal__inner,children:[t.jsx("span",{children:"No"}),t.jsx("span",{children:"Sinf Raqami"})]})}),t.jsx("div",{className:m.addModal__container,children:f}),t.jsx(L,{extraClass:m.addModal__btn,onClick:A,children:"Add"})]})]})}),Ye=()=>{let S=o.useMemo(()=>50,[]);const[C,I]=o.useState([]),[_,b]=o.useState(1),x=n(V),F=localStorage.getItem("selectedBranch"),{request:u}=q(),l=E(),p=n(T),v=n(X),c=n(R),M=n(J),j=n(G),[w,h]=o.useState(!1),P=o.useMemo(()=>{const i=p?.filter(g=>!g.deleted)||[];return b(1),x?i.filter(g=>g?.name?.toLowerCase().includes(x.toLowerCase())):i},[p,x]);o.useEffect(()=>{l(N(c?.id))},[c]),o.useEffect(()=>{F&&l(K({userBranchId:F}))},[F]);const A=i=>{const g=M.filter(f=>f.id===+i)[0]?.subject[0]?.id;u(`${$}Subjects/level-for-subject/${g}/`,"GET",null,z()).then(f=>{l(U(f))}).catch(f=>console.log(f))},D=o.useMemo(()=>[{name:"Flows",type:"flows"}],[]);return t.jsx(oe,{types:D,page:"students",children:t.jsxs("div",{className:B.flow,children:[t.jsx("div",{className:B.flow__header}),t.jsx(re,{branchId:c?.id,currentTableData:C,loading:v,teacherData:M,levelData:j,getLevelData:A,setActive:h}),t.jsx(H,{setCurrentTableData:I,users:P,setCurrentPage:b,currentPage:_,pageSize:S,onPageChange:i=>{b(i)},type:"custom"}),t.jsx(me,{userBranchId:c.id,active:w,setActive:h})]})})};export{Ye as FlowsPage};
