import{b as G,j as e,T as z,u as k,a as h,r as s,bm as ge,e as W,h as Y,A as q,i as H,o as Z,bn as je,B as D,z as V,d as ee,I as M,bo as te,R as Se,a3 as se,bp as fe,bq as Ce,br as pe,a6 as be,a7 as ae,a8 as F,S as T,a9 as ve,aa as ye,ab as Be,bs as Ne,n as Fe,g as De,bt as we,bu as Ae,bv as Te,bw as Ie,bx as Pe,by as Re,D as ke,bz as qe,F as $e,bA as Oe}from"./index-Dts_nlzx.js";import{C as Ee}from"./classAddForm-HZtTYKF5.js";import{h as Le,i as Me,j as Ge,k as ze,l as Ye,m as He,n as Ve,N as Je}from"./groupTimeTableForm-D3spKBj9.js";import{d as Qe}from"./groupProfileRating-C4fPDThS.js";import{P as Ue}from"./pagination-BEgznGGB.js";import"./teachers-EOHwYsGd.js";import"./editableCard-_YQDga6-.js";import{C as Ke}from"./confirmModal-BY7I8EU1.js";import{R as ne}from"./radio-A91-OwLX.js";import{g as We}from"./brachSwitcherSelector-vlhkEAq9.js";import{g as Xe}from"./searchSelector-B3qtoac4.js";import"./alert-CFF4H1p8.js";import"./groupsList-Bhq5Xgvx.js";import"./roomsSelectors-BrI_i2qA.js";const E={},Ze=({currentTableData:l})=>{const n=G();console.log(l,"current");const c=()=>l?.map((a,r)=>e.jsxs("tr",{onClick:()=>n(`profile/${a?.id}`),children:[e.jsx("td",{children:r+1}),e.jsxs("td",{children:[a?.user?.name," ",a?.user?.surname]}),e.jsx("td",{children:a?.user?.age}),e.jsx("td",{children:a?.user?.phone}),e.jsx("td",{children:a?.group?.name?a.group.name:`${a?.class_number} ${a?.group?.color}`}),e.jsx("td",{children:e.jsx("div",{style:{width:"fit-content",border:a.color?`2px solid #${a.color}`:"2px solid black",color:`${a.color}`,padding:"1.5rem",borderRadius:"10px"},children:a.debt})})]},a.id));return e.jsx("div",{className:E.students,children:e.jsx("div",{className:E.table,children:e.jsxs(z,{extraClass:E.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nomer"}),e.jsx("th",{children:"Guruh nomi"}),e.jsx("th",{children:"Qarzi "})]})}),e.jsx("tbody",{children:c()})]})})})},et="_deletedStudents_9pq9e_1",tt="_deletedStudents__menu_9pq9e_11",st="_active_9pq9e_25",B={deletedStudents:et,deletedStudents__menu:tt,active:st},at=({currentTableData:l})=>{const n=k(),c=h(Qe),[a,r]=s.useState("all"),[_,m]=s.useState([]),[x,C]=s.useState([]),i=G(),[p,o]=s.useState(!1),[j,N]=s.useState(!1);s.useEffect(()=>{n(ge())},[]);const{request:w}=Y(),d=()=>{w(`${q}Students/delete-student-from-deleted/${j}/`,"DELETE",null,H()).then(t=>{n(Z({type:"success",status:!0,msg:t.msg}))}),o(!1),n(je(j))};console.log(l,"currentTableData");const b=()=>l?.map((t,g)=>a==="all"?e.jsxs("tr",{children:[e.jsx("td",{children:g+1}),e.jsxs("td",{onClick:()=>i(`profile/${t?.student?.id}`),children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{N(t.student.id),o(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):t?.group_reason?.id===a?e.jsxs("tr",{onClick:()=>i(`profile/${t.id}`),children:[e.jsx("td",{children:g+1}),e.jsxs("td",{children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{N(t.student.id),o(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):null);return e.jsxs("div",{className:B.deletedStudents,children:[e.jsxs("ul",{className:B.deletedStudents__menu,children:[e.jsx("li",{className:W(B.other__item,{[B.active]:a==="all"}),onClick:()=>{r("all")},children:"Hammasi"},6),c?.map((t,g)=>e.jsx("li",{className:W(B.other__item,{[B.active]:a===t.id}),onClick:()=>{r(t.id)},children:t.name},g))]}),e.jsx("div",{className:B.table,children:e.jsxs(z,{extraClass:B.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nome"}),e.jsx("th",{children:"Guruh"}),e.jsx("th",{children:"Reg.sana"}),e.jsx("th",{children:"O'chir.sana"}),e.jsx("th",{children:"Sabab"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:b()})]})}),e.jsx(Ke,{onClick:d,title:"Qaytarish",text:"Studentni rostanham qaytarmoqchimisiz",type:"danger",active:p,setActive:o})]})},nt="_mainContainer_1agrm_1",rt="_mainContainer_buttonPanelBox_1agrm_4",lt="_mainContainer_buttonPanelBox_leftCreateButton_1agrm_8",dt="_mainContainer_filterPanelBox_1agrm_11",ct="_mainContainer_filterPanelBox_rightFilterRadioGroupBox_1agrm_15",ot="_activeFilter_1agrm_20",v={mainContainer:nt,mainContainer_buttonPanelBox:rt,mainContainer_buttonPanelBox_leftCreateButton:lt,mainContainer_filterPanelBox:dt,mainContainer_filterPanelBox_rightFilterRadioGroupBox:ct,activeFilter:ot},it=({onChange:l,selectedRadio:n,peoples:c,setActive:a,onClick:r})=>{const _=h(We),m=G();return e.jsxs("div",{className:v.mainContainer,children:[e.jsx("div",{className:v.mainContainer_buttonPanelBox,children:e.jsxs("div",{className:v.mainContainer_buttonPanelBox_leftCreateButton,children:[e.jsx(D,{type:"filter",extraClass:v.extraCutClass,onClick:()=>r("create"),children:"Create Class"}),e.jsx(D,{onClick:()=>r("add"),type:"filter",extraClass:v.noneBackground,children:"Add class"}),e.jsx(D,{onClick:()=>m("RGBData"),type:"filter",children:"RB-Baza"})]})}),e.jsxs("div",{className:v.mainContainer_filterPanelBox,children:[e.jsx(D,{status:"filter",extraClass:v.extraCutClassFilter,onClick:()=>a("filter"),type:"filter",children:"Filter"}),e.jsx("a",{style:{color:"white"},href:`${q}Students/export-students/?branch=${_?.id}&format=json`,children:e.jsx(D,{type:"simple",children:"Exel"})}),e.jsx("div",{className:v.mainContainer_filterPanelBox_rightFilterRadioGroupBox,children:c.map((x,C)=>e.jsx(ne,{onChange:()=>l(x.name),checked:n===x.name,extraClasses:n===x.name?v.activeFilter:null,children:x.label},C))})]})]})},ut="_createClass_s3igw_1",ht="_createClass__input_s3igw_6",_t="_createClass__btn_s3igw_9",xt="_createClass__inner_s3igw_13",R={createClass:ut,createClass__input:ht,createClass__btn:_t,createClass__inner:xt},mt=s.memo(l=>{const{active:n,setActive:c,data:a,branch:r,deactiveModal:_}=l,{request:m}=Y(),x=k(),C=h(Le),i=h(Me),[p,o]=s.useState([]);s.useEffect(()=>{o([])},[C]);const j=()=>{const d={...a,students:p};m(`${q}Group/groups/create/`,"POST",JSON.stringify(d),H()).then(b=>{x(Z({type:"success",status:!0,msg:"Sinf yaratildi"})),x(te({userBranchId:r})),c(!1),_(!1)})},w=i==="loading"||i==="idle"?e.jsx(ee,{}):C?.map((d,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:b+1}),e.jsxs("td",{children:[d.user?.surname," ",d.user?.name]}),e.jsx("td",{children:d.user?.age}),e.jsx("td",{children:d.user?.language}),e.jsx("td",{children:d?.class_number}),e.jsx("td",{children:d.user?.registered_date}),e.jsx("td",{children:e.jsx(M,{extraClassName:R.createClass__input,type:"checkbox",onChange:()=>o(t=>t.filter(g=>g===d.id)[0]?t.filter(g=>g!==d.id):[...t,d.id])})})]}));return e.jsx(V,{active:n,setActive:c,children:e.jsxs("div",{className:R.createClass,children:[e.jsx("h1",{children:"O'quvchi tanlang"}),e.jsx("div",{className:R.createClass__inner,children:e.jsxs(z,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:w})]})}),e.jsx(D,{onClick:j,extraClass:R.createClass__btn,children:"Create"})]})})}),gt=Se.memo(({active:l,setActive:n,activePage:c,pageSize:a,currentPage:r})=>{const _=localStorage.getItem("selectedLang"),m=localStorage.getItem("ageFrom"),x=localStorage.getItem("ageTo"),C=localStorage.getItem("studentSwitch"),[i,p]=s.useState(m!==null?m:""),[o,j]=s.useState(x!==null?x:""),[N,w]=s.useState(_),[d,b]=s.useState(C==="true"),t=k(),g=h(se);localStorage.setItem("selectedLang",N),localStorage.setItem("ageFrom",i),localStorage.setItem("ageTo",o),localStorage.setItem("studentSwitch",`${d}`);const y=localStorage.getItem("branchId");console.log(m,x),s.useEffect(()=>{t(c==="studying_students"?fe({langId:_,fromAge:i,untilAge:o,userBranchId:y,currentPage:r,pageSize:a}):c==="new_students"?d?Ce({langId:_,fromAge:i,untilAge:o,userBranchId:y,currentPage:r,pageSize:a}):te({langId:_,fromAge:i,untilAge:o,userBranchId:y,currentPage:r,pageSize:a}):pe({langId:_,fromAge:i,untilAge:o,userBranchId:y,currentPage:r,pageSize:a}))},[N,o,i,c,d,r]);const $=f=>{p(f.target.value)},O=f=>{j(f.target.value)};return s.useEffect(()=>{t(be()),t(ae())},[t]),e.jsx(V,{active:l,setActive:n,children:e.jsxs("div",{className:F.filter,children:[e.jsx("h1",{children:"Filter"}),e.jsxs("div",{className:F.filter__container,children:[e.jsxs("div",{className:F.filter__age,children:[e.jsx(M,{type:"number",extraClassName:F.filter__input,placeholder:"Yosh (От)",onChange:f=>p(f.target.value),onBlur:$,defaultValue:i}),e.jsx(M,{type:"number",extraClassName:F.filter__input,placeholder:"Yosh (До)",onChange:f=>j(f.target.value),onBlur:O,defaultValue:o})]}),e.jsx(D,{type:"danger",onClick:()=>{j(null),p(null)},children:"Clear (Yoshlarni tozalash)"}),e.jsx(T,{title:"Til",options:[{name:"Hamma",id:"all"},...g],extraClass:F.filter__select,onChangeOption:w,defaultValue:_}),c==="new_students"&&e.jsxs("div",{className:F.filter__switch,children:[e.jsx("p",{children:"O’chirilgan"}),e.jsx(ve,{onChangeSwitch:b,activeSwitch:d})]})]})]})})}),L=ye("filterStudents/fetchFilteredStudents",async l=>{const{request:n}=Y();return await n(`${q}`,"POST",JSON.stringify(l),H())}),jt={students:null,loading:!1,error:null};Be({name:"filterStudents",initialState:jt,reducers:{},extraReducers:l=>l.addCase(L.pending,n=>{n.loading=!0,n.error=null}).addCase(L.fulfilled,(n,c)=>{n.students=c.payload,n.loading=!1,n.error=null}).addCase(L.rejected,(n,c)=>{n.loading=!1,n.error=c.payload??null})});const St=(l,n)=>{localStorage.setItem(l,n)},ft=l=>localStorage.getItem(l),Ct="_tableMain_c2dxc_1",pt="_modal_c2dxc_16",bt="_modal__error_c2dxc_21",vt="_modal__form_c2dxc_26",yt="_modal__select_c2dxc_31",Bt="_modal__radios_c2dxc_34",Nt="_modal__inner_c2dxc_40",Ft="_modal__item_c2dxc_46",S={tableMain:Ct,modal:pt,modal__error:bt,modal__form:vt,modal__select:yt,modal__radios:Bt,modal__inner:Nt,modal__item:Ft},X=[{name:"new_students",label:"New Students"},{name:"studying_students",label:"Studying Students"},{name:"deleted_students",label:"Deleted Students"}],Dt={newStudents:qe},Jt=()=>{const l=k(),[n]=Ne(),{register:c,handleSubmit:a}=Fe(),r=h(De);h(Xe);const _=h(we),m=h(Ae),x=h(Te),C=h(se),i=h(Ge),p=h(ze),o=h(Ye),j=h(He),[N,w]=s.useState(null),[d,b]=s.useState(ft("selectedRadio")||X[0].name),[t,g]=s.useState({}),[y,$]=s.useState(),[O,f]=s.useState(!1),[re,le]=s.useState(),[J,I]=s.useState(!1),[Q,P]=s.useState(""),[wt,de]=s.useState(""),[At,Tt]=s.useState([]),[U,ce]=s.useState(1),[oe,ie]=s.useState(!0),ue=h(Ve);let K=s.useMemo(()=>50,[]);s.useEffect(()=>{r&&(l(Ie(r)),l(ae()))},[r]),s.useEffect(()=>{r&&(l(Pe()),l(Re({branch:r})))},[r]);const he=u=>{if(!y&&m.length<=3)return f(!0),null;const A={...u,teacher:[+re],color:u?.color??y,branch:r,create_type:"school"};g(A),P("post")},_e=u=>{ie(_.filter(A=>A.id===+u)[0]?.price===0||!_.filter(A=>A.id===+u)[0]?.price),l(Oe({branch:r,number:u}))};s.useEffect(()=>{const u=n.get("type");u&&b(u)},[n]),s.useEffect(()=>{St("selectedRadio",d)},[d]);const xe=u=>{b(u)};console.log(o);const me=s.useCallback(()=>{switch(d){case"new_students":return e.jsx(Je,{branchId:r,currentTableData:p});case"deleted_students":return e.jsx(at,{currentTableData:o});case"studying_students":return e.jsx(Ze,{currentTableData:i});default:return null}},[j,d,i])();return s.useMemo(()=>[{name:"Yangi o'quvchilar",type:"new_students"},{name:"O'chirilgan o'quvchilar",type:"deleted_students"},{name:"O'qiyotgan o'quvchilar",type:"studying_students"}],[]),console.log(i,"studyingStudents"),e.jsxs(ke,{reducers:Dt,children:[e.jsx(it,{setActive:P,onChange:xe,selectedRadio:d,peoples:X,onClick:I}),e.jsx("div",{className:S.tableMain,children:j===!0?e.jsx(ee,{}):me}),e.jsx(Ue,{totalCount:ue,currentPage:U,pageSize:K,onPageChange:u=>{ce(u)},type:"custom"}),e.jsx(gt,{currentPage:U,pageSize:K,active:Q==="filter",setActive:P,activePage:d,setIsFilter:de,branchId:r}),e.jsx(V,{active:J==="create",setActive:I,children:e.jsxs("div",{className:S.modal,children:[e.jsx("h1",{children:"Sinf yaratish"}),e.jsxs($e,{onSubmit:a(he),extraClassname:S.modal__form,typeSubmit:oe?"":"inside",children:[e.jsx(T,{required:!0,extraClass:S.modal__select,title:"O'qituvchi",options:x,onChangeOption:le}),e.jsx(T,{required:!0,extraClass:S.modal__select,title:"Til",options:C,register:c,name:"language"}),e.jsx(T,{required:!0,extraClass:S.modal__select,title:"Sinf raqami",options:_,register:c,onChangeOption:_e,name:"class_number"}),O?e.jsx("span",{className:S.modal__error,children:"Sinfga rang tanlang"}):null,m.length<=3?e.jsx("div",{className:S.modal__radios,children:m?.map(u=>e.jsxs("div",{className:S.modal__inner,children:[e.jsx(ne,{extraClasses:S.modal__item,onChange:()=>{$(u.id),f(!1)},checked:y===u.id,name:"color"}),u.name]}))}):e.jsx(T,{required:!0,extraClass:S.modal__select,title:"Sinf rangi",name:"color",options:m,register:c})]})]})}),e.jsx(Ee,{branch:r,setActive:I,active:J==="add"}),e.jsx(mt,{deactiveModal:I,setActive:P,active:Q==="post",data:t,branch:r})]})};export{Jt as StudentsPage};
