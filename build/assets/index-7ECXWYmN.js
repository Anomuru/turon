import{j as e,eH as Me,r,a4 as ve,B as Ce,ch as Re,cj as ze,h as ce,eI as Ge,eJ as we,eK as Ie,a as y,eL as Pe,eM as Ve,eN as Be,eO as qe,eP as He,eQ as Je,eR as Ke,eS as Ue,eT as We,eU as Qe,eV as Xe,eW as Ye,eX as Ze,g as es,u as ss,eY as ts,eZ as rs,e_ as ns,e$ as as,f0 as ge,o as os,f1 as ls,i as cs,A as ee,k as se,f2 as is,f3 as be,f4 as ds,db as us,f5 as fs,f6 as ms,f7 as ps,M as _e,f8 as hs,f9 as gs,fa as je}from"./index-B1KXs2zi.js";import{fb as ht}from"./index-B1KXs2zi.js";const bs="_timeTable_1i695_1",_s={timeTable:bs},js="_dnd_o45g6_1",xe={dnd:js,class:"_class_o45g6_8"},U=o=>{const{item:s,children:u,color:h,typeItem:f}=o;return e.jsx(Me,{data:{type:s.type},id:s.dndId,extraClass:xe.dnd,children:e.jsx("div",{className:xe.class,style:{backgroundColor:h||s?.teacher?.color,fontSize:f==="flow"?"1.2rem":null},children:u})})},xs="_dragItems_1ftr7_1",Ts={dragItems:xs},Ss=o=>{const{groups:s,isSelected:u,subjects:h,teachers:f,selectedSubject:v,color:l,setSelectedSubject:m,type:w,status:E}=o,P=()=>s?.filter(c=>c.type==="group"?c?.color?.id===+l:!0),n=r.useCallback(()=>u?v?f.map(c=>e.jsxs(U,{type:"teacher",item:c,children:[c?.name," ",c?.surname]})):h?.length?h.map(c=>e.jsxs(U,{type:"subject",item:c,children:[c?.name," - ",c.hours]})):e.jsx("h1",{style:{color:"red"},children:"Fanlar yoq"}):s.length?P()?.map(c=>e.jsxs(U,{color:c.type==="group"?c?.color?.value:"",typeItem:w,item:c,children:[e.jsx("p",{style:{textAlign:"center"},children:c?.class_name||c?.name}),e.jsx("p",{style:{textAlign:"center"},children:w==="flow"&&e.jsxs(e.Fragment,{children:[c?.subject_info?.name,e.jsx("br",{}),c.teacher_info?.name," -",c.teacher_info?.surname]})})]})):e.jsxs("h1",{style:{color:"red"},children:[w," yoq"]}),[u,v,s,f,l,h]);return E==="loading"?e.jsx(ve,{}):e.jsxs("div",{className:Ts.dragItems,children:[v&&e.jsx(Ce,{type:"danger",onClick:()=>m(null),children:"Fanlar"}),n()]})},vs="_tableTuron_133uk_6",Cs="_wrapper_133uk_13",ws="_header_133uk_20",Is="_item_133uk_29",ys="_footer_133uk_38",Ds="_rooms_133uk_43",$s="_room_133uk_43",Ns="_containers_133uk_59",ks="_droppableContainer_133uk_64",O={tableTuron:vs,wrapper:Cs,header:ws,item:Is,footer:ys,rooms:Ds,room:$s,containers:Ns,droppableContainer:ks},Fs="_draggableContainer_f3x1m_1",Ls="_handle_f3x1m_12",Es="_trash_f3x1m_18",As="_selected_f3x1m_25",Os="_info_f3x1m_34",K={draggableContainer:Fs,handle:Ls,trash:Es,selected:As,info:Os},Ms="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='16'%20width='10'%20viewBox='0%200%20320%20512'%3e%3c!--!Font%20Awesome%20Free%206.5.1%20by%20@fontawesome%20-%20https://fontawesome.com%20License%20-%20https://fontawesome.com/license/free%20Copyright%202024%20Fonticons,%20Inc.--%3e%3cpath%20d='M40%20352l48%200c22.1%200%2040%2017.9%2040%2040l0%2048c0%2022.1-17.9%2040-40%2040l-48%200c-22.1%200-40-17.9-40-40l0-48c0-22.1%2017.9-40%2040-40zm192%200l48%200c22.1%200%2040%2017.9%2040%2040l0%2048c0%2022.1-17.9%2040-40%2040l-48%200c-22.1%200-40-17.9-40-40l0-48c0-22.1%2017.9-40%2040-40zM40%20320c-22.1%200-40-17.9-40-40l0-48c0-22.1%2017.9-40%2040-40l48%200c22.1%200%2040%2017.9%2040%2040l0%2048c0%2022.1-17.9%2040-40%2040l-48%200zM232%20192l48%200c22.1%200%2040%2017.9%2040%2040l0%2048c0%2022.1-17.9%2040-40%2040l-48%200c-22.1%200-40-17.9-40-40l0-48c0-22.1%2017.9-40%2040-40zM40%20160c-22.1%200-40-17.9-40-40L0%2072C0%2049.9%2017.9%2032%2040%2032l48%200c22.1%200%2040%2017.9%2040%2040l0%2048c0%2022.1-17.9%2040-40%2040l-48%200zM232%2032l48%200c22.1%200%2040%2017.9%2040%2040l0%2048c0%2022.1-17.9%2040-40%2040l-48%200c-22.1%200-40-17.9-40-40l0-48c0-22.1%2017.9-40%2040-40z'/%3e%3c/svg%3e",ie=o=>{const{item:s,type:u,onDoubleClick:h,onDelete:f,canChange:v=!0}=o,{attributes:l,listeners:m,setNodeRef:w,transform:E,isDragging:P}=Re({id:s.dndId,data:{type:"container",room:s.room}}),n=u==="overlay"?{border:"1px solid black"}:null,c=P?{transform:ze.Translate.toString(E),opacity:"0",backgroundColor:s?.isFilteredColor?"red":s.group?.color?.value||null,...n}:{backgroundColor:s?.isFilteredColor?"#642626":s.group?.color?.value||null,...n};return e.jsxs("div",{style:c,className:ce(K.draggableContainer,{[K.selected]:s.isSelected}),...l,ref:w,onDoubleClick:v?h:null,children:[v&&e.jsxs(e.Fragment,{children:[!!s?.teacher?.name&&e.jsx(Ms,{...m,className:K.handle}),e.jsx("i",{onClick:()=>f(s.room,s.dndId,s.id),className:ce("fa-solid  fa-times",K.trash)})]}),e.jsx("h1",{children:s.group?.class_name||s.group?.name}),!!s?.subject?.name&&e.jsxs("div",{className:K.info,children:[e.jsx("span",{children:s.subject.name}),!!s?.teacher?.name&&e.jsxs("span",{children:[s.teacher?.name," ",s?.teacher?.surname]})]})]})},Rs=o=>{const{rooms:s,hours:u,onDoubleClickContainer:h,onDeleteContainer:f}=o,v=l=>l.map(m=>e.jsx(zs,{onDoubleClickContainer:h,onDelete:f,item:m}));return e.jsx("div",{className:O.tableTuron,children:e.jsxs("div",{className:O.wrapper,children:[e.jsx("div",{className:O.header,children:u.map(l=>e.jsxs("div",{className:O.item,children:[l.start_time,"-",l.end_time]}))}),e.jsx("div",{className:O.footer,children:s.map(l=>e.jsxs("div",{className:O.rooms,children:[e.jsx("div",{className:O.room,children:l.name}),e.jsx("div",{className:O.containers,children:v(l.lessons)})]}))})]})})},zs=o=>{const{item:s,onDoubleClickContainer:u,onDelete:h}=o,f={background:"green",border:"2px solid black"},v=()=>{s.group.name&&s.group.type!=="flow"&&u(s.room,s.dndId)};return e.jsx(Ge,{data:{room:s.room,type:"container"},id:s.dndId,disabled:s.isDisabled,extraClass:O.droppableContainer,overStyle:f,children:!!s.group.name&&e.jsx(ie,{onDelete:h,onDoubleClick:v,item:s})})},Gs="_fullscreen_mghar_6",Ps="_wrapper_mghar_13",Vs="_header_mghar_21",Bs="_item_mghar_28",qs="_footer_mghar_37",Hs="_rooms_mghar_42",Js="_room_mghar_42",Ks="_containers_mghar_56",Us="_droppableContainer_mghar_61",M={fullscreen:Gs,wrapper:Ps,header:Vs,item:Bs,footer:qs,rooms:Hs,room:Js,containers:Ks,droppableContainer:Us},Ws=o=>{const{rooms:s,hours:u}=o,h=m=>m.map(w=>e.jsx(Qs,{item:w})),[f,v]=r.useState();function l(m){v(m.instance.transformState.scale)}return e.jsx("div",{className:M.fullscreen,children:e.jsx(we,{onTransformed:m=>l(m),initialScale:1,doubleClick:{disabled:!0},minScale:.2,maxScale:5,panning:{activationKeys:[],excluded:[]},pinch:{excluded:[]},children:e.jsx("div",{className:M.wrapper,children:e.jsxs(Ie,{wrapperStyle:{width:"100%",height:"100%"},children:[e.jsx("div",{className:M.header,children:u.map(m=>e.jsx("div",{className:M.item,children:e.jsxs("span",{style:{transform:`scale(${1/f})`},children:[m.start_time,"-",m.end_time]})}))}),e.jsx("div",{className:M.footer,children:s.map(m=>e.jsxs("div",{className:M.rooms,children:[e.jsx("div",{className:M.room,children:e.jsx("span",{style:{transform:`scale(${1/f})`},children:m.name})}),e.jsx("div",{className:M.containers,children:h(m.lessons)})]}))})]})})})})},Qs=o=>{const{item:s}=o;return e.jsx("div",{className:M.droppableContainer,children:!!s.group.name&&e.jsx(ie,{canChange:!1,item:s})})},Xs="_fullscreen_1fovm_6",Ys="_wrapper_1fovm_19",Zs="_header_1fovm_26",et="_item_1fovm_33",st="_footer_1fovm_42",tt="_rooms_1fovm_47",rt="_room_1fovm_47",nt="_containers_1fovm_61",at="_droppableContainer_1fovm_66",ot="_draggableContainer_1fovm_73",lt="_isFlow_1fovm_83",ct="_info_1fovm_94",D={fullscreen:Xs,wrapper:Ys,header:Zs,item:et,footer:st,rooms:tt,room:rt,containers:nt,droppableContainer:at,draggableContainer:ot,isFlow:lt,info:ct};function it(o){o=o.replace(/^#/,"");let s=parseInt(o.substring(0,2),16),u=parseInt(o.substring(2,4),16),h=parseInt(o.substring(4,6),16);return .299*s+.587*u+.114*h}const dt=o=>{const{lessons:s,hours:u}=o,[h,f]=r.useState([]),[v,l]=r.useState(!1);r.useEffect(()=>{if(s?.length){const n=[];for(let c=0;c<s.length;c++){const $=s[c];for(let R=0;R<$.lessons.length;R++){const q=$.lessons[R];q.is_flow&&(n.some(H=>H.flow===q.group.id)||n.push({group:$.id,flow:q.group.id}))}}f(n),l(!0)}},[s]);const m=r.useCallback((n,c)=>{if(v&&n.length)return n.map($=>$.is_flow?e.jsx(Te,{isFlow:!0,canRender:h.some(R=>R.flow===$.group.id&&R.group===c),renderedFlows:h,setRenderedFlows:f,item:$}):e.jsx(Te,{renderedFlows:h,setRenderedFlows:f,item:$}))},[v]),[w,E]=r.useState();function P(n){E(n.instance.transformState.scale)}return console.log(s,"lessons"),e.jsx("div",{className:D.fullscreen,children:e.jsx(we,{onTransformed:n=>P(n),initialScale:.6,doubleClick:{disabled:!0},minScale:.2,maxScale:5,panning:{activationKeys:[],excluded:[]},pinch:{excluded:[]},children:e.jsx("div",{className:D.wrapper,children:e.jsxs(Ie,{wrapperStyle:{width:"100%",height:"100%"},children:[e.jsx("div",{className:D.header,children:u?.map(n=>e.jsx("div",{className:D.item,children:e.jsxs("span",{style:{transform:`scale(${1/w})`},children:[n.start_time,"-",n.end_time]})}))}),e.jsx("div",{className:D.footer,children:s?.map(n=>e.jsxs("div",{className:D.rooms,children:[e.jsx("div",{className:D.room,style:{backgroundColor:`${n.color}`,color:it(n.color)>125?"black":"white"},children:e.jsx("span",{style:{transform:`scale(${1/w})`},children:n.name})}),e.jsx("div",{className:D.containers,children:m(n.lessons,n.id)})]}))})]})})})})},Te=o=>{const{item:s,isFlow:u,canRender:h}=o,f=u&&{height:s.group.classes.length*70+"px",position:"absolute",zIndex:20};return u&&!h?e.jsx("div",{className:D.droppableContainer}):e.jsx("div",{className:D.droppableContainer,children:!!s.group.name&&e.jsxs("div",{style:f,className:ce(D.draggableContainer,{[D.isFlow]:u}),children:[e.jsxs("h1",{children:[" ",u?s.group.name:s.room.name]}),s?.subject?.name?e.jsxs("div",{className:D.info,children:[e.jsx("span",{children:s.subject.name}),!!s?.teacher?.name&&e.jsxs("span",{children:[s.teacher?.name," ",s?.teacher?.surname]})]}):null]})})},Se=[{to:"7:00",from:"8:00"},{to:"8:00",from:"9:00"},{to:"9:00",from:"10:00"},{to:"10:00",from:"11:00"}],ft=()=>{const[o,s]=r.useState([]),[u,h]=r.useState([]),[f,v]=r.useState([]),[l,m]=r.useState(),[w,E]=r.useState(!1),[P,n]=r.useState(!1),[c,$]=r.useState(!1),[R,q]=r.useState(!1),[H,de]=r.useState(!1),[W,z]=r.useState(null),[te,ue]=r.useState(null),[j,Q]=r.useState({}),[G,A]=r.useState([]),ye=y(Pe),V=y(Ve),re=y(Be),De=y(qe),$e=y(He),ne=y(Je),fe=y(Ke),Ne=y(Ue),me=y(We),ae=y(Qe),pe=y(Xe),J=y(Ye),N=y(Ze),{id:I}=y(es),F=ss();r.useEffect(()=>{F(ts())},[]),r.useEffect(()=>{N&&I&&F(rs({date:N,branch:I}))},[N,I]),r.useEffect(()=>{N&&I&&H&&F(ns({date:N,branch:I}))},[N,I,H]),r.useEffect(()=>{V&&I&&F(as({type:V,branch:I}))},[V,I]),r.useEffect(()=>{te&&F(ge(te))},[te]),r.useEffect(()=>{re.length&&A(re)},[re]),r.useEffect(()=>{s(fe)},[fe]),r.useEffect(()=>{h(me)},[me]),r.useEffect(()=>{n(!1),!ae.length&&pe==="success"?(F(os({type:"error",status:!0,msg:"Bu fanda o'qituvchilar yo'q"})),z(null)):v(ae)},[ae,pe]),r.useEffect(()=>{W&&I&&(n(!0),F(ls({subject:W,branch:I})))},[W,I]),r.useEffect(()=>{G.length&&J&&V&&A(x=>x.map(i=>{const p=i.lessons.map(t=>{if(!!t.group.id){let d;return V==="group"?d=t.group.type==="group"?t.group.id===+J:t.group.classes.includes(+J):d=t.group.id===+J,{...t,isFilteredColor:d}}return t});return{...i,lessons:p}}))},[G.length,J,V]);const ke=x=>{const{active:i}=x,p=i?.data?.current?.type;if($(!0),p==="container"){oe();const t=i.data.current.room;m(G.filter(_=>_.id===t)[0].lessons.filter(_=>_.dndId===i.id)[0])}else m(p==="group"?o.filter(t=>t.dndId===i.id)[0]:p==="subject"?u.filter(t=>t.dndId===i.id)[0]:f.filter(t=>t.dndId===i.id)[0])},{request:X}=cs(),Fe=async(x,i,p,t,_)=>{const d={hour:x,date:N,checked_id:i,room:p,type:t};return t==="subject"&&(d.group_id=_.group.id),n(!0),await await X(`${ee}SchoolTimeTable/can-set${t==="flow"?"-flow":""}/?branch=${I}`,"POST",JSON.stringify(d),se()).then(k=>(n(!1),t==="subject"&&!k.status&&z(null),F(je(k.msg.map(le=>({type:"error",status:!0,msg:le})))),k.status))},he=async x=>(n(!0),await await X(`${ee}SchoolTimeTable/timetable-update-hours-rooms/?branch=${I}`,"POST",JSON.stringify(x),se()).then(p=>(n(!1),F(je(p.msg.map(t=>({type:"error",status:!0,msg:t})))),p.status)));async function Le(x){const{active:i,over:p}=x;if(!p||!i)return;const t=i?.data?.current?.type,_=i?.data?.current?.room,d=i.id,L=p.id,k=p?.data?.current?.room,le=p?.data?.current?.type;let S;if(t==="group"||t==="flow"?S=o.filter(b=>b.dndId===d)[0]:t==="subject"?(S=u.filter(b=>b.dndId===d)[0],z(S.id)):(S=f.filter(b=>b.dndId===d)[0],z(null)),t==="container"&&le==="container"){const b=G.filter(g=>g.id===_)[0].lessons.filter(g=>g.dndId===d)[0],T=G.filter(g=>g.id===k)[0].lessons.filter(g=>g.dndId===L)[0];let Y;if(T.group?.id?Y=await he([{id:b.id,room:T.room,hour:T.hours,date:N},{id:T.id,room:b.room,hour:b.hours,date:N}]):Y=await he([{id:b.id,room:T.room,hour:T.hours,date:N}]),!Y)return;A(_!==k?g=>g.map(C=>{if(C.id===k){const B=C.lessons.map(a=>a.dndId===L?{...a,id:b.id,group:b?.group||{},subject:b?.subject||{},teacher:b?.teacher||{}}:a);return{...C,lessons:B}}if(C.id===_){const B=C.lessons.map(a=>a.dndId===d?{...a,id:T?.id,group:T?.group,subject:T?.subject,teacher:T?.teacher}:a);return{...C,lessons:B}}return C}):g=>g.map(C=>{if(C.id===k){const B=C.lessons.map(a=>a.dndId===L?{...a,id:b?.id,group:b?.group||{},subject:b?.subject||{},teacher:b?.teacher||{}}:a.dndId===d?{...a,id:T?.id,group:T?.group||{},subject:T?.subject||{},teacher:T?.teacher||{}}:a);return{...C,lessons:B}}return C}))}else{const b=G.filter(g=>g.id===k)[0].lessons.filter(g=>g.dndId===L)[0];let T;if(t==="group"||t==="flow"?T=o.filter(g=>g.dndId===i.id)[0]:t==="subject"?T=u.filter(g=>g.dndId===i.id)[0]:T=f.filter(g=>g.dndId===i.id)[0],!await Fe(b.hours,T.id,b.room,t,b))return;await A(g=>g.map(C=>{if(C.id===k){const B=C.lessons.map(a=>{if(a.dndId===p.id)if(a.items){let Z;return t==="group"?Z=!!a.group.dndId:t==="subject"?Z=!!a.subject.dndId:Z=!!a.teacher.dndId,Z?a:t==="subject"?{...a,[t]:S,teacher:{}}:t==="teacher"?(Q({...a,[t]:S}),{...a,[t]:S}):{...a,[t]:S}}else return t==="subject"?{...a,[t]:S,teacher:{}}:t==="teacher"?(Q({...a,[t]:S}),{...a,[t]:S}):t==="flow"?(Q({...a,id:null,group:S,subject:S.subject_info,teacher:S.teacher_info}),{...a,id:null,group:S,subject:S.subject_info,teacher:S.teacher_info}):{...a,[t]:S};return a});return{...C,lessons:B}}return C}))}$(!1)}const Ee=(x,i)=>{A(p=>p.map(t=>{if(t.id===x){const _=t.lessons.map(d=>d.dndId===i?(E(!0),ue(d.group.id),z(!d.teacher.id&&d.subject.id?d.subject.id:null),{...d,isSelected:!0,isDisabled:!1}):{...d,isSelected:!1,isDisabled:!0});return{...t,lessons:_}}else{const _=t.lessons.map(d=>({...d,isSelected:!1,isDisabled:!0}));return{...t,lessons:_}}}))},oe=()=>{E(!1),z(null),A(x=>x.map(i=>{const p=i.lessons.map(t=>({...t,isSelected:!1,isDisabled:!1}));return{...i,lessons:p}}))},Ae=(x,i,p)=>{A(t=>t.map(_=>{if(_.id===x){const d=_.lessons.map(L=>L.dndId===i?(L.id&&(X(`${ee}SchoolTimeTable/timetable-list-delete/${p}`,"DELETE",null,se()).then(k=>{}),ue(null)),{...L,id:null,group:{},subject:{},teacher:{}}):L);return{..._,lessons:d}}return _})),z(null),oe()};r.useEffect(()=>{if(Object.keys(j)?.length){let x={lesson:j?.id,[j?.group.type]:j.group.id,subject:j?.subject?.id,hours:j?.hours,teacher:j?.teacher?.id,room:j?.room,branch:I,date:N};j?.group.type==="flow"&&(x.teacher=j?.group?.teacher_info?.id,x.subject=j?.group?.subject_info?.id),X(`${ee}SchoolTimeTable/timetable-list-${j?.id?"update":"create"}/${j?.id?j?.id:""}`,j?.id?"PATCH":"POST",JSON.stringify(x),se()).then(i=>{A(p=>p?.map(t=>{if(t.id===j?.room){const _=t?.lessons?.map(d=>d?.dndId===j?.dndId?{...d,id:i?.lesson?.id}:d);return{...t,lessons:_}}return t})),j?.group.type!=="flow"&&F(ge(j.group.id))}).then(()=>{Q({})})}},[j]);const Oe=is(be(gs),be(hs));return e.jsxs("div",{className:_s.timeTable,children:[w?null:e.jsx(ds,{setIsSelected:E,isSelected:w,setFullScreen:q,setClassView:de,groups:o}),w&&e.jsx(Ce,{type:"danger",onClick:oe,children:"Remove Selected"}),P&&e.jsx(us,{}),e.jsxs(fs,{sensors:Oe,collisionDetection:ms,onDragStart:ke,onDragEnd:Le,children:[e.jsx(Ss,{setSelectedSubject:z,selectedSubject:W,isSelected:w,groups:o,subjects:u,teachers:f,color:ye,type:V,status:Ne}),De==="loading"?e.jsx(ve,{}):e.jsx(Rs,{onDoubleClickContainer:Ee,onDeleteContainer:Ae,rooms:G,times:Se,hours:ne,canDisabled:c,startItem:l}),e.jsx(ps,{children:l?.room?e.jsx(ie,{type:"overlay",item:l}):l?.type==="teacher"?e.jsxs(U,{item:l,children:[l.name," ",l.surname]}):l?.dndId?e.jsx(U,{item:l,color:l?.color?.value,children:l.class_name||l.name}):null})]}),e.jsx(_e,{active:R,setActive:q,type:"other",children:e.jsx(Ws,{rooms:G,times:Se,hours:ne})}),e.jsx(_e,{active:H,setActive:de,type:"other",children:e.jsx(dt,{lessons:$e,hours:ne})})]})};export{ft as TimeTableTuronPage,ht as timeTableTuronSlice};
