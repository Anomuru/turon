import{a as M,u as $,A as k,h as E,c as Y,l as q,r as f,j as u,D as G,n as w}from"./index-Cux8sda1.js";import{o as K}from"./alertSlice-XeBTN8B3.js";import"./roomsAddSlice-C3_gwtjf.js";import{u as U}from"./index.esm-DQmSsb0O.js";import{C as W,a as z,b as Q}from"./constsMonthList-CnI754jh.js";import{C as X}from"./confirmModal-DiNALKc8.js";import"./modal-BR27MEf1.js";import"./cross-BXlnQeE0.js";import"./form-C3mZZqBW.js";import"./switch-sjHY-EbU.js";const L=M("calendarSlice/fetchCalendarData",async({current_year:l,next_year:a})=>{const{request:n}=$();return await n(`${k}Calendar/get-calendar/${l}/${a}/`,"GET",null,E())}),Z={data:null,loading:!1,innerLoading:!1,error:null},N=Y({name:"calendarSlice",initialState:Z,reducers:{changeDayType:(l,a)=>{function n(o,r){return o.id-r.id}l.data=l.data.map(o=>({year:o.year,months:o.months.map(r=>({month_number:r.month_number,month_name:r.month_name,days:r.days.map(t=>a.payload.filter(e=>e.id===t.id)[0]?{id:a.payload.filter(e=>e.id===t.id)[0]?.id,day_number:a.payload.filter(e=>e.id===t.id)[0]?.day_number,day_name:a.payload.filter(e=>e.id===t.id)[0]?.day_name,type_id:{type:a.payload.filter(e=>e.id===t.id)[0]?.type_name,color:a.payload.filter(e=>e.id===t.id)[0]?.type_color}}:t).sort(n),types:a.payload[0]?.month===r.month_number?[...r.types.map(t=>({color:t.color,type:t.type,days:t.days.map(e=>a.payload.sort(n).filter(d=>e.id===d.id)[0]?null:e).filter(e=>e)})),{type:a.payload[0]?.type_name,color:a.payload[0]?.type_color,days:a.payload}]:r.types}))}))},deleteDayType:(l,a)=>{function n(o,r){return o.id-r.id}l.data=l.data.map(o=>({year:o.year,months:o.months.map(r=>({month_number:r.month_number,month_name:r.month_name,days:r.days.map(t=>a.payload.filter(e=>e.id===t.id)[0]?{id:a.payload.filter(e=>e.id===t.id)[0]?.id,day_number:a.payload.filter(e=>e.id===t.id)[0]?.day_number,day_name:a.payload.filter(e=>e.id===t.id)[0]?.day_name,type_id:{type:a.payload.filter(e=>e.id===t.id)[0]?.type_name,color:a.payload.filter(e=>e.id===t.id)[0]?.type_color}}:t),types:r.types.map(t=>a.payload.filter(e=>e.type_name===t.type&&t.days.filter(d=>e.id===d.id)[0])[0]?{color:t.color,type:t.type,days:[a.payload.filter(e=>e.type_name===t.type)[0],...t.days].sort(n)}:{color:t.color,type:t.type,days:t.days.map(e=>a.payload.filter(d=>d.id===e.id)[0]?null:e).filter(e=>e)})}))}))}},extraReducers:l=>l.addCase(L.pending,a=>{a.loading=!0,a.error=null}).addCase(L.fulfilled,(a,n)=>{a.data=n.payload?.calendar,a.loading=!1,a.error=null}).addCase(L.rejected,(a,n)=>{a.loading=!1,a.error="error"})}),{changeDayType:ee,deleteDayType:ae}=N.actions,Se=N.reducer,te="_calendarList_1mi5e_1",re={calendarList:te},se=l=>{const{setActive:a,currentData:n,loading:o,data:r,onSubmit:t,isChanged:e,setIsChanged:d}=l,{request:_}=$(),I=q(),[b,A]=f.useState([]),[x,S]=f.useState(!1),[j,i]=f.useState(null),C=()=>{_(`${k}Calendar/delete-type/`,"DELETE",JSON.stringify({days:j}),E()).then(s=>{I(ae(s)),I(K({type:"success",status:!0,msg:`${s.length>1?"Kunlar":"Kun"} o'chirildi`})),S(!1)}).catch(s=>console.log(s))},D=s=>{i(s),S(!0)};f.useEffect(()=>{e?(A([]),d(!1)):b.length&&a(s=>({...s,days:b}))},[e,b]);const O=(s,c,g,y,m)=>{let p=g.map((h,H)=>{if(h.startId&&!h?.finishId){const P=h.startId<s?h.startId:s,T=h.startId<s?s:h.startId;return a(J=>({...J,finishValue:c,startId:P,finishId:T})),{startId:P,finishId:T}}else return!h?.startId&&g[H-1]?.finishId!==s?{startId:s}:h});const v=p[p.length-1].startId&&p[p.length-1].finishId?[...p,{}]:p;y(v),m([])};function B(s,c){let g=[...s].sort(F),y=0,m=[],p=[];const v=g.length+c<=35?35:42;for(;y<v;)y<c?m.push(""):y-c<g.length?m.push({id:g[y-c],value:g[y-c]}):m.push(""),m.length===7&&(p.push(m),m=[]),y=y+1;return p}function F(s,c){return s.id-c.id}const R=f.useCallback(()=>r&&[...r].map((s,c)=>u.jsx(W,{month:c,setActive:a,data:s.months,onActiveDays:O,sortWeeksDays:B,currentData:n.id===c?n:{},setSelected:A,onSubmit:t,isChanged:e,setIsChanged:d,onSubmitDelete:D},c)),[n,r]),V=o?u.jsx(G,{}):R();return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:re.calendarList,children:V}),u.jsx(X,{type:"danger",active:x,setActive:S,onClick:C})]})},le=l=>l.calendarSlice.data,de=l=>l.calendarSlice.loading,ne="_calendarPage_1oety_1",oe={calendarPage:ne},Ce=()=>{const{request:l}=$(),a=q(),{register:n,handleSubmit:o,setValue:r}=U(),t=w(le),e=w(de),[d,_]=f.useState({}),[I,b]=f.useState({}),[A,x]=f.useState(!1),S=new Date().getFullYear(),j=i=>{let C;b({...i,...d,color:i?.color??"black"}),d?.length?C={...i,days:d,color:i?.color??"black"}:d?.selected?.length?C={...i,days:d?.selected,color:i?.color??"black"}:C={...i,...d,color:i?.color??"black"},l(`${k}Calendar/change-type/`,"POST",JSON.stringify(C),E()).then(D=>{a(ee(D)),a(K({type:"success",status:!0,msg:`${D.length>1?"Kunlar":"Kun"} qo'shildi`}))}).catch(D=>console.log(D)),_({}),x(!0)};return f.useEffect(()=>{a(L({current_year:S,next_year:S+1}))},[]),u.jsxs("div",{className:oe.calendarPage,children:[u.jsx(z,{}),u.jsx(se,{setActive:_,currentData:I,loading:e,data:t,onSubmit:_,onDelete:i=>i([{}]),isChanged:A,setIsChanged:x}),u.jsx(Q,{active:d?.finishValue||d?.length,setActive:_,onSubmit:o(j),register:n,setValue:r,success:I})]})};export{Ce as CalendarPage,Se as calendarSlice};
