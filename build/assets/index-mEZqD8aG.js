import{j as e,d as de,T as q,r as t,u as O,be as fe,Q as ee,b as ge,n as oe,a as u,g as ie,h as te,A as z,i as $,ag as Se,bf as Ce,bg as ve,a7 as Te,B as P,z as R,bh as ye,I as Ne,R as ke,a4 as Be,f as Ge,L as Fe,a6 as Ae,bi as Ie,a8 as W,S as J,a9 as Pe,aa as De,ab as ze,bj as $e,bk as Me,F as we,ad as Ee}from"./index-9ggpSpOh.js";import{b as Le,g as Re,c as qe,a as Oe,d as He,G as Ve}from"./groupsList-DAlGWkvH.js";import{g as ue}from"./searchSelector-B3qtoac4.js";import{T as We,a as Je}from"./teachers-D4wmF5IE.js";import{P as he}from"./pagination-TgzvL7nQ.js";import{a as Ke,b as Ue,c as Ye,d as Qe,G as Xe,e as Ze,f as et}from"./groupTimeTableForm-CLKyagzA.js";import{a as tt}from"./roomsSelectors-BrI_i2qA.js";import{R as st}from"./radio-Cmxiq3vt.js";import"./editableCard-DGtksSRB.js";import"./groupProfileRating-Be7km1Dc.js";import"./confirmModal-Dyb-8OvR.js";import"./alert-CvHoYf_-.js";const X={},at=({currentTableData:n,loadingWithFilter:a})=>(console.log(n,"currentTableData"),e.jsx("div",{className:X.deletedGroups,children:a?e.jsx(de,{}):e.jsx("div",{className:X.table,children:e.jsxs(q,{extraClass:X.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Guruh Nomi"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Kurs Turi"}),e.jsx("th",{children:"Guruh narxi"})]})}),e.jsx("tbody",{children:n.map((o,m)=>e.jsxs("tr",{onClick:()=>navigate(`groupInfo/${o?.id}`),children:[e.jsx("td",{children:m+1}),e.jsx("td",{children:o?.name}),e.jsx("td",{children:o?.teacher}),e.jsx("td",{children:o?.students?.length}),e.jsx("td",{children:o?.price?o.price:"Sinfga hali narx belgilanmagan"})]}))})]})})})),nt=n=>n.deletedGroupsSlice?.data,rt="_mainContainer_1bjz4_1",ct="_mainContainer__container_1bjz4_4",lt="_mainContainer_buttonPanelBox_1bjz4_7",dt="_mainContainer_buttonPanelBox_leftCreateButton_1bjz4_10",ot="_mainContainer_filterPanelBox_1bjz4_13",it="_timeTable_1bjz4_17",ut="_mainContainer_filterPanelBox_leftFilterRadioGroupBox_1bjz4_20",ht="_activeFilter_1bjz4_25",_t="_mainError_1bjz4_29",xt="_table_1bjz4_37",jt="_table__box_1bjz4_48",mt="_table__container_1bjz4_59",pt="_table__inner_1bjz4_79",bt="_wrapper_1bjz4_83",ft="_studentBoxHeader_1bjz4_90",gt="_studentBoxTable_1bjz4_97",St="_studentBoxTable__inner_1bjz4_116",Ct="_studentBoxTable__input_1bjz4_121",vt="_status_1bjz4_129",Tt="_status__inner_1bjz4_138",l={mainContainer:rt,mainContainer__container:ct,mainContainer_buttonPanelBox:lt,mainContainer_buttonPanelBox_leftCreateButton:dt,mainContainer_filterPanelBox:ot,timeTable:it,mainContainer_filterPanelBox_leftFilterRadioGroupBox:ut,activeFilter:ht,mainError:_t,table:xt,table__box:jt,table__container:mt,table__inner:pt,wrapper:bt,studentBoxHeader:ft,studentBoxTable:gt,studentBoxTable__inner:St,studentBoxTable__input:Ct,status:vt,status__inner:Tt},le=[{name:"studying",label:"Students"},{name:"teachers",label:"Teachers"}],bs=()=>{t.useEffect(()=>{I(fe())},[]);const{request:n}=te(),{"*":a}=ee();localStorage.getItem("theme"),ge();const{register:o,handleSubmit:m}=oe();u(ie),u(tt);const v=u(Ke),T=u(Ue),p=u(Ye);u(Qe);const b=u(ue),[j,y]=t.useState(),[S,C]=t.useState(),[f,F]=t.useState([]),[k,_]=t.useState([]),[d,B]=t.useState(null),[M,A]=t.useState([]),[N,G]=t.useState(""),K=(s,h)=>{if(!d)B(h);else if(d!==h)return B(h),null;F(E=>E.filter(Q=>Q===s)[0]?E.filter(Q=>Q!==s):[...E,s])};t.useEffect(()=>{d&&n(`${z}Subjects/level-for-subject/${d}/`,"GET",null,$()).then(s=>{I(Se(s))}).catch(s=>console.log(s))},[d]);const[se,ae]=t.useState(!1),[ne,re]=t.useState([]),[D,U]=t.useState(le[0].name),[H,V]=t.useState(!1),[ce,r]=t.useState(!1),[x,i]=t.useState([]),[w,g]=t.useState(1);let Y=t.useMemo(()=>20,[]);const I=O(),_e=s=>{U(s)},xe=t.useMemo(()=>{const s=T?.slice();return g(1),b?s.filter(h=>h?.user?.name?.toLowerCase().includes(b.toLowerCase())||h?.user?.surname?.toLowerCase().includes(b.toLowerCase())):s},[T,b]);t.useEffect(()=>{a&&I(Ce({id:a})),n(`${z}TimeTable/week_days/`,"GET",null,$()).then(s=>{y(s?.days?.map(h=>({...h,name:h.name_uz})))}).catch(s=>console.log(s)),n(`${z}Group/course_types/`,"GET",null,$()).then(s=>{I(ve(s))}).catch(s=>console.log(s)),I(Te())},[a]);const je=s=>s.map((h,E)=>e.jsx(e.Fragment,{children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:E+1}),e.jsxs("td",{children:[h.user.surname," ",h.user.name]}),e.jsx("td",{children:h.user.age})]})})})),me=()=>v[S]?.students.map((s,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:h+1}),e.jsxs("td",{children:[s.user.surname," ",s.user.name]}),e.jsx("td",{children:s.user.age}),e.jsx("td",{children:s.user.registered_date}),e.jsx("td",{children:s.user.comment}),e.jsx("td",{children:s.extra_info.status?e.jsxs("div",{className:l.studentBoxTable__inner,children:[e.jsx("div",{className:l.status,children:e.jsx("div",{className:l.status__inner})}),e.jsx(Ne,{type:"checkbox",extraClassName:l.studentBoxTable__input,onChange:()=>K(s.id,v[S]?.id)})]}):null})]})),pe=()=>v.map((s,h)=>s.subject_status?e.jsxs("div",{onClick:()=>{V(!H),C(h)},className:l.table__box,children:[e.jsx("h2",{className:l.table__title,children:s.name??"Ingliz tili"}),e.jsx("div",{className:l.table__container,children:e.jsxs(q,{extraClass:l.table__inner,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"})]})}),je(s.students)]})})]}):null),be=t.useCallback(s=>{_([s])},[k]);return e.jsxs("div",{children:[e.jsxs("div",{className:l.mainContainer,children:[e.jsx("div",{className:l.mainContainer_buttonPanelBox,children:e.jsxs("div",{className:l.mainContainer_buttonPanelBox_leftCreateButton,children:[e.jsx(P,{onClick:()=>G("groupCreate"),type:D==="studying"?N==="groupAdd"?"filter":"btn":"filter",extraClass:l.extraCutClass,children:"Create group"}),e.jsx(P,{onClick:()=>G("groupAdd"),type:N==="groupAdd"?"btn":"filter",extraClass:l.noneBackground,children:"Add group"})]})}),e.jsx("div",{className:l.mainContainer_filterPanelBox,children:e.jsx(P,{extraClass:l.timeTable,onClick:()=>G("timeTable"),status:"timeTable",type:"login",children:"Time Table"})}),e.jsx("div",{className:l.mainContainer_filterPanelBox_leftFilterRadioGroupBox,children:le.map((s,h)=>e.jsx(st,{onChange:()=>_e(s.name),checked:D===s.name,extraClasses:D===s.name?l.activeFilter:null,children:s.label},h))})]}),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:l.mainError,children:p?.rooms&&p.rooms[0]?e.jsx("h1",{children:p.rooms[0]}):null}),e.jsx("div",{className:l.mainContainer,children:D==="studying"?e.jsx("div",{className:l.table,children:pe()}):e.jsxs("div",{className:l.mainContainer__container,children:[e.jsx(We,{data:x,setSelect:be,select:k}),e.jsx(he,{setCurrentTableData:i,users:xe,setCurrentPage:g,currentPage:w,pageSize:Y,onPageChange:s=>{g(s)},type:"custom"})]})})]}),e.jsx(R,{setActive:V,active:H,children:e.jsxs("div",{className:l.wrapper,children:[e.jsx("div",{className:l.studentBox,children:e.jsxs("div",{className:l.studentBoxHeader,children:[e.jsx("h1",{children:v[S]?.name}),e.jsx(ye,{})]})}),e.jsx("div",{className:l.studentBoxTable,children:e.jsxs(q,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Ism Familiya"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Reg.sana"}),e.jsx("th",{children:"Koment"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:me()})]})})]})}),e.jsx(Xe,{setActive:G,active:N==="timeTable",selectTime:M,setSelectTime:A,weekDays:j}),e.jsx(Ze,{setActive:G,active:N==="groupAdd"}),e.jsx(et,{setActive:G,active:N==="groupCreate",selectedStudents:f,selectedTeachers:k,selectedSubjectId:d,selectedTime:M})]})},yt=ke.memo(({active:n,setActive:a,setIsFilter:o,activeSwitch:m,setActiveSwitch:v,currentPage:T,pageSize:p})=>{const b=localStorage.getItem("selectedTeacher");u(Be);const j=u(Je),[y,S]=t.useState(b),C=O(),f=localStorage.getItem("branchId");return u(Le),localStorage.setItem("selectedTeacher",y),localStorage.setItem("selectedSwitch",`${m}`),t.useEffect(()=>{C(Ge({teacherId:y,userBranchId:f,deleted:m,pageSize:p,currentPage:T})),o(!0)},[y,m,T]),t.useEffect(()=>{f&&C(Fe({userBranchId:f}))},[f]),t.useEffect(()=>{C(Ae()),C(Ie())},[]),e.jsx(R,{active:n,setActive:a,children:e.jsxs("div",{className:W.filter,children:[e.jsx("h1",{children:"Filter"}),e.jsxs("div",{className:W.filter__container,children:[j&&e.jsx(J,{title:"Teacher",options:[{name:"Hamma",id:"all"},...j],extraClass:W.filter__select,onChangeOption:S,defaultValue:b}),e.jsxs("div",{className:W.filter__switch,children:[e.jsx("p",{children:"O’chirilgan"}),e.jsx(Pe,{activeSwitch:m,onChangeSwitch:v})]})]})]})})}),Z=De("filterGroups/fetchFilteredGroups",async n=>{const{request:a}=te();return await a(`${z}`,"POST",JSON.stringify(n),$())}),Nt={groups:null,teacherId:null,subjectId:null,typeId:null,isDelete:!1,loading:!1,error:null},kt=ze({name:"filterGroups",initialState:Nt,reducers:{getTeacherId:(n,a)=>{n.teacherId=a.payload},getSubjectId:(n,a)=>{n.subjectId=a.payload},getTypeId:(n,a)=>{n.typeId=a.payload},getIsDelete:(n,a)=>{n.isDelete=a.payload}},extraReducers:n=>n.addCase(Z.pending,a=>{a.loading=!0,a.error=null}).addCase(Z.fulfilled,(a,o)=>{a.groups=o.payload,a.loading=!1,a.error=null}).addCase(Z.rejected,(a,o)=>{a.loading=!1,a.error=o.payload??null})}),{getTeacherId:fs,getSubjectId:gs,getTypeId:Ss,getIsDelete:Cs}=kt.actions,Bt="_deletedGroups_1wcfg_1",Gt="_mainContainer_filterPanelBox_1wcfg_4",Ft="_table_1wcfg_9",L={deletedGroups:Bt,mainContainer_filterPanelBox:Gt,table:Ft},vs=()=>{const n=localStorage.getItem("selectedSwitch");O(),u(Re);const a=u(qe),o=u(nt);u(Oe);const m=u(He);u(ie);const[v,T]=t.useState([]),[p,b]=t.useState(!1),[j,y]=t.useState(n==="true"),[S,C]=t.useState(!1);u(ue);let f=t.useMemo(()=>50,[]);const[F,k]=t.useState(1);return t.useEffect(()=>{T(o)},[o]),console.log(a,"getFilteredGroups"),e.jsxs("div",{className:L.deletedGroups,children:[e.jsxs("div",{className:L.mainContainer_filterPanelBox,children:[e.jsx(P,{status:"filter",extraClass:L.extraCutClassFilter,onClick:()=>b(!p),type:"filter",children:"Filter"}),e.jsx(P,{type:"login",status:"timeTable",extraClass:L.extraCutClassFilter,onClick:()=>b(!0),children:"Time Table"})]}),e.jsxs("div",{className:L.table,children:[e.jsx("h2",{children:j?"Deleted Classes":"Classes"}),j?e.jsx(at,{loadingWithFilter:m,currentTableData:a?.results}):e.jsx(Ve,{loadingWithFilter:m,currentTableData:a?.results})]}),e.jsx(he,{totalCount:a?.count,setCurrentPage:k,currentPage:F,pageSize:f,onPageChange:_=>{k(_)},type:"custom"}),e.jsx(yt,{setIsFilter:C,activeSwitch:j,setActiveSwitch:y,setActive:b,active:p,pageSize:f,currentPage:F})]})},At=n=>n.groupAttendance?.attendance,It=n=>n.groupAttendance?.attendanceList,Pt=n=>n.groupAttendance?.loading,Dt="_attendance_1jo1b_1",zt="_attendance_end_1jo1b_4",$t="_attendance_end_select_1jo1b_8",Mt="_attendance_header_1jo1b_15",wt="_attendance_icon_1jo1b_28",Et="_attendance_check_1jo1b_31",Lt="_attendance_times_1jo1b_35",Rt="_attendance_plus_1jo1b_62",qt="_attendanceModal_1jo1b_89",Ot="_attendanceModal_header_1jo1b_92",Ht="_select_1jo1b_98",Vt="_attendedModal_1jo1b_102",Wt="_checkedStudents__item_1jo1b_108",Jt="_infoStudent_1jo1b_113",Kt="_typeChecked_1jo1b_119",Ut="_green_1jo1b_129",Yt="_red_1jo1b_132",Qt="_info_1jo1b_113",Xt="_button_1jo1b_140",Zt="_absent_1jo1b_144",es="_text_1jo1b_151",ts="_reason_1jo1b_161",ss="_check_1jo1b_108",as="_th_1jo1b_174",ns="_popup_1jo1b_177",c={attendance:Dt,attendance_end:zt,attendance_end_select:$t,attendance_header:Mt,attendance_icon:wt,attendance_check:Et,attendance_times:Lt,attendance_plus:Rt,attendanceModal:qt,attendanceModal_header:Ot,select:Ht,attendedModal:Vt,checkedStudents__item:Wt,infoStudent:Jt,typeChecked:Kt,green:Ut,red:Yt,info:Qt,button:Xt,absent:Zt,text:es,reason:ts,check:ss,th:as,popup:ns},Ts=()=>{const[n,a]=t.useState(!1),[o,m]=t.useState(!1),[v,T]=t.useState(null),[p,b]=t.useState(null),j=u(It),y=u(Pt),{id:S}=ee(),C=O();t.useEffect(()=>{C($e(S))},[]);const f=_=>{if(_)return _?.map(d=>{if(d.status===!0)return e.jsx("td",{className:"date true",children:e.jsx("i",{style:{color:"green",fontSize:"3rem"},className:" fas fa-check"})});if(d.status===!1)return e.jsx("td",{children:e.jsxs("div",{className:c.th,children:[e.jsx("i",{className:`fas fa-times ${c.check}`}),d.reason?e.jsx("div",{className:c.popup,children:d.reason}):null]})});if(d.status==="")return e.jsx("td",{className:"date true"})})},k=j?.students?.students?.map((_,d)=>e.jsxs("tr",{children:[e.jsx("td",{children:d+1}),e.jsxs("td",{children:[_?.name," ",_?.surname]}),f(_.days)]}));return e.jsxs("div",{className:c.attendance,children:[e.jsxs("div",{className:c.attendance_header,children:[e.jsx("h2",{children:"Davomat "}),e.jsxs("div",{className:c.attendance_end,children:[e.jsxs("div",{className:c.attendance_end_select,children:[e.jsx(J,{extraClass:c.select,options:j?.students?.years?.map(_=>_?.year),onChangeOption:b,defaultValue:j?.students?.years[0]?.year}),p?e.jsx(J,{extraClass:c.select,options:j?.students?.years?.filter(_=>_?.year===+p)[0]?.month,onChangeOption:T,defaultValue:j?.students?.years[0]?.month}):null]}),e.jsx("div",{onClick:()=>m(!o),className:`${c.attendance_plus} fa fa-plus`})]})]}),e.jsx("div",{children:e.jsxs(q,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"Ism Familya"}),j?.students?.days.map(_=>e.jsx("th",{children:_}))]})}),e.jsx("tbody",{children:y?e.jsx(de,{}):k})]})}),e.jsx(rs,{active:o,setActive:m})]})},rs=({active:n,setActive:a})=>{const{id:o}=ee(),m=O(),{request:v}=te(),[T,p]=t.useState(!1),[b,j]=t.useState(""),[y,S]=t.useState(!1),[C,f]=t.useState(),{register:F,handleSubmit:k,setValue:_}=oe(),[d,B]=t.useState([]);t.useEffect(()=>{m(Me(o))},[]);const M=o,A=u(At),[N,G]=t.useState(null),K=r=>{G(r);const x={date:`${A.month_number}-${r}`};v(`${z}Attendance/school-to-attend-days/${M}/`,"POST",JSON.stringify(x),$()).then(i=>{B(i.students)}).catch(i=>{console.log(i)})},se=r=>{B(x=>x.map(i=>i.id===r?{...i,attended:!0,typeChecked:"yes",reason:"",scores:{}}:i))},ae=()=>d?.length>0?d?.map((r,x)=>{if(!r.attended)return e.jsxs("tr",{children:[e.jsx("td",{children:x+1}),e.jsxs("td",{children:[r?.name," ",r?.surname]}),e.jsx("td",{children:e.jsxs("div",{className:c.attendance_icon,children:[e.jsx("i",{onClick:()=>se(r?.id),className:`${c.attendance_check} fa fa-check`}),e.jsx("div",{onClick:()=>{S(!0),f(r.id)},className:"check__btn no",children:e.jsx("i",{className:`${c.attendance_times} fa fa-times`})})]})})]})}):e.jsxs(e.Fragment,{children:[e.jsx("td",{}),e.jsxs("td",{children:[" ",N?"Bu kunda hamma studentlar davomat qilingan":"Studentlar yo'q (kun tanlang)"]})]}),ne=r=>{B(x=>x.map(i=>i.id===r?{...i,attended:!1}:i))},re=t.useCallback(()=>d?.length>=0?d.map(r=>{if(r.attended)return e.jsxs("div",{className:c.checkedStudents__item,onClick:()=>ne(r.id),children:[e.jsxs("div",{className:c.infoStudent,children:[e.jsxs("div",{className:c.info,children:[e.jsx("span",{children:r.name}),e.jsx("span",{children:r.surname})]}),e.jsx("div",{className:c.typeChecked,children:r.typeChecked==="yes"?e.jsx("i",{className:`fas fa-plus-circle ${c.green} `}):e.jsx("i",{className:`fas fa-minus-circle ${c.red}`})})]}),r.reason?e.jsx("div",{className:c.reason,children:r.reason}):null]})}):e.jsx("h1",{children:"Studentlar yoq"}),[d]),D=({id:r,requestType:x,requestMsg:i})=>{B(w=>w.map(g=>r===g.id?{...g,requestType:x,requestMsg:i}:g))},U=r=>{_("reason",""),B(x=>x.map(i=>i.id===C?{...i,attended:!0,typeChecked:"no",reason:r.reason,date:{day:N},scores:{}}:i)),S(!1)},H=r=>{r.preventDefault(),d.map(x=>{if(x.attended){const i={date:`${A.month_number}-${N}`,students:[{...x,status:!x.reason}],group:Number(M),teacher:A.teachers},w=i?.students?.map(g=>g.id);D({id:x.id,requestType:"loading"}),v(`${z}Attendance/to_attend_school/${w}/`,"POST",JSON.stringify(i),$()).then(g=>{B(Y=>Y.filter(I=>I.id!==g.id)),p(!1)}).catch(g=>{console.log(g,"err")})}})},V=ae(),ce=re();return e.jsxs(e.Fragment,{children:[e.jsxs(R,{active:n,setActive:a,children:[e.jsxs("div",{className:c.attendanceModal,children:[e.jsx("h2",{children:A?.month}),e.jsxs("div",{className:c.attendanceModal_header,children:[e.jsx(J,{extraClass:c.select,options:A?.weekdays,onChangeOption:K,defaultValue:N}),e.jsx(P,{onClick:()=>p(!0),children:"Davomat qilinganlar"})]})]}),e.jsx("div",{children:e.jsxs(q,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Ism Familiya"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:V})]})})]}),e.jsxs(R,{active:T,setActive:p,children:[e.jsx("h2",{className:c.attended_title,children:"Davomat qilinganlar"}),e.jsxs("div",{className:c.attendedModal,children:[e.jsx("div",{className:"checkedStudents",children:d?.filter(r=>r?.attended)?.length===0?e.jsx("h1",{children:"Studentlar davomat qilinmagan"}):null}),ce,d?.filter(r=>r?.attended)?.length===0?null:e.jsx(P,{extraClass:c.button,type:N?"":"disabled",onClick:H,children:"Kritish"})]})]}),e.jsxs(R,{id:"1",active:y,setActive:S,children:[e.jsxs("div",{className:c.text,children:["Izoh qoldirish ",e.jsx("br",{})," ",e.jsx("div",{children:"( student kemaganligi haqida )"})," "]}),e.jsx("div",{className:c.absent,children:e.jsx(we,{onSubmit:k(U),children:e.jsx(Ee,{register:F,name:"reason",id:"comment"})})})]})]})};export{Ts as GroupAttendance,bs as GroupCreatePage,vs as GroupsPage};
