import{a as O,u as V,A as y,h as v,b as be,n as p,f as je,l as ye,r as m,o as Ce,j as e,p as h,I as o,M as Se,B as Te,c as Ne}from"./index-Cux8sda1.js";import{u as Oe}from"./index.esm-DQmSsb0O.js";import{f as ve}from"./vacancyPageParseSlice-DZBjzMqT.js";import{g as ke}from"./index-B3t1prr3.js";import{T as qe}from"./textArea-1604NtUh.js";import{o as H}from"./alertSlice-XeBTN8B3.js";import"./modal-BR27MEf1.js";import"./form-C3mZZqBW.js";import"./educationSlice-Dccsl4fS.js";import{g as we}from"./systemSelector-CUSI55rJ.js";import{A as X}from"./workerSelect-N9ju4zO7.js";import"./index-CO9axSa1.js";import{m as De,i as Ue,d as Ee,n as Ae,f as Fe,o as Me,p as Ve,l as Ie}from"./oftenUsedSelector-B4R2CTqR.js";import"./userProfileSlice-BflEK4KO.js";import{b as $e}from"./index-B-IQsIPc.js";import"./cross-BXlnQeE0.js";import"./Transition-CosWKtpf.js";import"./user_image-CruVt77w.js";const I=()=>{const c=sessionStorage.getItem("token");return c||null},w=O("user/registerUser",async(c,s)=>{const t=I();if(!t)return s.rejectWithValue("No authorization token found");try{const i=await fetch(`${y}Students/students_create/`,{method:"POST",headers:{...v,Authorization:`JWT ${t}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw new Error("Failed to register user");return await i.json()}catch(i){return s.rejectWithValue(i.message)}}),N=O("user/registerTeacher",async({res:c,file:s},t)=>{const i=I();if(delete c?.user?.resume,!i)return t.rejectWithValue("No authorization token found");try{const g=await fetch(`${y}Teachers/teachers/create/`,{method:"POST",headers:{...v()},body:JSON.stringify(c)});if(!g.ok)throw new Error("Failed to register teacher");return await g.json()}catch(g){return t.rejectWithValue(g.message)}}),Le=O("user/registerTeacherImage",({id:c,file:s})=>{const{request:t}=V(),i=new FormData;return i.append("file",s),t(`${y}Teachers/upload-file/?username=${c}`,"POST",i,be())}),D=O("user/registerEmployer",async(c,s)=>{const t=I();if(!t)return s.rejectWithValue("No authorization token found");try{const i=await fetch(`${y}Users/users/create/`,{method:"POST",headers:{...v,Authorization:`JWT ${t}`,"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw new Error("Failed to register employer");return await i.json()}catch(i){return s.rejectWithValue(i.message)}}),U=O("user/fetchCategories",c=>{const{request:s}=V();return s(`${y}Teachers/salary-types/?branch=${c}`,"GET",null,v())}),ze=c=>c.registerUser.categories,Je="_registerBtn_1mt0n_1",We="_login_1mt0n_5",Be="_login__boxes_1mt0n_14",Re="_login__boxes__login__box_1mt0n_22",Pe="_login__boxes__box_1mt0n_26",Ke="_login__boxes__box__headerTitle_1mt0n_31",Ge="_login__boxes__box__form_1mt0n_35",He="_login__aside_1mt0n_44",Xe="_login__aside__img_1mt0n_52",Qe="_selection_1mt0n_58",Ye="_extraClasss_1mt0n_63",Ze="_extraClasses_1mt0n_67",es="_multiSelect_1mt0n_71",ss="_resume_1mt0n_76",ts="_resume__input_1mt0n_81",as="_mess_1mt0n_85",rs="_errorMess_1mt0n_89",ns="_successMess_1mt0n_96",os="_seriya_1mt0n_103",a={registerBtn:Je,login:We,login__boxes:Be,login__boxes__login__box:Re,login__boxes__box:Pe,login__boxes__box__headerTitle:Ke,login__boxes__box__form:Ge,login__aside:He,login__aside__img:Xe,selection:Qe,extraClasss:Ye,extraClasses:Ze,multiSelect:es,resume:ss,resume__input:ts,mess:as,errorMess:rs,successMess:ns,seriya:os},is="/assets/reg__bg-CnMNd682.svg",ls={types:[{value:"student",name:"Student"},{value:"teacher",name:"Teacher"},{value:"employer",name:"Employer"}]},Q=[{id:1,name:"1 smen"},{id:2,name:"2 smen"},{id:3,name:"hamma vaqt"}],ws=()=>{const s=p(ke)?.map(r=>({id:r.group.id,name:r.group.name}))||[],t=p(De),i=p(Ue),g=p(Ee),$=p(Ae),{register:n,handleSubmit:Y,watch:L,setValue:l,reset:ms}=Oe(),x=L("registerType","student"),E=L("username","");je(),p(we);const f=JSON.parse(localStorage.getItem("selectedSystem"));localStorage.getItem("selectedBranch");const Z=p(ze),_=ye(),[us,ee]=m.useState(!1),[se,A]=m.useState(1),[z,J]=m.useState(1),[te,W]=m.useState(1),[ae,B]=m.useState(1),[re,ne]=m.useState(1),[oe,ie]=m.useState(),[le,ce]=m.useState(),[me,F]=m.useState(!1),{request:ue}=V(),[R,C]=m.useState(""),[P,S]=m.useState(!0),de=Array.isArray(t)?t:[t],[_e,ge]=m.useState(""),b=p(Ce),k=p($e),K=de?.map(r=>({value:r?.id,label:r?.name})),pe=s.filter(r=>r.name.toLowerCase()!=="admin"&&r.name.toLowerCase()!=="director");m.useEffect(()=>{k&&k?.job&&ge(k.job.toString())},[k]);const G=r=>{J(r)};m.useEffect(()=>{b&&(_(Fe()),_(Me()),_(Ve({branch:b.id})),_(Ie({branch:b.id})),_(U(b.id))),l("password",12345678)},[b]),m.useEffect(()=>{_(ve())},[]),m.useEffect(()=>{E?(async()=>{try{const T=await await ue(`${y}Users/username-check/`,"POST",JSON.stringify({username:E}),v());T.exists===!0?(C(e.jsxs("p",{className:a.errorMess,children:[e.jsx("i",{className:"fa-solid fa-circle-exclamation",style:{color:"#f15c5c"}}),"Username band"]})),S(!1)):T.exists===!1&&(C(e.jsxs("p",{className:a.successMess,children:[e.jsx("i",{className:"fa-solid fa-circle-check"}),"Username bo'sh"]})),S(!0))}catch(q){console.error("Error checking username:",q),C("Error checking username"),S(!1)}})():(C(e.jsx("p",{children:"Username kiriting"})),S(!1))},[E]);const he=r=>{if(!P)return;F(!0);const q=Q.find(d=>d.id===Number(te)),T=i.find(d=>d.id===Number(se));let u={user:{...r,observer:!0,language:T?.id,branch:b.id}},M={...r,observer:!0,language:T?.id||"",branch:b.id},j;if(x==="student"){let d;f?.name==="school"?d={class_number:re,parents_fullname:r.parents_fullname,old_school:r.old_school,parent_region:r.parent_region,district:r.district,parent_seria:r.parent_seria,parent_seria_num:r.parent_seria_num,region:r.region,born_date:r.born_date,student_seria_num:r.student_seria_num,student_seria:r.student_seria}:d={subject:z.map(fe=>fe.value)||null},u={...u,shift:q?.id||"",parents_number:r.parents_phone,...d},j=w(u)}else x==="teacher"?f?.name==="school"?(u={...u,total_students:1212,color:"red",class_type:+oe,teacher_salary_type:le,subject:z.map(d=>d.value)||null},j=N({res:u,file:u?.user?.resume})):(u={...u,total_students:1212},j=N(u)):x==="employer"&&(M={...M,profession:Number(ae)},j=D(M));j&&(x==="teacher"&&f?.name==="school"&&_(Le({id:u?.user?.username,file:u?.user?.resume})),_(j).then(d=>{F(!1),d.type.endsWith("fulfilled")?(_(H({type:"success",status:!0,msg:`${x} muvofaqqiyatli qo'shildi`})),J(1),W(1),B(1),C(""),S(!0),l("name",""),l("surname",""),l("username",""),l("parents_fullname",""),l("parent_seria",""),l("parent_seria_num",""),l("parent_region",""),l("born_date",""),l("father_name",""),l("parents_phone",""),l("phone",""),l("student_seria_num",""),l("student_seria",""),l("old_school",""),l("region",""),l("district",""),l("birth_date",""),l("comment","")):(_(H({type:"error",status:!0,msg:"Internet yoki serverda xatolik qayta urinib ko'ring"})),ee(!0),F(!1))}))},xe=()=>{switch(x){case"student":return e.jsxs(e.Fragment,{children:[e.jsx(h,{extraClass:a.extraClasses,title:"Til",name:"language",onChangeOption:A,options:i,defaultValue:i[0]?.id}),f?.name==="school"?e.jsxs(e.Fragment,{children:[e.jsx(h,{extraClass:a.extraClasses,title:"Sinf",name:"class_number",onChangeOption:ne,options:g,defaultValue:g[0]?.id}),e.jsx(o,{register:n,placeholder:"Ota-ona telefon raqami",type:"number",required:!0,name:"parents_phone"}),e.jsx(o,{register:n,name:"parents_fullname",placeholder:"ota-ona fio"}),e.jsxs("div",{className:a.seriya,children:[e.jsx(o,{register:n,name:"parent_seria",placeholder:"passport seriya"}),e.jsx(o,{register:n,name:"parent_seria_num",placeholder:"seriya raqami",type:"number"})]}),e.jsx(o,{register:n,name:"born_date",placeholder:"tug'ilgan yili ",type:"date"}),e.jsx(o,{register:n,name:"parent_region",placeholder:"yashash joyi"})]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{options:K,onChange:G,extraClass:a.multiSelect,fontSize:15}),e.jsx(h,{title:"Kelish vaqti",extraClass:a.extraClasses,name:"shift",onChangeOption:W,options:Q})]})]});case"teacher":return e.jsxs(e.Fragment,{children:[e.jsx(h,{extraClass:a.extraClasses,name:"language",title:"Til",onChangeOption:A,options:i}),e.jsx(X,{options:K,onChange:G,extraClass:a.multiSelect,fontSize:15}),f?.name==="school"&&e.jsxs(e.Fragment,{children:[e.jsx(h,{extraClass:a.extraClasses,name:"category",options:Z,onChangeOption:ce,title:"Toifa"}),e.jsx(h,{extraClass:a.extraClasses,name:"class_type",options:$,onChangeOption:ie,title:"Sinf turi"}),e.jsxs("div",{className:a.resume,children:[e.jsx("h2",{style:{textAlign:"left",fontSize:"2rem"},children:"Resume"}),e.jsx(o,{type:"file",name:"file",register:n,extraClassName:a.resume__input})]})]})]});case"employer":return e.jsxs(e.Fragment,{children:[e.jsx(h,{extraClass:a.extraClasses,name:"language",onChangeOption:A,options:i}),e.jsx(h,{extraClass:a.extraClasses,name:"profession",onChangeOption:B,options:_e==="director"?s:pe}),e.jsxs("div",{className:a.resume,children:[e.jsx("h2",{style:{textAlign:"left",fontSize:"2rem"},children:"Resume"}),e.jsx(o,{type:"file",name:"resume",register:n,extraClassName:a.resume__input})]})]})}};return e.jsxs("div",{className:a.login,children:[e.jsx("div",{className:a.selection,children:e.jsx(h,{defaultValue:"student",options:ls.types,onChangeOption:r=>l("registerType",r)})}),e.jsxs("div",{className:a.login__boxes,children:[e.jsxs("div",{className:a.login__boxes__login__box,children:[e.jsx("h1",{className:a.login__boxes__box__headerTitle,children:"Registratsiya"}),e.jsx("div",{className:a.login__boxes__box__form,children:e.jsxs("form",{onSubmit:Y(he),children:[e.jsx(o,{title:R&&e.jsx("p",{className:a.mess,children:R}),register:n,placeholder:"Username",required:!0,extraClassName:a.extraClasss,name:"username"}),e.jsx(o,{register:n,placeholder:"Ism",required:!0,name:"name"}),e.jsx(o,{register:n,placeholder:"Familiya",required:!0,name:"surname"}),e.jsx(o,{register:n,placeholder:"Otasi ismi",required:!0,name:"father_name"}),f?.name==="school"&&x==="student"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:a.seriya,children:[e.jsx(o,{register:n,name:"student_seria",placeholder:"seriya"}),e.jsx(o,{name:"student_seria_num",register:n,type:"number",placeholder:"metrka raqami"})]}),e.jsx(o,{register:n,name:"old_school",placeholder:"kelgan maktabi"}),e.jsx(o,{register:n,name:"region",placeholder:"Xudud nomi"}),e.jsx(o,{register:n,name:"district",placeholder:"Tuman shaxar nomi"})]}):null,e.jsx(o,{register:n,placeholder:"Parol",required:!0,type:"password",name:"password"}),e.jsx(o,{register:n,placeholder:"Tug'ilgan kun",type:"date",required:!0,name:"birth_date"}),e.jsx(o,{register:n,placeholder:"Telefon raqami",type:"number",required:!0,name:"phone"}),f?.name==="center "&&x==="student"?e.jsx(o,{register:n,placeholder:"Ota-ona telefon raqami",type:"number",required:!0,name:"parents_phone"}):null,e.jsx(qe,{register:n,placeholder:"Kommentariya",name:"comment"}),xe(),me?e.jsx(Se,{}):e.jsx(Te,{type:P?"submit":"disabled",extraClass:a.registerBtn,children:"Register"})]})})]}),e.jsx("div",{className:a.login__aside,children:e.jsx("img",{className:a.login__aside__img,src:is,alt:""})})]})]})},cs=Ne({name:"user",initialState:{user:null,status:"idle",error:null,subjects:[],languages:[],categories:[]},reducers:{},extraReducers:c=>{c.addCase(w.pending,s=>{s.status="loading"}).addCase(w.fulfilled,(s,t)=>{s.status="succeeded",s.user=t.payload}).addCase(w.rejected,(s,t)=>{s.status="failed",s.error=t.error.message}).addCase(N.pending,s=>{s.status="loading"}).addCase(N.fulfilled,(s,t)=>{s.status="succeeded",s.user=t.payload}).addCase(N.rejected,(s,t)=>{s.status="failed",s.error=t.error.message}).addCase(D.pending,s=>{s.status="loading"}).addCase(D.fulfilled,(s,t)=>{s.status="succeeded",s.user=t.payload}).addCase(D.rejected,(s,t)=>{s.status="failed",s.error=t.error.message}).addCase(U.pending,s=>{s.status="loading"}).addCase(U.fulfilled,(s,t)=>{s.status="succeeded",s.categories=t.payload}).addCase(U.rejected,(s,t)=>{s.status="failed",s.error=t.error.message})}}),Ds=cs.reducer;export{ws as default,Ds as registerUser};
