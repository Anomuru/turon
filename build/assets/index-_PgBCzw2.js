import{b as H,j as e,T as V,u as $,a as m,r as s,bm as Ce,e as Z,h as U,A as O,i as J,o as te,bn as pe,B as F,z as Q,d as q,I as Y,bo as se,R as be,a3 as ae,bp as ve,bq as ye,br as Be,a6 as Ne,a7 as ne,a8 as w,S as P,a9 as we,aa as Fe,ab as Ae,bs as De,n as Ie,g as Pe,bt as ke,bu as Te,bv as Re,bw as Le,bx as qe,by as $e,D as Oe,bz as Ee,F as Me,bA as Ge}from"./index-BsgSvAdU.js";import{C as ze}from"./classAddForm-HG6pC1F7.js";import{h as Ye,i as He,j as Ve,k as Ue,l as Je,m as Qe,N as Ke}from"./groupTimeTableForm-BuekFSQy.js";import{d as We}from"./groupProfileRating-DV-tGUzb.js";import{P as Xe}from"./pagination-BKwMBOPR.js";import"./teachers-DrGBaRUy.js";import"./editableCard-Bs3BilNV.js";import{C as Ze}from"./confirmModal-UuIEyXZr.js";import{R as re}from"./radio-BzA6NWHx.js";import{g as et}from"./brachSwitcherSelector-vlhkEAq9.js";import{g as tt}from"./searchSelector-B3qtoac4.js";import"./alert-LUec3lF-.js";import"./groupsList-CDYximbb.js";import"./roomsSelectors-BrI_i2qA.js";const G={},st=({currentTableData:l})=>{const a=H(),c=()=>l?.map((n,d)=>e.jsxs("tr",{onClick:()=>a(`profile/${n?.id}`),children:[e.jsx("td",{children:d+1}),e.jsxs("td",{children:[n?.user?.name," ",n?.user?.surname]}),e.jsx("td",{children:n?.user?.age}),e.jsx("td",{children:n?.user?.phone}),e.jsx("td",{children:n?.group?.name?n.group.name:`${n?.class_number} ${n?.group?.color}`}),e.jsx("td",{children:e.jsx("div",{style:{width:"fit-content",border:n.color?`2px solid #${n.color}`:"2px solid black",color:`${n.color}`,padding:"1.5rem",borderRadius:"10px"},children:n.debt})})]},n.id));return e.jsx("div",{className:G.students,children:e.jsx("div",{className:G.table,children:e.jsxs(V,{extraClass:G.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nomer"}),e.jsx("th",{children:"Guruh nomi"}),e.jsx("th",{children:"Qarzi "})]})}),e.jsx("tbody",{children:c()})]})})})},at="_deletedStudents_9pq9e_1",nt="_deletedStudents__menu_9pq9e_11",rt="_active_9pq9e_25",N={deletedStudents:at,deletedStudents__menu:nt,active:rt},lt=({currentTableData:l})=>{const a=$(),c=m(We),[n,d]=s.useState("all"),[i,g]=s.useState([]),[h,v]=s.useState([]),_=H(),[p,u]=s.useState(!1),[f,S]=s.useState(!1);s.useEffect(()=>{a(Ce())},[]);const{request:A}=U(),o=()=>{A(`${O}Students/delete-student-from-deleted/${f}/`,"DELETE",null,J()).then(t=>{a(te({type:"success",status:!0,msg:t.msg}))}),u(!1),a(pe(f))},x=()=>l?.map((t,j)=>n==="all"?e.jsxs("tr",{children:[e.jsx("td",{children:j+1}),e.jsxs("td",{onClick:()=>_(`profile/${t?.student?.id}`),children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{S(t.student.id),u(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):t?.group_reason?.id===n?e.jsxs("tr",{onClick:()=>_(`profile/${t.id}`),children:[e.jsx("td",{children:j+1}),e.jsxs("td",{children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{S(t.student.id),u(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):null);return e.jsxs("div",{className:N.deletedStudents,children:[e.jsxs("ul",{className:N.deletedStudents__menu,children:[e.jsx("li",{className:Z(N.other__item,{[N.active]:n==="all"}),onClick:()=>{d("all")},children:"Hammasi"},6),c?.map((t,j)=>e.jsx("li",{className:Z(N.other__item,{[N.active]:n===t.id}),onClick:()=>{d(t.id)},children:t.name},j))]}),e.jsx("div",{className:N.table,children:e.jsxs(V,{extraClass:N.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nome"}),e.jsx("th",{children:"Guruh"}),e.jsx("th",{children:"Reg.sana"}),e.jsx("th",{children:"O'chir.sana"}),e.jsx("th",{children:"Sabab"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:x()})]})}),e.jsx(Ze,{onClick:o,title:"Qaytarish",text:"Studentni rostanham qaytarmoqchimisiz",type:"danger",active:p,setActive:u})]})},dt="_mainContainer_1agrm_1",ct="_mainContainer_buttonPanelBox_1agrm_4",ot="_mainContainer_buttonPanelBox_leftCreateButton_1agrm_8",it="_mainContainer_filterPanelBox_1agrm_11",ut="_mainContainer_filterPanelBox_rightFilterRadioGroupBox_1agrm_15",ht="_activeFilter_1agrm_20",B={mainContainer:dt,mainContainer_buttonPanelBox:ct,mainContainer_buttonPanelBox_leftCreateButton:ot,mainContainer_filterPanelBox:it,mainContainer_filterPanelBox_rightFilterRadioGroupBox:ut,activeFilter:ht},_t=({onChange:l,selectedRadio:a,peoples:c,setActive:n,onClick:d})=>{const i=m(et),g=H();return e.jsxs("div",{className:B.mainContainer,children:[e.jsx("div",{className:B.mainContainer_buttonPanelBox,children:e.jsxs("div",{className:B.mainContainer_buttonPanelBox_leftCreateButton,children:[e.jsx(F,{type:"filter",extraClass:B.extraCutClass,onClick:()=>d("create"),children:"Create Class"}),e.jsx(F,{onClick:()=>d("add"),type:"filter",extraClass:B.noneBackground,children:"Add class"}),e.jsx(F,{onClick:()=>g("RGBData"),type:"filter",children:"RB-Baza"})]})}),e.jsxs("div",{className:B.mainContainer_filterPanelBox,children:[e.jsx(F,{status:"filter",extraClass:B.extraCutClassFilter,onClick:()=>n("filter"),type:"filter",children:"Filter"}),e.jsx("a",{style:{color:"white"},href:`${O}Students/export-students/?branch=${i?.id}&format=json`,children:e.jsx(F,{type:"simple",children:"Exel"})}),e.jsx("div",{className:B.mainContainer_filterPanelBox_rightFilterRadioGroupBox,children:c.map((h,v)=>e.jsx(re,{onChange:()=>l(h.name),checked:a===h.name,extraClasses:a===h.name?B.activeFilter:null,children:h.label},v))})]})]})},xt="_createClass_s3igw_1",mt="_createClass__input_s3igw_6",gt="_createClass__btn_s3igw_9",jt="_createClass__inner_s3igw_13",L={createClass:xt,createClass__input:mt,createClass__btn:gt,createClass__inner:jt},ft=s.memo(l=>{const{active:a,setActive:c,data:n,branch:d,deactiveModal:i}=l,{request:g}=U(),h=$(),v=m(Ye),_=m(He),[p,u]=s.useState([]);s.useEffect(()=>{u([])},[v]);const f=()=>{const o={...n,students:p};g(`${O}Group/groups/create/`,"POST",JSON.stringify(o),J()).then(x=>{h(te({type:"success",status:!0,msg:"Sinf yaratildi"})),h(se({userBranchId:d})),c(!1),i(!1)})},A=_==="loading"||_==="idle"?e.jsx(q,{}):v?.map((o,x)=>e.jsxs("tr",{children:[e.jsx("td",{children:x+1}),e.jsxs("td",{children:[o.user?.surname," ",o.user?.name]}),e.jsx("td",{children:o.user?.age}),e.jsx("td",{children:o.user?.language}),e.jsx("td",{children:o?.class_number}),e.jsx("td",{children:o.user?.registered_date}),e.jsx("td",{children:e.jsx(Y,{extraClassName:L.createClass__input,type:"checkbox",onChange:()=>u(t=>t.filter(j=>j===o.id)[0]?t.filter(j=>j!==o.id):[...t,o.id])})})]}));return e.jsx(Q,{active:a,setActive:c,children:e.jsxs("div",{className:L.createClass,children:[e.jsx("h1",{children:"O'quvchi tanlang"}),e.jsx("div",{className:L.createClass__inner,children:e.jsxs(V,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:A})]})}),e.jsx(F,{onClick:f,extraClass:L.createClass__btn,children:"Create"})]})})}),St=be.memo(({active:l,setActive:a,activePage:c,setIsFilter:n,branchId:d})=>{const i=localStorage.getItem("selectedLang"),g=localStorage.getItem("ageFrom"),h=localStorage.getItem("ageTo"),v=localStorage.getItem("studentSwitch"),[_,p]=s.useState(g!==null?g:""),[u,f]=s.useState(h!==null?h:""),[S,A]=s.useState(i),[o,x]=s.useState(v==="true"),t=$(),j=m(ae);localStorage.setItem("selectedLang",S),localStorage.setItem("ageFrom",_),localStorage.setItem("ageTo",u),localStorage.setItem("studentSwitch",`${o}`);const D=localStorage.getItem("branchId");console.log(g,h),s.useEffect(()=>{t(c==="studying_students"?ve({langId:i,fromAge:_,untilAge:u,userBranchId:D}):c==="new_students"?o?ye({langId:i,fromAge:_,untilAge:u,userBranchId:D}):se({langId:i,fromAge:_,untilAge:u,userBranchId:D}):Be({langId:i,fromAge:_,untilAge:u,userBranchId:D}))},[S,u,_,c,o]);const I=y=>{p(y.target.value)},E=y=>{f(y.target.value)};return s.useEffect(()=>{t(Ne()),t(ne())},[t]),e.jsx(Q,{active:l,setActive:a,children:e.jsxs("div",{className:w.filter,children:[e.jsx("h1",{children:"Filter"}),e.jsxs("div",{className:w.filter__container,children:[e.jsxs("div",{className:w.filter__age,children:[e.jsx(Y,{type:"number",extraClassName:w.filter__input,placeholder:"Yosh (От)",onChange:y=>p(y.target.value),onBlur:I,defaultValue:_}),e.jsx(Y,{type:"number",extraClassName:w.filter__input,placeholder:"Yosh (До)",onChange:y=>f(y.target.value),onBlur:E,defaultValue:u})]}),e.jsx(F,{type:"danger",onClick:()=>{f(null),p(null)},children:"Clear (Yoshlarni tozalash)"}),e.jsx(P,{title:"Til",options:[{name:"Hamma",id:"all"},...j],extraClass:w.filter__select,onChangeOption:A,defaultValue:i}),c==="new_students"&&e.jsxs("div",{className:w.filter__switch,children:[e.jsx("p",{children:"O’chirilgan"}),e.jsx(we,{onChangeSwitch:x,activeSwitch:o})]})]})]})})}),z=Fe("filterStudents/fetchFilteredStudents",async l=>{const{request:a}=U();return await a(`${O}`,"POST",JSON.stringify(l),J())}),Ct={students:null,loading:!1,error:null};Ae({name:"filterStudents",initialState:Ct,reducers:{},extraReducers:l=>l.addCase(z.pending,a=>{a.loading=!0,a.error=null}).addCase(z.fulfilled,(a,c)=>{a.students=c.payload,a.loading=!1,a.error=null}).addCase(z.rejected,(a,c)=>{a.loading=!1,a.error=c.payload??null})});const pt=(l,a)=>{localStorage.setItem(l,a)},bt=l=>localStorage.getItem(l),vt="_tableMain_c2dxc_1",yt="_modal_c2dxc_16",Bt="_modal__error_c2dxc_21",Nt="_modal__form_c2dxc_26",wt="_modal__select_c2dxc_31",Ft="_modal__radios_c2dxc_34",At="_modal__inner_c2dxc_40",Dt="_modal__item_c2dxc_46",C={tableMain:vt,modal:yt,modal__error:Bt,modal__form:Nt,modal__select:wt,modal__radios:Ft,modal__inner:At,modal__item:Dt},ee=[{name:"new_students",label:"New Students"},{name:"studying_students",label:"Studying Students"},{name:"deleted_students",label:"Deleted Students"}],It={newStudents:Ee},Ut=()=>{const l=$(),[a]=De(),{register:c,handleSubmit:n}=Ie(),d=m(Pe),i=m(tt),g=m(ke),h=m(Te),v=m(Re),_=m(ae),p=m(Ve),u=m(Ue),f=m(Je),S=m(Qe),[A,o]=s.useState(null),[x,t]=s.useState(bt("selectedRadio")||ee[0].name),[j,D]=s.useState({}),[I,E]=s.useState(),[y,K]=s.useState(!1),[le,de]=s.useState(),[W,k]=s.useState(!1),[X,T]=s.useState(""),[ce,oe]=s.useState(""),[R,ie]=s.useState([]),[ue,M]=s.useState(1),[he,_e]=s.useState(!0);let xe=s.useMemo(()=>50,[]);const me=s.useMemo(()=>{let r=[];switch(x){case"new_students":r=u?.slice();break;case"studying_students":r=p?.slice();break;case"deleted_students":r=f?.slice();break;default:r=[]}return M(1),i?r.filter(b=>b.user?.name?.toLowerCase().includes(i.toLowerCase())||b.user?.surname?.toLowerCase().includes(i.toLowerCase())||b?.student?.user?.name.toLowerCase().includes(i.toLowerCase())||b?.student?.user?.surname.toLowerCase().includes(i.toLowerCase())):r},[u,p,f,i,x,ce]);s.useEffect(()=>{d&&(l(Le(d)),l(ne()))},[d]),s.useEffect(()=>{d&&(l(qe()),l($e({branch:d})))},[d]);const ge=r=>{if(!I&&h.length<=3)return K(!0),null;const b={...r,teacher:[+le],color:r?.color??I,branch:d,create_type:"school"};D(b),T("post")},je=r=>{_e(g.filter(b=>b.id===+r)[0]?.price===0||!g.filter(b=>b.id===+r)[0]?.price),l(Ge({branch:d,number:r}))};s.useEffect(()=>{const r=a.get("type");r&&t(r)},[a]),s.useEffect(()=>{pt("selectedRadio",x)},[x]);const fe=r=>{t(r)},Se=s.useCallback(()=>{switch(x){case"new_students":return S===!0?e.jsx(q,{}):e.jsx(Ke,{branchId:d,currentTableData:R});case"deleted_students":return S===!0?e.jsx(q,{}):e.jsx(lt,{currentTableData:R});case"studying_students":return S===!0?e.jsx(q,{}):e.jsx(st,{currentTableData:R});default:return null}},[S,x,R])();return s.useMemo(()=>[{name:"Yangi o'quvchilar",type:"new_students"},{name:"O'chirilgan o'quvchilar",type:"deleted_students"},{name:"O'qiyotgan o'quvchilar",type:"studying_students"}],[]),e.jsxs(Oe,{reducers:It,children:[e.jsx(_t,{setActive:T,onChange:fe,selectedRadio:x,peoples:ee,onClick:k}),e.jsx("div",{className:C.tableMain,children:Se}),e.jsx(Xe,{setCurrentTableData:ie,users:me,setCurrentPage:M,currentPage:ue,pageSize:xe,onPageChange:r=>{M(r)},type:"custom"}),e.jsx(St,{active:X==="filter",setActive:T,activePage:x,setIsFilter:oe,branchId:d}),e.jsx(Q,{active:W==="create",setActive:k,children:e.jsxs("div",{className:C.modal,children:[e.jsx("h1",{children:"Sinf yaratish"}),e.jsxs(Me,{onSubmit:n(ge),extraClassname:C.modal__form,typeSubmit:he?"":"inside",children:[e.jsx(P,{required:!0,extraClass:C.modal__select,title:"O'qituvchi",options:v,onChangeOption:de}),e.jsx(P,{required:!0,extraClass:C.modal__select,title:"Til",options:_,register:c,name:"language"}),e.jsx(P,{required:!0,extraClass:C.modal__select,title:"Sinf raqami",options:g,register:c,onChangeOption:je,name:"class_number"}),y?e.jsx("span",{className:C.modal__error,children:"Sinfga rang tanlang"}):null,h.length<=3?e.jsx("div",{className:C.modal__radios,children:h?.map(r=>e.jsxs("div",{className:C.modal__inner,children:[e.jsx(re,{extraClasses:C.modal__item,onChange:()=>{E(r.id),K(!1)},checked:I===r.id,name:"color"}),r.name]}))}):e.jsx(P,{required:!0,extraClass:C.modal__select,title:"Sinf rangi",name:"color",options:h,register:c})]})]})}),e.jsx(ze,{branch:d,setActive:k,active:W==="add"}),e.jsx(ft,{deactiveModal:k,setActive:T,active:X==="post",data:j,branch:d})]})};export{Ut as StudentsPage};
