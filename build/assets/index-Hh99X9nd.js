import{b as z,j as e,T as Y,u as q,a as h,r as s,bm as Se,e as X,h as H,A as $,i as V,o as ee,bn as fe,B as N,z as R,d as te,I as G,bo as se,R as Ce,a3 as ae,bp as pe,bq as be,br as ve,a6 as ye,a7 as ne,a8 as A,S as T,a9 as Be,aa as Ne,ab as Fe,bs as Ae,n as De,g as we,bt as Te,bu as Ie,bv as ke,bw as Pe,bx as Re,by as qe,D as $e,bz as Oe,F as Ee,bA as Le}from"./index-DJEj1NQv.js";import{C as Me}from"./classAddForm-DG-AB0hP.js";import{h as Ge,i as ze,j as Ye,k as He,l as Ve,m as Je,n as Qe,N as Ue}from"./groupTimeTableForm-C7o09MsS.js";import{d as Ke}from"./groupProfileRating-Cb1-_m7K.js";import{P as We}from"./pagination-3QzX85Ud.js";import"./teachers-DUROrZOw.js";import"./editableCard-CUqbiz9v.js";import{C as Xe}from"./confirmModal-DZpNvp7H.js";import{R as le}from"./radio-Dgzg4X2L.js";import{g as Ze}from"./brachSwitcherSelector-vlhkEAq9.js";import{g as et}from"./searchSelector-B3qtoac4.js";import"./alert-DGhvk9g-.js";import"./groupsList-8FJTz9uE.js";import"./roomsSelectors-BrI_i2qA.js";const L={},tt=({currentTableData:r})=>{const n=z();console.log(r,"current");const c=()=>r?.map((a,l)=>e.jsxs("tr",{onClick:()=>n(`profile/${a?.id}`),children:[e.jsx("td",{children:l+1}),e.jsxs("td",{children:[a?.user?.name," ",a?.user?.surname]}),e.jsx("td",{children:a?.user?.age}),e.jsx("td",{children:a?.user?.phone}),e.jsx("td",{children:a?.group?.name?a.group.name:`${a?.class_number} ${a?.group?.color}`}),e.jsx("td",{children:e.jsx("div",{style:{width:"fit-content",border:a.color?`2px solid #${a.color}`:"2px solid black",color:`${a.color}`,padding:"1.5rem",borderRadius:"10px"},children:a.debt})})]},a.id));return e.jsx("div",{className:L.students,children:e.jsx("div",{className:L.table,children:e.jsxs(Y,{extraClass:L.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nomer"}),e.jsx("th",{children:"Guruh nomi"}),e.jsx("th",{children:"Qarzi "})]})}),e.jsx("tbody",{children:c()})]})})})},st="_deletedStudents_9pq9e_1",at="_deletedStudents__menu_9pq9e_11",nt="_active_9pq9e_25",B={deletedStudents:st,deletedStudents__menu:at,active:nt},lt=({currentTableData:r})=>{const n=q(),c=h(Ke),[a,l]=s.useState("all"),[_,x]=s.useState([]),[j,m]=s.useState([]),o=z(),[p,i]=s.useState(!1),[S,F]=s.useState(!1);s.useEffect(()=>{n(Se())},[]);const{request:D}=H(),d=()=>{D(`${$}Students/delete-student-from-deleted/${S}/`,"DELETE",null,V()).then(t=>{n(ee({type:"success",status:!0,msg:t.msg}))}),i(!1),n(fe(S))};console.log(r,"currentTableData");const b=()=>r?.map((t,g)=>a==="all"?e.jsxs("tr",{children:[e.jsx("td",{children:g+1}),e.jsxs("td",{onClick:()=>o(`profile/${t?.student?.id}`),children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{F(t.student.id),i(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):t?.group_reason?.id===a?e.jsxs("tr",{onClick:()=>o(`profile/${t.id}`),children:[e.jsx("td",{children:g+1}),e.jsxs("td",{children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{F(t.student.id),i(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):null);return e.jsxs("div",{className:B.deletedStudents,children:[e.jsxs("ul",{className:B.deletedStudents__menu,children:[e.jsx("li",{className:X(B.other__item,{[B.active]:a==="all"}),onClick:()=>{l("all")},children:"Hammasi"},6),c?.map((t,g)=>e.jsx("li",{className:X(B.other__item,{[B.active]:a===t.id}),onClick:()=>{l(t.id)},children:t.name},g))]}),e.jsx("div",{className:B.table,children:e.jsxs(Y,{extraClass:B.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nome"}),e.jsx("th",{children:"Guruh"}),e.jsx("th",{children:"Reg.sana"}),e.jsx("th",{children:"O'chir.sana"}),e.jsx("th",{children:"Sabab"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:b()})]})}),e.jsx(Xe,{onClick:d,title:"Qaytarish",text:"Studentni rostanham qaytarmoqchimisiz",type:"danger",active:p,setActive:i})]})},rt="_mainContainer_1agrm_1",dt="_mainContainer_buttonPanelBox_1agrm_4",ct="_mainContainer_buttonPanelBox_leftCreateButton_1agrm_8",ot="_mainContainer_filterPanelBox_1agrm_11",it="_mainContainer_filterPanelBox_rightFilterRadioGroupBox_1agrm_15",ut="_activeFilter_1agrm_20",v={mainContainer:rt,mainContainer_buttonPanelBox:dt,mainContainer_buttonPanelBox_leftCreateButton:ct,mainContainer_filterPanelBox:ot,mainContainer_filterPanelBox_rightFilterRadioGroupBox:it,activeFilter:ut},ht=({onChange:r,selectedRadio:n,peoples:c,setActive:a,onClick:l,setActiveClass:_})=>{const x=h(Ze),j=z();return e.jsxs("div",{className:v.mainContainer,children:[e.jsx("div",{className:v.mainContainer_buttonPanelBox,children:e.jsxs("div",{className:v.mainContainer_buttonPanelBox_leftCreateButton,children:[e.jsx(N,{type:"filter",extraClass:v.extraCutClass,onClick:()=>l("create"),children:"Create Class"}),e.jsx(N,{onClick:()=>l("add"),type:"filter",extraClass:v.noneBackground,children:"Add class"}),e.jsx(N,{onClick:()=>j("RGBData"),type:"filter",children:"RB-Baza"})]})}),e.jsxs("div",{className:v.mainContainer_filterPanelBox,children:[e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx(N,{status:"filter",extraClass:v.extraCutClassFilter,onClick:()=>a("filter"),type:"filter",children:"Filter"}),e.jsx(N,{status:"filter",onClick:()=>_(!0),type:"filter",children:"Sinfga qushish"})]}),e.jsx("a",{style:{color:"white"},href:`${$}Students/export-students/?branch=${x?.id}&format=json`,children:e.jsx(N,{type:"simple",children:"Exel"})}),e.jsx("div",{className:v.mainContainer_filterPanelBox_rightFilterRadioGroupBox,children:c.map((m,o)=>e.jsx(le,{onChange:()=>r(m.name),checked:n===m.name,extraClasses:n===m.name?v.activeFilter:null,children:m.label},o))})]})]})},_t="_createClass_s3igw_1",xt="_createClass__input_s3igw_6",mt="_createClass__btn_s3igw_9",gt="_createClass__inner_s3igw_13",P={createClass:_t,createClass__input:xt,createClass__btn:mt,createClass__inner:gt},jt=s.memo(r=>{const{active:n,setActive:c,data:a,branch:l,deactiveModal:_}=r,{request:x}=H(),j=q(),m=h(Ge),o=h(ze),[p,i]=s.useState([]);s.useEffect(()=>{i([])},[m]);const S=()=>{const d={...a,students:p};x(`${$}Group/groups/create/`,"POST",JSON.stringify(d),V()).then(b=>{j(ee({type:"success",status:!0,msg:"Sinf yaratildi"})),j(se({userBranchId:l})),c(!1),_(!1)})},D=o==="loading"||o==="idle"?e.jsx(te,{}):m?.map((d,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:b+1}),e.jsxs("td",{children:[d.user?.surname," ",d.user?.name]}),e.jsx("td",{children:d.user?.age}),e.jsx("td",{children:d.user?.language}),e.jsx("td",{children:d?.class_number}),e.jsx("td",{children:d.user?.registered_date}),e.jsx("td",{children:e.jsx(G,{extraClassName:P.createClass__input,type:"checkbox",onChange:()=>i(t=>t.filter(g=>g===d.id)[0]?t.filter(g=>g!==d.id):[...t,d.id])})})]}));return e.jsx(R,{active:n,setActive:c,children:e.jsxs("div",{className:P.createClass,children:[e.jsx("h1",{children:"O'quvchi tanlang"}),e.jsx("div",{className:P.createClass__inner,children:e.jsxs(Y,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:D})]})}),e.jsx(N,{onClick:S,extraClass:P.createClass__btn,children:"Create"})]})})}),St=Ce.memo(({active:r,setActive:n,activePage:c,pageSize:a,currentPage:l})=>{const _=localStorage.getItem("selectedLang"),x=localStorage.getItem("ageFrom"),j=localStorage.getItem("ageTo"),m=localStorage.getItem("studentSwitch"),[o,p]=s.useState(x!==null?x:""),[i,S]=s.useState(j!==null?j:""),[F,D]=s.useState(_),[d,b]=s.useState(m==="true"),t=q(),g=h(ae);localStorage.setItem("selectedLang",F),localStorage.setItem("ageFrom",o),localStorage.setItem("ageTo",i),localStorage.setItem("studentSwitch",`${d}`);const y=localStorage.getItem("branchId");console.log(x,j),s.useEffect(()=>{t(c==="studying_students"?pe({langId:_,fromAge:o,untilAge:i,userBranchId:y,currentPage:l,pageSize:a}):c==="new_students"?d?be({langId:_,fromAge:o,untilAge:i,userBranchId:y,currentPage:l,pageSize:a}):se({langId:_,fromAge:o,untilAge:i,userBranchId:y,currentPage:l,pageSize:a}):ve({langId:_,fromAge:o,untilAge:i,userBranchId:y,currentPage:l,pageSize:a}))},[F,i,o,c,d,l]);const O=C=>{p(C.target.value)},E=C=>{S(C.target.value)};return s.useEffect(()=>{t(ye()),t(ne())},[t]),e.jsx(R,{active:r,setActive:n,children:e.jsxs("div",{className:A.filter,children:[e.jsx("h1",{children:"Filter"}),e.jsxs("div",{className:A.filter__container,children:[e.jsxs("div",{className:A.filter__age,children:[e.jsx(G,{type:"number",extraClassName:A.filter__input,placeholder:"Yosh (От)",onChange:C=>p(C.target.value),onBlur:O,defaultValue:o}),e.jsx(G,{type:"number",extraClassName:A.filter__input,placeholder:"Yosh (До)",onChange:C=>S(C.target.value),onBlur:E,defaultValue:i})]}),e.jsx(N,{type:"danger",onClick:()=>{S(null),p(null)},children:"Clear (Yoshlarni tozalash)"}),e.jsx(T,{title:"Til",options:[{name:"Hamma",id:"all"},...g],extraClass:A.filter__select,onChangeOption:D,defaultValue:_}),c==="new_students"&&e.jsxs("div",{className:A.filter__switch,children:[e.jsx("p",{children:"O’chirilgan"}),e.jsx(Be,{onChangeSwitch:b,activeSwitch:d})]})]})]})})}),M=Ne("filterStudents/fetchFilteredStudents",async r=>{const{request:n}=H();return await n(`${$}`,"POST",JSON.stringify(r),V())}),ft={students:null,loading:!1,error:null};Fe({name:"filterStudents",initialState:ft,reducers:{},extraReducers:r=>r.addCase(M.pending,n=>{n.loading=!0,n.error=null}).addCase(M.fulfilled,(n,c)=>{n.students=c.payload,n.loading=!1,n.error=null}).addCase(M.rejected,(n,c)=>{n.loading=!1,n.error=c.payload??null})});const Ct=(r,n)=>{localStorage.setItem(r,n)},pt=r=>localStorage.getItem(r),bt="_tableMain_c2dxc_1",vt="_modal_c2dxc_16",yt="_modal__error_c2dxc_21",Bt="_modal__form_c2dxc_26",Nt="_modal__select_c2dxc_31",Ft="_modal__radios_c2dxc_34",At="_modal__inner_c2dxc_40",Dt="_modal__item_c2dxc_46",f={tableMain:bt,modal:vt,modal__error:yt,modal__form:Bt,modal__select:Nt,modal__radios:Ft,modal__inner:At,modal__item:Dt},Z=[{name:"new_students",label:"New Students"},{name:"studying_students",label:"Studying Students"},{name:"deleted_students",label:"Deleted Students"}],wt={newStudents:Oe},Ut=()=>{const r=q(),[n]=Ae(),{register:c,handleSubmit:a}=De(),l=h(we);h(et);const _=h(Te),x=h(Ie),j=h(ke),m=h(ae),o=h(Ye),p=h(He),i=h(Ve),S=h(Je),[F,D]=s.useState(null),[d,b]=s.useState(pt("selectedRadio")||Z[0].name),[t,g]=s.useState({}),[y,O]=s.useState(),[E,C]=s.useState(!1),[re,de]=s.useState(),[J,I]=s.useState(!1),[Q,k]=s.useState(""),[Tt,ce]=s.useState(""),[It,kt]=s.useState([]),[U,oe]=s.useState(1),[ie,ue]=s.useState(!0),he=h(Qe);let K=s.useMemo(()=>50,[]);const[_e,W]=s.useState(!1);s.useEffect(()=>{l&&(r(Pe(l)),r(ne()))},[l]),s.useEffect(()=>{l&&(r(Re()),r(qe({branch:l})))},[l]);const xe=u=>{if(!y&&x.length<=3)return C(!0),null;const w={...u,teacher:[+re],color:u?.color??y,branch:l,create_type:"school"};g(w),k("post")},me=u=>{ue(_.filter(w=>w.id===+u)[0]?.price===0||!_.filter(w=>w.id===+u)[0]?.price),r(Le({branch:l,number:u}))};s.useEffect(()=>{const u=n.get("type");u&&b(u)},[n]),s.useEffect(()=>{Ct("selectedRadio",d)},[d]);const ge=u=>{b(u)},je=s.useCallback(()=>{switch(d){case"new_students":return e.jsx(Ue,{branchId:l,currentTableData:p});case"deleted_students":return e.jsx(lt,{currentTableData:i});case"studying_students":return e.jsx(tt,{currentTableData:o});default:return null}},[S,d,o])();return s.useMemo(()=>[{name:"Yangi o'quvchilar",type:"new_students"},{name:"O'chirilgan o'quvchilar",type:"deleted_students"},{name:"O'qiyotgan o'quvchilar",type:"studying_students"}],[]),console.log(o,"studyingStudents"),e.jsxs($e,{reducers:wt,children:[e.jsx(ht,{setActive:k,onChange:ge,selectedRadio:d,peoples:Z,onClick:I,setActiveClass:W}),e.jsx("div",{className:f.tableMain,children:S===!0?e.jsx(te,{}):je}),e.jsx(We,{totalCount:he,currentPage:U,pageSize:K,onPageChange:u=>{oe(u)},type:"custom"}),e.jsx(St,{currentPage:U,pageSize:K,active:Q==="filter",setActive:k,activePage:d,setIsFilter:ce,branchId:l}),e.jsx(R,{active:J==="create",setActive:I,children:e.jsxs("div",{className:f.modal,children:[e.jsx("h1",{children:"Sinf yaratish"}),e.jsxs(Ee,{onSubmit:a(xe),extraClassname:f.modal__form,typeSubmit:ie?"":"inside",children:[e.jsx(T,{required:!0,extraClass:f.modal__select,title:"O'qituvchi",options:j,onChangeOption:de}),e.jsx(T,{required:!0,extraClass:f.modal__select,title:"Til",options:m,register:c,name:"language"}),e.jsx(T,{required:!0,extraClass:f.modal__select,title:"Sinf raqami",options:_,register:c,onChangeOption:me,name:"class_number"}),E?e.jsx("span",{className:f.modal__error,children:"Sinfga rang tanlang"}):null,x.length<=3?e.jsx("div",{className:f.modal__radios,children:x?.map(u=>e.jsxs("div",{className:f.modal__inner,children:[e.jsx(le,{extraClasses:f.modal__item,onChange:()=>{O(u.id),C(!1)},checked:y===u.id,name:"color"}),u.name]}))}):e.jsx(T,{required:!0,extraClass:f.modal__select,title:"Sinf rangi",name:"color",options:x,register:c})]})]})}),e.jsx(Me,{branch:l,setActive:I,active:J==="add"}),e.jsx(jt,{deactiveModal:I,setActive:k,active:Q==="post",data:t,branch:l}),e.jsx(R,{active:_e,setActive:W})]})};export{Ut as StudentsPage};
