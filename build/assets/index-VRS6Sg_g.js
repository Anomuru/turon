import{b as U,j as e,T as q,u as $,a as x,r as n,bm as Fe,e as ae,h as E,A as k,i as L,o as K,bn as we,B as N,z as O,d as Ae,I as Q,bo as de,R as De,a3 as ce,bp as Te,bq as ke,br as Ie,a6 as Pe,a7 as oe,a8 as A,S as T,a9 as Re,aa as Oe,ab as qe,bs as $e,n as Ee,g as Le,bt as Me,bu as Ge,bv as ze,bw as Ye,bx as Ve,by as He,D as Je,bz as Qe,F as Ue,bA as Ke}from"./index-D6a-L2Nf.js";import{C as We}from"./classAddForm-DHWieXKp.js";import{h as Xe,i as Ze,j as et,k as tt,l as st,m as nt,n as at,N as lt}from"./groupTimeTableForm-CM1rZlWy.js";import{d as rt}from"./groupProfileRating-BU8gajPE.js";import{P as le}from"./pagination-BdhDfYIy.js";import"./teachers-BCgOOOqv.js";import"./editableCard-6FckkYw6.js";import{C as dt}from"./confirmModal-BQZtw_hD.js";import{R as ie}from"./radio-CyAmbBjr.js";import{g as ct}from"./brachSwitcherSelector-vlhkEAq9.js";import{g as ot}from"./searchSelector-B3qtoac4.js";import"./alert-BnIk75ig.js";import"./groupsList-BWXVSWn9.js";import"./roomsSelectors-BrI_i2qA.js";const H={},it=({currentTableData:d})=>{const l=U();console.log(d,"current");const o=()=>d?.map((a,r)=>e.jsxs("tr",{onClick:()=>l(`profile/${a?.id}`),children:[e.jsx("td",{children:r+1}),e.jsxs("td",{children:[a?.user?.name," ",a?.user?.surname]}),e.jsx("td",{children:a?.user?.age}),e.jsx("td",{children:a?.user?.phone}),e.jsx("td",{children:a?.group?.name?a.group.name:`${a?.class_number} ${a?.group?.color}`}),e.jsx("td",{children:e.jsx("div",{style:{width:"fit-content",border:a.color?`2px solid #${a.color}`:"2px solid black",color:`${a.color}`,padding:"1.5rem",borderRadius:"10px"},children:a.debt})})]},a.id));return e.jsx("div",{className:H.students,children:e.jsx("div",{className:H.table,children:e.jsxs(q,{extraClass:H.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nomer"}),e.jsx("th",{children:"Guruh nomi"}),e.jsx("th",{children:"Qarzi "})]})}),e.jsx("tbody",{children:o()})]})})})},ut="_deletedStudents_9pq9e_1",ht="_deletedStudents__menu_9pq9e_11",xt="_active_9pq9e_25",F={deletedStudents:ut,deletedStudents__menu:ht,active:xt},_t=({currentTableData:d})=>{const l=$(),o=x(rt),[a,r]=n.useState("all"),[i,g]=n.useState([]),[S,m]=n.useState([]),u=U(),[C,h]=n.useState(!1),[p,w]=n.useState(!1);n.useEffect(()=>{l(Fe())},[]);const{request:D}=E(),c=()=>{D(`${k}Students/delete-student-from-deleted/${p}/`,"DELETE",null,L()).then(t=>{l(K({type:"success",status:!0,msg:t.msg}))}),h(!1),l(we(p))};console.log(d,"currentTableData");const v=()=>d?.map((t,j)=>a==="all"?e.jsxs("tr",{children:[e.jsx("td",{children:j+1}),e.jsxs("td",{onClick:()=>u(`profile/${t?.student?.id}`),children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{w(t.student.id),h(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):t?.group_reason?.id===a?e.jsxs("tr",{onClick:()=>u(`profile/${t.id}`),children:[e.jsx("td",{children:j+1}),e.jsxs("td",{children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{w(t.student.id),h(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):null);return e.jsxs("div",{className:F.deletedStudents,children:[e.jsxs("ul",{className:F.deletedStudents__menu,children:[e.jsx("li",{className:ae(F.other__item,{[F.active]:a==="all"}),onClick:()=>{r("all")},children:"Hammasi"},6),o?.map((t,j)=>e.jsx("li",{className:ae(F.other__item,{[F.active]:a===t.id}),onClick:()=>{r(t.id)},children:t.name},j))]}),e.jsx("div",{className:F.table,children:e.jsxs(q,{extraClass:F.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nome"}),e.jsx("th",{children:"Guruh"}),e.jsx("th",{children:"Reg.sana"}),e.jsx("th",{children:"O'chir.sana"}),e.jsx("th",{children:"Sabab"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:v()})]})}),e.jsx(dt,{onClick:c,title:"Qaytarish",text:"Studentni rostanham qaytarmoqchimisiz",type:"danger",active:C,setActive:h})]})},gt="_mainContainer_1agrm_1",mt="_mainContainer_buttonPanelBox_1agrm_4",jt="_mainContainer_buttonPanelBox_leftCreateButton_1agrm_8",ft="_mainContainer_filterPanelBox_1agrm_11",St="_mainContainer_filterPanelBox_rightFilterRadioGroupBox_1agrm_15",Ct="_activeFilter_1agrm_20",y={mainContainer:gt,mainContainer_buttonPanelBox:mt,mainContainer_buttonPanelBox_leftCreateButton:jt,mainContainer_filterPanelBox:ft,mainContainer_filterPanelBox_rightFilterRadioGroupBox:St,activeFilter:Ct},pt=({onChange:d,selectedRadio:l,peoples:o,setActive:a,onClick:r,setActiveClass:i})=>{const g=x(ct),S=U();return e.jsxs("div",{className:y.mainContainer,children:[e.jsx("div",{className:y.mainContainer_buttonPanelBox,children:e.jsxs("div",{className:y.mainContainer_buttonPanelBox_leftCreateButton,children:[e.jsx(N,{type:"filter",extraClass:y.extraCutClass,onClick:()=>r("create"),children:"Create Class"}),e.jsx(N,{onClick:()=>r("add"),type:"filter",extraClass:y.noneBackground,children:"Add class"}),e.jsx(N,{onClick:()=>S("RGBData"),type:"filter",children:"RB-Baza"})]})}),e.jsxs("div",{className:y.mainContainer_filterPanelBox,children:[e.jsxs("div",{style:{display:"flex",gap:"1rem"},children:[e.jsx(N,{status:"filter",extraClass:y.extraCutClassFilter,onClick:()=>a("filter"),type:"filter",children:"Filter"}),e.jsx(N,{status:"filter",onClick:()=>i(!0),type:"filter",children:"Sinfga bulish"})]}),e.jsx("a",{style:{color:"white"},href:`${k}Students/export-students/?branch=${g?.id}&format=json`,children:e.jsx(N,{type:"simple",children:"Exel"})}),e.jsx("div",{className:y.mainContainer_filterPanelBox_rightFilterRadioGroupBox,children:o.map((m,u)=>e.jsx(ie,{onChange:()=>d(m.name),checked:l===m.name,extraClasses:l===m.name?y.activeFilter:null,children:m.label},u))})]})]})},bt="_createClass_s3igw_1",vt="_createClass__input_s3igw_6",yt="_createClass__btn_s3igw_9",Nt="_createClass__inner_s3igw_13",R={createClass:bt,createClass__input:vt,createClass__btn:yt,createClass__inner:Nt},Bt=n.memo(d=>{const{active:l,setActive:o,data:a,branch:r,deactiveModal:i}=d,{request:g}=E(),S=$(),m=x(Xe),u=x(Ze),[C,h]=n.useState([]);n.useEffect(()=>{h([])},[m]);const p=()=>{const c={...a,students:C};g(`${k}Group/groups/create/`,"POST",JSON.stringify(c),L()).then(v=>{S(K({type:"success",status:!0,msg:"Sinf yaratildi"})),S(de({userBranchId:r})),o(!1),i(!1)})},D=u==="loading"||u==="idle"?e.jsx(Ae,{}):m?.map((c,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:v+1}),e.jsxs("td",{children:[c.user?.surname," ",c.user?.name]}),e.jsx("td",{children:c.user?.age}),e.jsx("td",{children:c.user?.language}),e.jsx("td",{children:c?.class_number}),e.jsx("td",{children:c.user?.registered_date}),e.jsx("td",{children:e.jsx(Q,{extraClassName:R.createClass__input,type:"checkbox",onChange:()=>h(t=>t.filter(j=>j===c.id)[0]?t.filter(j=>j!==c.id):[...t,c.id])})})]}));return e.jsx(O,{active:l,setActive:o,children:e.jsxs("div",{className:R.createClass,children:[e.jsx("h1",{children:"O'quvchi tanlang"}),e.jsx("div",{className:R.createClass__inner,children:e.jsxs(q,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:D})]})}),e.jsx(N,{onClick:p,extraClass:R.createClass__btn,children:"Create"})]})})}),Ft=De.memo(({active:d,setActive:l,activePage:o,pageSize:a,currentPage:r})=>{const i=localStorage.getItem("selectedLang"),g=localStorage.getItem("ageFrom"),S=localStorage.getItem("ageTo"),m=localStorage.getItem("studentSwitch"),[u,C]=n.useState(g!==null?g:""),[h,p]=n.useState(S!==null?S:""),[w,D]=n.useState(i),[c,v]=n.useState(m==="true"),t=$(),j=x(ce);localStorage.setItem("selectedLang",w),localStorage.setItem("ageFrom",u),localStorage.setItem("ageTo",h),localStorage.setItem("studentSwitch",`${c}`);const B=localStorage.getItem("branchId");console.log(g,S),n.useEffect(()=>{t(o==="studying_students"?Te({langId:i,fromAge:u,untilAge:h,userBranchId:B,currentPage:r,pageSize:a}):o==="new_students"?c?ke({langId:i,fromAge:u,untilAge:h,userBranchId:B,currentPage:r,pageSize:a}):de({langId:i,fromAge:u,untilAge:h,userBranchId:B,currentPage:r,pageSize:a}):Ie({langId:i,fromAge:u,untilAge:h,userBranchId:B,currentPage:r,pageSize:a}))},[w,h,u,o,c,r]);const M=b=>{C(b.target.value)},G=b=>{p(b.target.value)};return n.useEffect(()=>{t(Pe()),t(oe())},[t]),e.jsx(O,{active:d,setActive:l,children:e.jsxs("div",{className:A.filter,children:[e.jsx("h1",{children:"Filter"}),e.jsxs("div",{className:A.filter__container,children:[e.jsxs("div",{className:A.filter__age,children:[e.jsx(Q,{type:"number",extraClassName:A.filter__input,placeholder:"Yosh (От)",onChange:b=>C(b.target.value),onBlur:M,defaultValue:u}),e.jsx(Q,{type:"number",extraClassName:A.filter__input,placeholder:"Yosh (До)",onChange:b=>p(b.target.value),onBlur:G,defaultValue:h})]}),e.jsx(N,{type:"danger",onClick:()=>{p(null),C(null)},children:"Clear (Yoshlarni tozalash)"}),e.jsx(T,{title:"Til",options:[{name:"Hamma",id:"all"},...j],extraClass:A.filter__select,onChangeOption:D,defaultValue:i}),o==="new_students"&&e.jsxs("div",{className:A.filter__switch,children:[e.jsx("p",{children:"O’chirilgan"}),e.jsx(Re,{onChangeSwitch:v,activeSwitch:c})]})]})]})})}),J=Oe("filterStudents/fetchFilteredStudents",async d=>{const{request:l}=E();return await l(`${k}`,"POST",JSON.stringify(d),L())}),wt={students:null,loading:!1,error:null};qe({name:"filterStudents",initialState:wt,reducers:{},extraReducers:d=>d.addCase(J.pending,l=>{l.loading=!0,l.error=null}).addCase(J.fulfilled,(l,o)=>{l.students=o.payload,l.loading=!1,l.error=null}).addCase(J.rejected,(l,o)=>{l.loading=!1,l.error=o.payload??null})});const At=(d,l)=>{localStorage.setItem(d,l)},Dt=d=>localStorage.getItem(d),Tt="_tableMain_c2dxc_1",kt="_modal_c2dxc_16",It="_modal__error_c2dxc_21",Pt="_modal__form_c2dxc_26",Rt="_modal__select_c2dxc_31",Ot="_modal__radios_c2dxc_34",qt="_modal__inner_c2dxc_40",$t="_modal__item_c2dxc_46",f={tableMain:Tt,modal:kt,modal__error:It,modal__form:Pt,modal__select:Rt,modal__radios:Ot,modal__inner:qt,modal__item:$t},re=[{name:"new_students",label:"New Students"},{name:"studying_students",label:"Studying Students"},{name:"deleted_students",label:"Deleted Students"}],Et={newStudents:Qe},ns=()=>{const d=$(),[l]=$e(),{register:o,handleSubmit:a}=Ee(),r=x(Le);x(ot);const i=x(Me),g=x(Ge),S=x(ze),m=x(ce),u=x(et),C=x(tt),h=x(st),p=x(nt),[w,D]=n.useState(null),[c,v]=n.useState(Dt("selectedRadio")||re[0].name),[t,j]=n.useState({}),[B,M]=n.useState(),[G,b]=n.useState(!1),[ue,he]=n.useState(),[W,I]=n.useState(!1),[X,P]=n.useState(""),[Lt,xe]=n.useState(""),[_e,Mt]=n.useState([]),[z,Z]=n.useState(1),[ge,me]=n.useState(!0),ee=x(at),[Y,te]=n.useState(null);let V=n.useMemo(()=>50,[]);const[je,se]=n.useState(!1),[ne,fe]=n.useState([]);n.useEffect(()=>{r&&(d(Ye(r)),d(oe()))},[r]),n.useEffect(()=>{r&&(d(Ve()),d(He({branch:r})))},[r]);const Se=s=>{if(!B&&g.length<=3)return b(!0),null;const _={...s,teacher:[+ue],color:s?.color??B,branch:r,create_type:"school"};j(_),P("post")},Ce=s=>{me(i.filter(_=>_.id===+s)[0]?.price===0||!i.filter(_=>_.id===+s)[0]?.price),d(Ke({branch:r,number:s}))};n.useEffect(()=>{const s=l.get("type");s&&v(s)},[l]),n.useEffect(()=>{At("selectedRadio",c)},[c]);const pe=s=>{v(s)},be=n.useCallback(()=>{switch(c){case"new_students":return e.jsx(lt,{branchId:r,currentTableData:C});case"deleted_students":return e.jsx(_t,{currentTableData:h});case"studying_students":return e.jsx(it,{currentTableData:u});default:return null}},[p,c,u])();n.useMemo(()=>[{name:"Yangi o'quvchilar",type:"new_students"},{name:"O'chirilgan o'quvchilar",type:"deleted_students"},{name:"O'qiyotgan o'quvchilar",type:"studying_students"}],[]);const{request:ve}=E(),ye=()=>{console.log(Y,ne);const s={class_number:Y,students:ne};ve(`${k}Students/update_student_class_number/`,"POST",JSON.stringify(s),L()).then(_=>{console.log(_),d(K({type:"success",status:!0,msg:_.msg}))})},Ne=s=>{fe(_=>_.includes(s)?_.filter(Be=>Be!==s):[..._,s])};return n.useEffect(()=>{i&&te(i[0]?.id)},[i]),e.jsxs(Je,{reducers:Et,children:[e.jsx(pt,{setActive:P,onChange:pe,selectedRadio:c,peoples:re,onClick:I,setActiveClass:se}),e.jsx("div",{className:f.tableMain,children:be}),e.jsx(Ft,{currentPage:z,pageSize:V,active:X==="filter",setActive:P,activePage:c,setIsFilter:xe,branchId:r}),e.jsx(le,{totalCount:ee,currentPage:z,pageSize:V,onPageChange:s=>{Z(s)},type:"custom"}),e.jsx(O,{active:W==="create",setActive:I,children:e.jsxs("div",{className:f.modal,children:[e.jsx("h1",{children:"Sinf yaratish"}),e.jsxs(Ue,{onSubmit:a(Se),extraClassname:f.modal__form,typeSubmit:ge?"":"inside",children:[e.jsx(T,{required:!0,extraClass:f.modal__select,title:"O'qituvchi",options:S,onChangeOption:he}),e.jsx(T,{required:!0,extraClass:f.modal__select,title:"Til",options:m,register:o,name:"language"}),e.jsx(T,{required:!0,extraClass:f.modal__select,title:"Sinf raqami",options:i,register:o,onChangeOption:Ce,name:"class_number"}),G?e.jsx("span",{className:f.modal__error,children:"Sinfga rang tanlang"}):null,g.length<=3?e.jsx("div",{className:f.modal__radios,children:g?.map(s=>e.jsxs("div",{className:f.modal__inner,children:[e.jsx(ie,{extraClasses:f.modal__item,onChange:()=>{M(s.id),b(!1)},checked:B===s.id,name:"color"}),s.name]}))}):e.jsx(T,{required:!0,extraClass:f.modal__select,title:"Sinf rangi",name:"color",options:g,register:o})]})]})}),e.jsx(We,{branch:r,setActive:I,active:W==="add"}),e.jsx(Bt,{deactiveModal:I,setActive:P,active:X==="post",data:t,branch:r}),e.jsxs(O,{type:"simple",active:je,setActive:se,children:[e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsx(T,{options:i,onChangeOption:te,defaultValue:Y})}),e.jsx("div",{style:{height:"50vh",overflow:"auto"},children:e.jsxs(q,{children:[e.jsx("thead",{className:f.thead,children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{}),_e?.filter(s=>!s.deleted)?.length?e.jsx("th",{children:"O'chirish"}):""]})}),e.jsx("tbody",{children:C?.map((s,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:_+1}),e.jsxs("td",{onClick:()=>navigation(`profile/${s.id}`),children:[s.user?.surname," ",s.user?.name]}),e.jsx("td",{children:s.user?.age}),e.jsx("td",{children:s.deleted?s.user?.language?.name:s?.user?.language}),e.jsxs("td",{children:[s?.class_number,"-sinf"]}),e.jsx("td",{children:s.user?.registered_date}),e.jsx("td",{onClick:()=>Ne(s.id),children:e.jsx("input",{style:{width:"20px",height:"20px"},type:"checkbox"})})]},s.id))})]})}),e.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(le,{totalCount:ee,currentPage:z,pageSize:V,onPageChange:s=>{Z(s)},type:"custom"}),e.jsx(N,{onClick:ye,children:"Submit"})]})]})]})};export{ns as StudentsPage};
