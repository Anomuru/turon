import{u as P,a as d,g as v,b as N,r as l,f as F,j as n,D as A,c as H,d as y,e as B,B as E,h as O,A as R,i as T,o as G}from"./index-DJEj1NQv.js";import{f as M,F as U}from"./flowsSlice-r0wjSj2Y.js";import{g as q,a as z}from"./groupsList-8FJTz9uE.js";import{P as J}from"./pagination-3QzX85Ud.js";import{g as V}from"./searchSelector-B3qtoac4.js";const W="_flow_14ck2_1",$="_flowListHeader_14ck2_4",K="_table__footer_14ck2_24",Q="_active_14ck2_31",X="_table__btn_14ck2_35",o={flow:W,flowListHeader:$,table__footer:K,active:Q,table__btn:X},Y={groupsSlice:H},ns=()=>{const{request:C}=O(),i=P(),u=d(v),x=N();l.useEffect(()=>{u&&(i(M()),i(F({userBranchId:u})))},[u]);const g=d(q),L=d(z),p=d(V);let b=l.useMemo(()=>50,[]);const[S,f]=l.useState([]),[h,w]=l.useState(1),[c,_]=l.useState([]),m=l.useMemo(()=>{const t=g?.slice();return w(1),p?t.filter(a=>a.name?.toLowerCase().includes(p.toLowerCase())):t},[g]),j=t=>{f(a=>a.map(e=>e?.id===+t?e.isCheck?(_(s=>s.filter(r=>r?.classId!==e?.id)),{isCheck:!1,id:e.id,students:e.students.map(s=>({...s,isCheck:!1,id:s.id})),class_number:e.class_number,color:e.color}):(_(s=>s.filter(r=>r?.classId===e?.id)[0]?[...s.filter(r=>r?.classId!==e.id),{classId:e?.id,students:e?.students?.map(r=>r?.id)}]:[...s,{classId:e?.id,students:e?.students?.map(r=>r?.id)}]),{isCheck:!0,id:e.id,students:e.students.map(s=>({...s,isCheck:!0,id:s.id})),class_number:e.class_number,color:e.color}):e))},k=(t,a)=>{_(e=>e.filter(s=>s?.classId===+a)[0]?e.map(s=>{if(s?.classId===a)return{classId:s?.classId,students:s?.students.includes(+t)?s.students.filter(r=>r!==+t):[...s.students,+t]}}):[...e,{classId:+a,students:[+t]}])};l.useEffect(()=>{f(t=>t?.map(a=>{const e=c?.filter(s=>s?.classId===a.id)[0];return e?{isCheck:e?.students?.length===a.students.length,id:a.id,students:a.students.map(s=>e?.students?.includes(s.id)?{...s,isCheck:!0,id:s.id}:{...s,isCheck:!1,id:s.id}),class_number:a.class_number,color:a.color}:a}))},[c,h]);const I=()=>{let t=[];c.map(s=>{s?.students?.map(r=>t.push(r))});const a=localStorage.getItem("flowData"),e={...JSON.parse(a),students:t,classes:[]};C(`${R}Flow/flow-list-create/`,"POST",JSON.stringify(e),T()).then(s=>{i(G({type:"success",msg:s.msg,status:!0})),localStorage.removeItem("flowData")}).then(()=>{x(-2)})},D=S?.map((t,a)=>n.jsx(U,{currentPage:h,flowList:t,onChangeAll:j,onChangeSingle:k,number:a},a));return n.jsx(A,{reducers:Y,children:n.jsxs("div",{className:o.flow,children:[n.jsx("div",{className:o.flowListHeader,children:n.jsxs("div",{children:[n.jsx("span",{children:"No"}),n.jsx("span",{children:"Sinf Raqami"})]})}),L?n.jsx(y,{}):n.jsxs("div",{className:o.table,children:[n.jsx("div",{children:D}),n.jsxs("div",{className:B(o.table__footer,{[o.active]:b<=m?.length}),children:[n.jsx(J,{setCurrentTableData:f,users:m,currentPage:h,pageSize:b,onPageChange:t=>{w(t)}}),n.jsx(E,{extraClass:o.table__btn,onClick:I,type:c.filter(t=>t?.students?.length>0)[0]?"":"disabled",disabled:c.filter(t=>t?.students?.length>0)[0]?"":"disabled",children:"Create"})]})]})]})})};export{ns as FlowListPage};
