import{l as v,n as d,o as D,k as N,r as n,j as o,D as F,i as A,B as H,u as B,A as E,h as O}from"./index-Cux8sda1.js";import{F as T}from"./flowList-DzAYIuIr.js";import{f as y,g as G,a as R}from"./groupsAttendanceSlice-DmRNDpcI.js";import"./userProfileSlice-BflEK4KO.js";import"./studentsSlice-JQcNq_2O.js";import{f as q}from"./flowsSlice-BXoIT3Tq.js";import"./modal-BR27MEf1.js";import"./textArea-1604NtUh.js";import"./form-C3mZZqBW.js";import{P as z}from"./pagination-Cj0p_t2O.js";import{getSearchValue as J}from"./index-Dvh1lTlU.js";import{o as M}from"./alertSlice-XeBTN8B3.js";import"./user_image-CruVt77w.js";import"./switch-sjHY-EbU.js";import"./index-CO9axSa1.js";import"./oftenUsedSelector-B4R2CTqR.js";import"./teacherParseSlice-z7KSx3F7.js";import"./teacherThunk-qU_2Y3xX.js";import"./filters.module-C8GjSCwu.js";import"./cross-BXlnQeE0.js";const U="_flow_14ck2_1",V="_flowListHeader_14ck2_4",$="_table__footer_14ck2_24",K="_active_14ck2_31",Q="_table__btn_14ck2_35",l={flow:U,flowListHeader:V,table__footer:$,active:K,table__btn:Q},bs=()=>{const{request:C}=B(),i=v(),u=d(D)?.id,x=N();n.useEffect(()=>{u&&(i(q()),i(y({userBranchId:u})))},[u]);const _=d(G),L=d(R),m=d(J);let g=n.useMemo(()=>50,[]);const[k,f]=n.useState([]),[p,b]=n.useState(1),[c,h]=n.useState([]),w=n.useMemo(()=>{const t=_?.slice();return b(1),m?t.filter(r=>r.name?.toLowerCase().includes(m.toLowerCase())):t},[_]),S=t=>{f(r=>r.map(e=>e?.id===+t?e.isCheck?(h(s=>s.filter(a=>a?.classId!==e?.id)),{isCheck:!1,id:e.id,students:e.students.map(s=>({...s,isCheck:!1,id:s.id})),class_number:e.class_number,color:e.color}):(h(s=>s.filter(a=>a?.classId===e?.id)[0]?[...s.filter(a=>a?.classId!==e.id),{classId:e?.id,students:e?.students?.map(a=>a?.id)}]:[...s,{classId:e?.id,students:e?.students?.map(a=>a?.id)}]),{isCheck:!0,id:e.id,students:e.students.map(s=>({...s,isCheck:!0,id:s.id})),class_number:e.class_number,color:e.color}):e))},j=(t,r)=>{h(e=>e.filter(s=>s?.classId===+r)[0]?e.map(s=>{if(s?.classId===r)return{classId:s?.classId,students:s?.students.includes(+t)?s.students.filter(a=>a!==+t):[...s.students,+t]}}):[...e,{classId:+r,students:[+t]}])};n.useEffect(()=>{f(t=>t.map(r=>{const e=c.filter(s=>s?.classId===r.id)[0];return e?{isCheck:e?.students?.length===r.students.length,id:r.id,students:r.students.map(s=>e?.students?.includes(s.id)?{...s,isCheck:!0,id:s.id}:{...s,isCheck:!1,id:s.id}),class_number:r.class_number,color:r.color}:r}))},[c,p]);const I=()=>{let t=[];c.map(s=>{s?.students?.map(a=>t.push(a))});const r=localStorage.getItem("flowData"),e={...JSON.parse(r),students:t,classes:[]};C(`${E}Flow/flow-list-create/`,"POST",JSON.stringify(e),O()).then(s=>{i(M({type:"success",msg:s.msg,status:!0})),localStorage.removeItem("flowData")}).then(()=>{x(-2)})},P=k.map((t,r)=>o.jsx(T,{currentPage:p,flowList:t,onChangeAll:S,onChangeSingle:j,number:r},r));return o.jsxs("div",{className:l.flow,children:[o.jsx("div",{className:l.flowListHeader,children:o.jsxs("div",{children:[o.jsx("span",{children:"No"}),o.jsx("span",{children:"Sinf Raqami"})]})}),L?o.jsx(F,{}):o.jsxs("div",{className:l.table,children:[o.jsx("div",{children:P}),o.jsxs("div",{className:A(l.table__footer,{[l.active]:g<=w.length}),children:[o.jsx(z,{setCurrentTableData:f,users:w,currentPage:p,pageSize:g,onPageChange:t=>{b(t)}}),o.jsx(H,{extraClass:l.table__btn,onClick:I,type:c.filter(t=>t?.students?.length>0)[0]?"":"disabled",disabled:c.filter(t=>t?.students?.length>0)[0]?"":"disabled",children:"Create"})]})]})]})};export{bs as FlowListPage};
