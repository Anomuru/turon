import{u as w,r as c,j as n,bt as M,D as R,C as Y,i as E,A as $,k as K,bu as z,o as N,a2 as B,a as P,bv as U,bw as W,bx as G,by as Q}from"./index-B1KXs2zi.js";import{bz as de}from"./index-B1KXs2zi.js";const X="_calendarList_1mi5e_1",Z={calendarList:X},ee=i=>{const{setActive:u,currentData:I,loading:A,data:S,onSubmit:L,isChanged:C,setIsChanged:a}=i,{request:g}=E(),b=w(),[m,y]=c.useState([]),[x,f]=c.useState(!1),[j,s]=c.useState(null),p=()=>{g(`${$}Calendar/delete-type/`,"DELETE",JSON.stringify({days:j}),K()).then(e=>{b(z(e)),b(N({type:"success",status:!0,msg:`${e.length>1?"Kunlar":"Kun"} o'chirildi`})),f(!1)}).catch(e=>console.log(e))},D=e=>{s(e),f(!0)};c.useEffect(()=>{C?(y([]),a(!1)):m.length&&u(e=>({...e,days:m}))},[C,m]);const O=(e,t,h,r,o)=>{let l=h.map((d,H)=>{if(d.startId&&!d?.finishId){const _=d.startId<e?d.startId:e,k=d.startId<e?e:d.startId;return u(J=>({...J,finishValue:t,startId:_,finishId:k})),{startId:_,finishId:k}}else return!d?.startId&&h[H-1]?.finishId!==e?{startId:e}:d});const v=l[l.length-1].startId&&l[l.length-1].finishId?[...l,{}]:l;r(v),o([])};function T(e,t){let h=[...e].sort(q),r=0,o=[],l=[];const v=h.length+t<=35?35:42;for(;r<v;)r<t?o.push(""):r-t<h.length?o.push({id:h[r-t],value:h[r-t]}):o.push(""),o.length===7&&(l.push(o),o=[]),r=r+1;return l}function q(e,t){return e.id-t.id}const F=c.useCallback(()=>S&&[...S].map((e,t)=>n.jsx(M,{month:t,setActive:u,data:e.months,onActiveDays:O,sortWeeksDays:T,currentData:I.id===t?I:{},setSelected:y,onSubmit:L,isChanged:C,setIsChanged:a,onSubmitDelete:D},t)),[I,S]),V=A?n.jsx(R,{}):F();return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:Z.calendarList,children:V}),n.jsx(Y,{type:"danger",active:x,setActive:f,onClick:p})]})},te=i=>i.calendarSlice.data,se=i=>i.calendarSlice.loading,ae="_calendarPage_1oety_1",ne={calendarPage:ae},le=()=>{const{request:i}=E(),u=w(),{register:I,handleSubmit:A,setValue:S}=B(),L=P(te),C=P(se),[a,g]=c.useState({}),[b,m]=c.useState({}),[y,x]=c.useState(!1),f=new Date().getFullYear(),j=s=>{let p;m({...s,...a,color:s?.color??"black"}),a?.length?p={...s,days:a,color:s?.color??"black"}:a?.selected?.length?p={...s,days:a?.selected,color:s?.color??"black"}:p={...s,...a,color:s?.color??"black"},i(`${$}Calendar/change-type/`,"POST",JSON.stringify(p),K()).then(D=>{u(Q(D)),u(N({type:"success",status:!0,msg:`${D.length>1?"Kunlar":"Kun"} qo'shildi`}))}).catch(D=>console.log(D)),g({}),x(!0)};return c.useEffect(()=>{u(U({current_year:f,next_year:f+1}))},[]),n.jsxs("div",{className:ne.calendarPage,children:[n.jsx(W,{}),n.jsx(ee,{setActive:g,currentData:b,loading:C,data:L,onSubmit:g,onDelete:s=>s([{}]),isChanged:y,setIsChanged:x}),n.jsx(G,{active:a?.finishValue||a?.length,setActive:g,onSubmit:A(j),register:I,setValue:S,success:b})]})};export{le as CalendarPage,de as calendarSlice};
