import{b as A,j as e,w as E,u as O,a as d,dP as ve,r as s,cH as ye,h as J,C as Be,i as U,A as I,k as V,o as W,dQ as Ne,l as X,g as Z,B as w,dk as K,dR as Pe,dS as we,M as ee,D as q,I as te,dT as se,dU as De,a2 as ke,at as Fe,dV as Le,dW as Re,as as qe,dX as Me,dY as Te,dZ as $e,d_ as Ae,d$ as Ee,e0 as Oe,bI as Ie,e1 as Ge,aw as ze,cG as He,az as Ye,e2 as Je,e3 as Qe,e4 as Ue,P as Ve,e5 as We,aJ as Xe,S as L,e6 as Ze}from"./index-B1KXs2zi.js";import{C as Ke}from"./classAddForm-BB3bozwj.js";import{g as et}from"./searchSelector-CJfw-E7m.js";import{M as tt}from"./MultiPage-OkwmnpSM.js";const $={},st=({currentTableData:i})=>{const l=A(),_=()=>i?.map((n,x)=>e.jsxs("tr",{onClick:()=>l(`profile/${n?.id}`),children:[e.jsx("td",{children:x+1}),e.jsxs("td",{children:[n?.user?.name," ",n?.user?.surname]}),e.jsx("td",{children:n?.user?.age}),e.jsx("td",{children:n?.user?.phone}),e.jsx("td",{children:n?.group?.name?n.group.name:`${n?.class_number} ${n?.group?.color}`}),e.jsx("td",{children:e.jsx("div",{style:{width:"fit-content",border:n.color?`2px solid #${n.color}`:"2px solid black",color:`${n.color}`,padding:"1.5rem",borderRadius:"10px"},children:n.debt})})]},n.id));return e.jsx("div",{className:$.students,children:e.jsx("div",{className:$.table,children:e.jsxs(E,{extraClass:$.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nomer"}),e.jsx("th",{children:"Guruh nomi"}),e.jsx("th",{children:"Qarzi "})]})}),e.jsx("tbody",{children:_()})]})})})},nt="_deletedStudents_9pq9e_1",at="_deletedStudents__menu_9pq9e_11",rt="_active_9pq9e_25",b={deletedStudents:nt,deletedStudents__menu:at,active:rt},lt=({currentTableData:i})=>{const l=O(),_=d(ve),[n,x]=s.useState("all"),[p,y]=s.useState([]),[r,u]=s.useState([]),o=A(),[g,S]=s.useState(!1),[B,N]=s.useState(!1);s.useEffect(()=>{l(ye())},[]);const{request:P}=U(),c=()=>{P(`${I}Students/delete-student-from-deleted/${B}/`,"DELETE",null,V()).then(t=>{l(W({type:"success",status:!0,msg:t.msg}))}),S(!1),l(Ne(B))},v=()=>i?.map((t,m)=>n==="all"?e.jsxs("tr",{children:[e.jsx("td",{children:m+1}),e.jsxs("td",{onClick:()=>o(`profile/${t?.student?.id}`),children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{N(t.student.id),S(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):t?.group_reason?.id===n?e.jsxs("tr",{onClick:()=>o(`profile/${t.id}`),children:[e.jsx("td",{children:m+1}),e.jsxs("td",{children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{N(t.student.id),S(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):null);return e.jsxs("div",{className:b.deletedStudents,children:[e.jsxs("ul",{className:b.deletedStudents__menu,children:[e.jsx("li",{className:J(b.other__item,{[b.active]:n==="all"}),onClick:()=>{x("all")},children:"Hammasi"},6),_?.map((t,m)=>e.jsx("li",{className:J(b.other__item,{[b.active]:n===t.id}),onClick:()=>{x(t.id)},children:t.name},m))]}),e.jsx("div",{className:b.table,children:e.jsxs(E,{extraClass:b.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nome"}),e.jsx("th",{children:"Guruh"}),e.jsx("th",{children:"Reg.sana"}),e.jsx("th",{children:"O'chir.sana"}),e.jsx("th",{children:"Sabab"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:v()})]})}),e.jsx(Be,{onClick:c,title:"Qaytarish",text:"Studentni rostanham qaytarmoqchimisiz",type:"danger",active:g,setActive:S})]})},dt="_mainContainer_1xe50_1",ct="_mainContainer_buttonPanelBox_1xe50_4",ot="_mainContainer_buttonPanelBox_leftCreateButton_1xe50_8",it="_mainContainer_filterPanelBox_1xe50_11",ut="_mainContainer_filterPanelBox_rightFilterRadioGroupBox_1xe50_15",ht="_activeFilter_1xe50_20",f={mainContainer:dt,mainContainer_buttonPanelBox:ct,mainContainer_buttonPanelBox_leftCreateButton:ot,mainContainer_filterPanelBox:it,mainContainer_filterPanelBox_rightFilterRadioGroupBox:ut,activeFilter:ht},_t=({onChange:i,selectedRadio:l,peoples:_,setActive:n,onClick:x})=>{const{theme:p}=X(),y=d(Z),r=A(),u=s.useCallback(()=>e.jsx(e.Fragment,{children:e.jsx(w,{type:"filter",extraClass:f.extraCutClass,onClick:()=>x("create"),children:"Create Class"})}),[p]);return e.jsxs("div",{className:f.mainContainer,children:[e.jsx("div",{className:f.mainContainer_buttonPanelBox,children:e.jsxs("div",{className:f.mainContainer_buttonPanelBox_leftCreateButton,children:[u(),e.jsx(w,{onClick:()=>x("add"),type:"filter",extraClass:f.noneBackground,children:"Add class"}),e.jsx(w,{onClick:()=>r("RGBData"),type:"filter",children:"RB-Baza"})]})}),e.jsxs("div",{className:f.mainContainer_filterPanelBox,children:[e.jsx(w,{status:"filter",extraClass:f.extraCutClassFilter,onClick:()=>n("filter"),type:"filter",children:"Filter"}),e.jsx("a",{style:{color:"white"},href:`${I}Students/export-students/?branch=${y.id}&format=json`,children:e.jsx(w,{type:"simple",children:"Exel"})}),e.jsx("div",{className:f.mainContainer_filterPanelBox_rightFilterRadioGroupBox,children:_.map((o,g)=>e.jsx(K,{onChange:()=>i(o.name),checked:l===o.name,extraClasses:l===o.name?f.activeFilter:null,children:o.label},g))})]})]})},xt="_createClass_s3igw_1",mt="_createClass__input_s3igw_6",gt="_createClass__btn_s3igw_9",jt="_createClass__inner_s3igw_13",R={createClass:xt,createClass__input:mt,createClass__btn:gt,createClass__inner:jt},Ct=s.memo(i=>{const{active:l,setActive:_,data:n,branch:x,deactiveModal:p}=i,{request:y}=U(),r=O(),u=d(Pe),o=d(we),[g,S]=s.useState([]);s.useEffect(()=>{S([])},[u]);const B=()=>{const c={...n,students:g};y(`${I}Group/groups/create/`,"POST",JSON.stringify(c),V()).then(v=>{r(W({type:"success",status:!0,msg:"Sinf yaratildi"})),r(se({userBranchId:x})),_(!1),p(!1)})},P=o==="loading"||o==="idle"?e.jsx(q,{}):u?.map((c,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:v+1}),e.jsxs("td",{children:[c.user?.surname," ",c.user?.name]}),e.jsx("td",{children:c.user?.age}),e.jsx("td",{children:c.user?.language}),e.jsx("td",{children:c?.class_number}),e.jsx("td",{children:c.user?.registered_date}),e.jsx("td",{children:e.jsx(te,{extraClassName:R.createClass__input,type:"checkbox",onChange:()=>S(t=>t.filter(m=>m===c.id)[0]?t.filter(m=>m!==c.id):[...t,c.id])})})]}));return e.jsx(ee,{active:l,setActive:_,children:e.jsxs("div",{className:R.createClass,children:[e.jsx("h1",{children:"O'quvchi tanlang"}),e.jsx("div",{className:R.createClass__inner,children:e.jsxs(E,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"â„–"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:P})]})}),e.jsx(w,{onClick:B,extraClass:R.createClass__btn,children:"Create"})]})})}),St=(i,l)=>{localStorage.setItem(i,l)},ft=i=>localStorage.getItem(i),pt="_tableMain_c2dxc_1",bt="_modal_c2dxc_16",vt="_modal__error_c2dxc_21",yt="_modal__form_c2dxc_26",Bt="_modal__select_c2dxc_31",Nt="_modal__radios_c2dxc_34",Pt="_modal__inner_c2dxc_40",wt="_modal__item_c2dxc_46",Dt="_modal__input_c2dxc_49",h={tableMain:pt,modal:bt,modal__error:vt,modal__form:yt,modal__select:Bt,modal__radios:Nt,modal__inner:Pt,modal__item:wt,modal__input:Dt},Q=[{name:"new_students",label:"New Students"},{name:"studying_students",label:"Studying Students"},{name:"deleted_students",label:"Deleted Students"}],$t=()=>{const{theme:i}=X(),l=O(),[_]=De(),{register:n,handleSubmit:x}=ke(),p=JSON.parse(localStorage.getItem("selectedSystem")),{id:y}=d(Z),r=y,u=d(et),o=d(Fe),g=d(Le),S=d(Re),B=d(qe),N=d(Me),P=d(Te),c=d($e),v=d(Ae),t=d(Ee),m=d(Oe),[kt,Ft]=s.useState(null),[j,G]=s.useState(ft("selectedRadio")||Q[0].name),[ne,ae]=s.useState({}),[M,re]=s.useState(),[le,z]=s.useState(!1),[de,ce]=s.useState(),[H,D]=s.useState(!1),[Y,k]=s.useState(""),[oe,ie]=s.useState(""),[F,ue]=s.useState([]),[he,T]=s.useState(1),[_e,xe]=s.useState(!0),me=d(Ie);let ge=s.useMemo(()=>50,[]);const je=s.useMemo(()=>{let a=[];switch(j){case"new_students":a=P?.slice();break;case"studying_students":a=N?.slice();break;case"deleted_students":a=c?.slice();break;default:a=[]}return T(1),u?a.filter(C=>C.user?.name?.toLowerCase().includes(u.toLowerCase())||C.user?.surname?.toLowerCase().includes(u.toLowerCase())||C?.student?.user?.name.toLowerCase().includes(u.toLowerCase())||C?.student?.user?.surname.toLowerCase().includes(u.toLowerCase())):a},[P,N,c,u,j,oe]);s.useEffect(()=>{r&&(l(Ge(r)),l(ze()))},[r]),s.useEffect(()=>{p?.name==="school"&&r&&(l(He()),l(Ye({branch:r})))},[p?.name,r]);const Ce=a=>{if(!M&&g.length<=3)return z(!0),null;const C={...a,teacher:[+de],color:a?.color??M,branch:r,create_type:"school",system:p.id};ae(C),k("post")},Se=a=>{xe(o.filter(C=>C.id===+a)[0]?.price===0||!o.filter(C=>C.id===+a)[0]?.price),l(Ze({branch:r,number:a}))};s.useEffect(()=>{if(r)switch(j){case"new_students":l(se({userBranchId:r}));break;case"studying_students":l(Qe({userBranchId:r}));break;case"deleted_students":l(Je({id:r}));break}},[l,j,r]),s.useEffect(()=>{const a=_.get("type");a&&G(a)},[_]),s.useEffect(()=>{St("selectedRadio",j)},[j]);const fe=a=>{G(a)},pe=s.useCallback(()=>{switch(j){case"new_students":return v==="loading"?e.jsx(q,{}):e.jsx(Ue,{branchId:r,theme:i==="app_school_theme",currentTableData:F});case"deleted_students":return m==="loading"?e.jsx(q,{}):e.jsx(lt,{currentTableData:F});case"studying_students":return t==="loading"?e.jsx(q,{}):e.jsx(st,{currentTableData:F});default:return null}},[v,m,t,j,F])(),be=s.useMemo(()=>[{name:"Yangi o'quvchilar",type:"new_students"},{name:"O'chirilgan o'quvchilar",type:"deleted_students"},{name:"O'qiyotgan o'quvchilar",type:"studying_students"}],[]);return e.jsxs(tt,{types:be,page:"students",children:[e.jsx(_t,{setActive:k,onChange:fe,selectedRadio:j,peoples:Q,onClick:D}),e.jsx("div",{className:h.tableMain,children:pe}),e.jsx(Ve,{setCurrentTableData:ue,users:je,setCurrentPage:T,currentPage:he,pageSize:ge,onPageChange:a=>{T(a)},type:"custom"}),e.jsx(We,{active:Y==="filter",setActive:k,activePage:j,setIsFilter:ie,branchId:r}),e.jsx(ee,{active:H==="create",setActive:D,children:e.jsxs("div",{className:h.modal,children:[e.jsx("h1",{children:"Sinf yaratish"}),e.jsxs(Xe,{onSubmit:x(Ce),extraClassname:h.modal__form,typeSubmit:_e?"":"inside",children:[me.name==="school"?null:e.jsx(te,{required:!0,extraClassName:h.modal__input,placeholder:"Sinf nomi",name:"name",register:n}),e.jsx(L,{required:!0,extraClass:h.modal__select,title:"O'qituvchi",options:S,onChangeOption:ce}),e.jsx(L,{required:!0,extraClass:h.modal__select,title:"Til",options:B,register:n,name:"language"}),e.jsx(L,{required:!0,extraClass:h.modal__select,title:"Sinf raqami",options:o,register:n,onChangeOption:Se,name:"class_number"}),le?e.jsx("span",{className:h.modal__error,children:"Sinfga rang tanlang"}):null,g.length<=3?e.jsx("div",{className:h.modal__radios,children:g?.map(a=>e.jsxs("div",{className:h.modal__inner,children:[e.jsx(K,{extraClasses:h.modal__item,onChange:()=>{re(a.id),z(!1)},checked:M===a.id,name:"color"}),a.name]}))}):e.jsx(L,{required:!0,extraClass:h.modal__select,title:"Sinf rangi",name:"color",options:g,register:n})]})]})}),e.jsx(Ke,{branch:r,setActive:D,active:H==="add"}),e.jsx(Ct,{deactiveModal:D,setActive:k,active:Y==="post",data:ne,branch:r})]})};export{$t as StudentsPage};
