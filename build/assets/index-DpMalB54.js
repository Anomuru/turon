import{b as $,a2 as T,r as l,u as E,j as e,B as S,w as R,D as V,M as D,I as q,aJ as B,S as L,aB as z,bh as J,a as f,bi as H,bj as U,bk as G,bl as K,bm as O,bn as Q,F as W,bo as X,bp as Y,bq as Z,g as ee,n as se,br as te,s as ae,P as le,i as de,A as ne,k as oe,bs as re}from"./index-B1KXs2zi.js";import{g as ce}from"./searchSelector-CJfw-E7m.js";import{M as ie}from"./MultiPage-OkwmnpSM.js";const ue="_flow_t6vt0_1",_e="_flowMain_t6vt0_7",fe="_flowMain__wrapper_t6vt0_12",he="_flow__header_t6vt0_15",xe="_flow__filter_t6vt0_23",we="_modal_t6vt0_57",je="_flowModal_t6vt0_61",me="_flowModalHeader_t6vt0_64",be="_flowModalForm_t6vt0_69",_={flow:ue,flowMain:_e,flowMain__wrapper:fe,flow__header:he,flow__filter:xe,modal:we,flowModal:je,flowModalHeader:me,flowModalForm:be},pe=({currentTableData:I,teacherData:C,loading:N,levelData:h,getLevelData:b,setActive:p,branchId:F})=>{const i=$(),{register:n,handleSubmit:j,setValue:y}=T(),[r,v]=l.useState(!1),[A,g]=l.useState(!1),[x,k]=l.useState(!1),[u,P]=l.useState([]);E();const[o,m]=l.useState(!1),w=t=>{const s={...t,activity:o,branch:F};localStorage.setItem("flowData",JSON.stringify(s)),i("flow-list")};l.useEffect(()=>{u&&y("subject",u[0]?.id)},[u]);const d=()=>I?.map((t,s)=>e.jsxs("tr",{onClick:()=>i(`./flowsProfile/${t?.id}`),children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:t?.name}),e.jsxs("td",{children:[t?.subject_name,t?.level_name?` / ${t?.level_name}`:null]}),e.jsx("td",{children:t?.student_count}),e.jsxs("td",{children:[t?.teacher_name,t?.teacher_surname]})]}));return e.jsxs("div",{className:_.flowMain,children:[e.jsxs("div",{className:_.flow__filter,children:[e.jsx(S,{onClick:()=>k(!x),type:"simple-add",children:"Filter"}),e.jsxs("div",{className:_.flowMain__wrapper,children:[e.jsx(S,{onClick:()=>v(!r),type:"simple",children:"Create Flow"}),e.jsx(S,{type:"simple-add",onClick:()=>p(!0),children:"Add Flow"})]})]}),e.jsxs(R,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Nomi"}),e.jsx("th",{children:"Fan Level"}),e.jsx("th",{children:"O'quvchi soni"}),e.jsx("th",{children:"O'qituvchisi"})]})}),N==="loading"?e.jsx(V,{}):e.jsx("tbody",{children:d()})]}),e.jsxs(D,{active:r,setActive:v,extraClass:_.modal,children:[e.jsx("h2",{children:"Create Flow"}),e.jsxs("div",{className:_.flowModal,children:[e.jsxs("div",{className:_.flowModalHeader,children:[e.jsx("h3",{children:"Activity"}),e.jsx(q,{onChange:()=>m(!o),type:"checkbox"})]}),e.jsx("div",{className:_.flowModalForm,children:e.jsxs(B,{typeSubmit:"",onSubmit:j(w),action:"",children:[e.jsx(q,{placeholder:"Nomi",register:n,name:"name",required:!0}),o?null:e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"O'qituvchini tanlang",options:C,onChangeOption:t=>{t&&b(t),P(C.filter(s=>s.id===+t)[0]?.subject)},register:n,name:"teacher"}),u?.length?e.jsx(L,{title:"Fan",options:u,register:n,name:"subject",defaultValue:u[0]?.id}):null,h?.length?e.jsx(L,{title:"Level",options:h,register:n,name:"level"}):null,e.jsx(z,{placeholder:"Koment",register:n,name:"comment"})]}),e.jsx(S,{children:"Next"})]})})]})]}),e.jsxs(D,{active:A,setActive:g,children:[e.jsx("h2",{children:"Add Flow"}),e.jsx("div",{className:_.flowModalForm,children:e.jsxs(B,{typeSubmit:"",children:[e.jsx(L,{}),e.jsx(S,{type:"simple",children:"Add"})]})})]}),e.jsx(J,{active:x,setActive:k})]})},Fe="_addForm_1tbfl_1",ve="_addForm__btn_1tbfl_7",ge="_addModal_1tbfl_12",Me="_addModal__header_1tbfl_21",Se="_addModal__inner_1tbfl_31",Ce="_addModal__container_1tbfl_37",Ae="_addModal__btn_1tbfl_95",M={addForm:Fe,addForm__btn:ve,addModal:ge,addModal__header:Me,addModal__inner:Se,addModal__container:Ce,addModal__btn:Ae},ke=l.memo(I=>{const{active:C,setActive:N}=I,h=E(),{register:b,handleSubmit:p}=T(),F=f(H),i=f(U),n=f(G),j=f(K),[y,r]=l.useState([]),[v,A]=l.useState(!1),[g,x]=l.useState([]);l.useEffect(()=>{h(O(n))},[]),l.useEffect(()=>{j&&r(j)},[j]),l.useEffect(()=>{n&&i&&h(Q({flow:i?.id,branch:n,res:{ignore_students:i?.students.map(d=>d?.id)}}))},[n,i]);const k=d=>{h(X({id:d?.flow})),A(!0)},u=()=>{let d=[];g.map(s=>{s?.students?.map(a=>d.push(a))});const t={update_type:"add_students",students:d};h(Y({id:i?.id,res:t}))},P=d=>{r(t=>t.map(s=>s.id===+d?s.isCheck?(x(a=>a.filter(c=>c.classId!==s.id)),{isCheck:!1,id:s.id,students:s.students.map(a=>({isCheck:!1,id:a.id,extra_info:a.extra_info,user:a.user})),class_number:s.class_number,color:s.color}):(x(a=>a.filter(c=>c.classId===s.id)[0]?[...a.filter(c=>c.classId!==s.id),{classId:s.id,students:s?.students?.map(c=>c?.id)}]:[...a,{classId:s.id,students:s?.students?.map(c=>c?.id)}]),{isCheck:!0,id:s.id,students:s.students.map(a=>({isCheck:!0,id:a.id,extra_info:a.extra_info,user:a.user})),class_number:s.class_number,color:s.color}):s))},o=(d,t)=>{x(s=>s.filter(a=>a?.classId===+t)[0]?s.map(a=>{if(a?.classId===t)return{classId:a.classId,students:a.students.includes(+d)?a.students.filter(c=>c!==+d):[...a.students,+d]}}):[...s,{classId:+t,students:[+d]}])};l.useEffect(()=>{r(d=>d.map(t=>{const s=g.filter(a=>a?.classId===t.id)[0];return s?{isCheck:s?.students?.length===t.students.length,id:t.id,students:t.students.map(a=>s?.students?.includes(a.id)?{isCheck:!0,id:a.id,extra_info:a.extra_info,user:a.user}:{isCheck:!1,id:a.id,extra_info:a.extra_info,user:a.user}),class_number:t.class_number,color:t.color}:t}))},[g]);const w=y.map((d,t)=>e.jsx(W,{flowList:d,onChangeAll:P,onChangeSingle:o,number:t},t));return e.jsxs(e.Fragment,{children:[e.jsx(D,{active:C,setActive:N,children:e.jsxs(B,{extraClassname:M.addForm,onSubmit:p(k),typeSubmit:"",children:[e.jsx("h2",{children:"Add Flow"}),e.jsx(L,{options:F,register:b,title:"Patok",name:"flow"}),e.jsx(S,{extraClass:M.addForm__btn,children:"Tekshirmoq"})]})}),e.jsxs(D,{active:v,setActive:A,extraClass:M.addModal,children:[e.jsx("div",{className:M.addModal__header,children:e.jsxs("div",{className:M.addModal__inner,children:[e.jsx("span",{children:"No"}),e.jsx("span",{children:"Sinf Raqami"})]})}),e.jsx("div",{className:M.addModal__container,children:w}),e.jsx(S,{extraClass:M.addModal__btn,onClick:u,children:"Add"})]})]})}),Pe=()=>{let I=l.useMemo(()=>50,[]);const[C,N]=l.useState([]),[h,b]=l.useState(1),p=f(ce),F=localStorage.getItem("selectedBranch"),{request:i}=de(),n=E(),j=f(H),y=f(Z),r=f(ee),v=f(se),A=f(te),[g,x]=l.useState(!1),k=l.useMemo(()=>{const o=j?.filter(m=>!m.deleted)||[];return b(1),p?o.filter(m=>m?.name?.toLowerCase().includes(p.toLowerCase())):o},[j,p]);l.useEffect(()=>{n(O(r?.id))},[r]),l.useEffect(()=>{F&&n(ae({userBranchId:F}))},[F]);const u=o=>{const m=v.filter(w=>w.id===+o)[0]?.subject[0]?.id;i(`${ne}Subjects/level-for-subject/${m}/`,"GET",null,oe()).then(w=>{n(re(w))}).catch(w=>console.log(w))},P=l.useMemo(()=>[{name:"Flows",type:"flows"}],[]);return e.jsx(ie,{types:P,page:"students",children:e.jsxs("div",{className:_.flow,children:[e.jsx("div",{className:_.flow__header}),e.jsx(pe,{branchId:r?.id,currentTableData:C,loading:y,teacherData:v,levelData:A,getLevelData:u,setActive:x}),e.jsx(le,{setCurrentTableData:N,users:k,setCurrentPage:b,currentPage:h,pageSize:I,onPageChange:o=>{b(o)},type:"custom"}),e.jsx(ke,{userBranchId:r.id,active:g,setActive:x})]})})};export{Pe as FlowsPage};
