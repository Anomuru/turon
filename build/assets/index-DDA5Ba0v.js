import{r,a as k,bd as ie,j as e,T as U,aa as v,h as W,A as I,i as D,ab as Z,g as O,u as z,I as M,bc as ce,R as F,z as le,S as de,B as A,ar as G,a9 as me}from"./index-DOfOZKEd.js";import"./pagination-ajK0EmM0.js";import{a as ue,V as he,v as _e}from"./vacancyPageEdit-laTWtwct.js";import"./editableCard-CFY1EtAX.js";const xe="_theadBody_3ewuw_21",ke="_workerList_3ewuw_41",ge="_workerSetting_3ewuw_48",Ce="_userImage_3ewuw_52",$={theadBody:xe,workerList:ke,workerSetting:ge,userImage:Ce},K="/assets/workerImg-CZ_Hr2mO.svg",Q="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.70833%2017.3346L6.375%2014.668C6.19444%2014.5985%206.02431%2014.5152%205.86458%2014.418C5.70486%2014.3207%205.54861%2014.2166%205.39583%2014.1055L2.91667%2015.1471L0.625%2011.1888L2.77083%209.5638C2.75694%209.46658%202.75%209.37283%202.75%209.28255V8.72005C2.75%208.62977%202.75694%208.53602%202.77083%208.4388L0.625%206.8138L2.91667%202.85547L5.39583%203.89714C5.54861%203.78602%205.70833%203.68186%205.875%203.58464C6.04167%203.48741%206.20833%203.40408%206.375%203.33464L6.70833%200.667969H11.2917L11.625%203.33464C11.8056%203.40408%2011.9757%203.48741%2012.1354%203.58464C12.2951%203.68186%2012.4514%203.78602%2012.6042%203.89714L15.0833%202.85547L17.375%206.8138L15.2292%208.4388C15.2431%208.53602%2015.25%208.62977%2015.25%208.72005V9.28255C15.25%209.37283%2015.2361%209.46658%2015.2083%209.5638L17.3542%2011.1888L15.0625%2015.1471L12.6042%2014.1055C12.4514%2014.2166%2012.2917%2014.3207%2012.125%2014.418C11.9583%2014.5152%2011.7917%2014.5985%2011.625%2014.668L11.2917%2017.3346H6.70833ZM8.16667%2015.668H9.8125L10.1042%2013.4596C10.5347%2013.3485%2010.934%2013.1853%2011.3021%2012.9701C11.6701%2012.7548%2012.0069%2012.4944%2012.3125%2012.1888L14.375%2013.043L15.1875%2011.6263L13.3958%2010.2721C13.4653%2010.0777%2013.5139%209.87283%2013.5417%209.65755C13.5694%209.44228%2013.5833%209.22352%2013.5833%209.0013C13.5833%208.77908%2013.5694%208.56033%2013.5417%208.34505C13.5139%208.12978%2013.4653%207.92491%2013.3958%207.73047L15.1875%206.3763L14.375%204.95964L12.3125%205.83464C12.0069%205.51519%2011.6701%205.24783%2011.3021%205.03255C10.934%204.81727%2010.5347%204.65408%2010.1042%204.54297L9.83333%202.33464H8.1875L7.89583%204.54297C7.46528%204.65408%207.06597%204.81727%206.69792%205.03255C6.32986%205.24783%205.99306%205.50825%205.6875%205.8138L3.625%204.95964L2.8125%206.3763L4.60417%207.70964C4.53472%207.91797%204.48611%208.1263%204.45833%208.33464C4.43056%208.54297%204.41667%208.76519%204.41667%209.0013C4.41667%209.22352%204.43056%209.4388%204.45833%209.64714C4.48611%209.85547%204.53472%2010.0638%204.60417%2010.2721L2.8125%2011.6263L3.625%2013.043L5.6875%2012.168C5.99306%2012.4874%206.32986%2012.7548%206.69792%2012.9701C7.06597%2013.1853%207.46528%2013.3485%207.89583%2013.4596L8.16667%2015.668ZM9.04167%2011.918C9.84722%2011.918%2010.5347%2011.6332%2011.1042%2011.0638C11.6736%2010.4944%2011.9583%209.80686%2011.9583%209.0013C11.9583%208.19575%2011.6736%207.50825%2011.1042%206.9388C10.5347%206.36936%209.84722%206.08464%209.04167%206.08464C8.22222%206.08464%207.53125%206.36936%206.96875%206.9388C6.40625%207.50825%206.125%208.19575%206.125%209.0013C6.125%209.80686%206.40625%2010.4944%206.96875%2011.0638C7.53125%2011.6332%208.22222%2011.918%209.04167%2011.918Z'%20fill='%236B7280'/%3e%3c/svg%3e",fe=({currentTableData:t,currentPage:s,PageSize:a,editMode:d,onEditClick:c})=>{const[l,u]=r.useState(!1),h=k(n=>n.vacancyWorkerSlice.workerData),w=Array.isArray(h)?h:[h],[C,x]=r.useState(null),b=`${ie()}`,P=n=>{u(!0),x(n)},y=()=>w?.map((n,_)=>e.jsxs("tr",{children:[e.jsx("td",{children:(s-1)*a+_+1}),e.jsxs("td",{className:$.workerList,children:[n?.profile_img?e.jsx("img",{className:$.userImage,src:`${b}${n.profile_img}`,alt:""}):e.jsx("img",{src:K,alt:""}),`${n?.name} - ${n?.surname}`," ",e.jsx("img",{className:$.workerSetting,onClick:()=>P(n?.id),src:Q,alt:""})]})]},n?.id));return e.jsx(e.Fragment,{children:e.jsxs(U,{children:[e.jsx("thead",{className:$.theadBody,children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Worker"})]})}),e.jsx("tbody",{children:y()}),C&&e.jsx(ue,{user_id:C,active:l,setActive:u})]})})},pe=[{id:1,workName:"Kimdir",workerNames:"Nima yozishni bilmadim"},{id:2,workName:"O'quvchi",workerNames:"Nima yozishni bilmadim"},{id:3,workName:"Manager",workerNames:"Nima yozishni bilmadim"},{id:4,workName:"Admin",workerNames:"Nima yozishni bilmadim"},{id:5,workName:"Qo'shni",workerNames:"Nima yozishni bilmadim"},{id:6,workName:"Sattor aka",workerNames:"Nima yozishni bilmadim"},{id:7,workName:"Ko'chani boshidagi brat",workerNames:"Nima yozishni bilmadim"}],be=[{workerImg:K,workerName:"Mahmud Yuldoshov",workerSetting:Q}],we="_deletedGroups_16ogk_1",je="_mainContainer_filterPanelBox_16ogk_1",Pe="_mainContainer_buttonPanelBox_16ogk_35",ye="_mainContainer_buttonPanelBox_leftCreateButton_16ogk_42",Se="_mainContainer_buttonPanelBox_leftCreateButtons_16ogk_50",Ne="_mainContainer_tablePanelBox_16ogk_86",Be="_buttonHelper_16ogk_101",Le="_buttonHelpers_16ogk_110",p={deletedGroups:we,mainContainer_filterPanelBox:je,mainContainer_buttonPanelBox:Pe,mainContainer_buttonPanelBox_leftCreateButton:ye,mainContainer_buttonPanelBox_leftCreateButtons:Se,mainContainer_tablePanelBox:Ne,buttonHelper:Be,buttonHelpers:Le},ve="_theadBody_adwtd_1",We="_checkBox_adwtd_15",J={theadBody:ve,checkBox:We},B=v("vacancyWorkPageSlice/fetchWorkerWithId",async t=>{const{request:s}=W();return await s(`${I}Permissions/job_profile/${t}`,"GET",null,D())}),E=v("vacancyWorkerPermissionSlice/fetchPermissionTable",async()=>{const{request:t}=W();return await t(`${I}Permissions/tables/`,"GET",null,D())}),V=v("vacancyWorkerPermissionSlice/postSelectedTable",async(t,{rejectWithValue:s})=>{const{request:a}=W();try{return await a(`${I}Permissions/tables/`,"POST",JSON.stringify({table:t}),D())}catch(d){return s(d.message)}});v("vacancyWorkerPermissionSlice/postSelectedTable",async t=>{const{request:s}=W();return await s(`${I}Permissions/job_profile/${t}`,"POST",JSON.stringify({permissions:{id:t}}),D())});const L=v("vacancyWorkerPermissionSlice/postSelectedPermission",async({id:t,selectedTable:s,selectedPermissions:a,selectedJobID:d})=>{const{request:c}=W();return await c(`${I}Permissions/job_profile/${t}`,"POST",JSON.stringify({job_id:d,permissions:a}),D())}),Ie={workerPermission:[],loading:!1,error:null};Z({name:"vacancyWorkPageSlice",initialState:Ie,reducers:{},extraReducers:t=>{t.addCase(B.pending,s=>{s.loading=!0}).addCase(B.fulfilled,(s,a)=>{s.loading=!1,s.workerPermission=a.payload}).addCase(B.rejected,(s,a)=>{s.loading=!1,s.error=a.error.message}).addCase(L.pending,s=>{s.loading=!0}).addCase(L.fulfilled,(s,a)=>{s.loading=!1;const d=a.payload.permissions,c=s.workerPermission.job.map(l=>l.id===a.meta.arg.selectedJobID?{...l,group:{...l.group,permissions:[...l.group.permissions,...d]}}:l);s.workerPermission={...s.workerPermission,job:c}}).addCase(L.rejected,(s,a)=>{s.loading=!1,s.error=a.error.message})}});const R=t=>t.vacancyWorkPageSlice?.workerPermission,De=t=>t.vacancyWorkPageSlice?.loading,Te=({currentTableData:t,currentPage:s,PageSize:a,editMode:d,onEditClick:c,selectedItems:l,setSelectedItems:u})=>{const h=k(O),w=z(),C=k(R);C.job?.map(n=>n.group.name);const x=k(De);r.useEffect(()=>{h&&w(B(h))},[w,h]);const b=n=>{n.target.checked?u(t.map(_=>_.id)):u([])},P=(n,_)=>{n.target.checked?u(f=>[...f,_]):u(f=>f.filter(o=>o!==_))},y=()=>x?e.jsx(ce,{}):C.job?.map((n,_)=>{const f=n.group.permissions||[];return e.jsx(F.Fragment,{children:f.map((o,i)=>e.jsxs("tr",{children:[e.jsx("td",{children:(s-1)*a+i+1}),e.jsx("td",{children:n.group.name}),e.jsx("td",{children:o.name}),!d&&e.jsx("td",{children:e.jsx(M,{style:{width:"25px"},type:"checkbox",checked:l.includes(n.id),onChange:m=>P(m,n.id)})})]},o.id))},n.id)});return e.jsxs(U,{children:[e.jsx("thead",{className:J.theadBody,children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Ishchi ismi"}),e.jsx("th",{children:"Ruxsatlari"}),!d&&e.jsx("th",{className:J.checkBox,children:e.jsx(M,{style:{width:"25px"},type:"checkbox",onChange:b,checked:l.length===t.length})})]})}),e.jsx("tbody",{children:y()})]})},He="_filter_1xl0c_1",$e="_filter__container_1xl0c_7",Ae="_filter__select_1xl0c_13",Ee="_workerPermission_1xl0c_51",Ve="_buttonHome_1xl0c_62",N={filter:He,filter__container:$e,filter__select:Ae,workerPermission:Ee,buttonHome:Ve},Me=t=>t.vacancyWorkerPermissionSlice?.tables,Oe=F.memo(({active:t,setActive:s,onAddVacancy:a})=>{const[d,c]=r.useState(""),[l,u]=r.useState([]),[h,w]=r.useState([]),C=k(R),x=z(),b=k(O),P=k(Me),y=C.job?.length?Number(C.job[0].id):null;r.useEffect(()=>{x(E())},[x]);const n=o=>{c(o),x(V(o)).then(i=>{V.fulfilled.match(i)?w(i.payload.permissions):console.error("Permissionlada xato",i.payload)})},_=(o,i)=>{o.target.checked?u(m=>[...m,i]):u(m=>m.filter(S=>S!==i))},f=()=>{const o={id:Date.now(),workName:d,workerNames:l.join(", ")};a(o),u([]),c(""),x(V(o));const i=h.permissions.filter(m=>l.includes(m.name)).map(m=>m.id);b&&x(L({id:b,selectedJobID:y,selectedPermissions:i})).then(m=>{if(L.fulfilled.match(m)){x(B(b));const S={id:Date.now(),permissions:i};a(S),u([]),c(""),s(!1)}else console.error("Xatolik yuz berdi",m.payload)})};return e.jsx(le,{active:t,setActive:s,children:e.jsxs("div",{className:N.filter,children:[e.jsx("h1",{children:"Add"}),e.jsxs("div",{className:N.filter__container,children:[e.jsx(de,{title:"Ish turi",extraClass:N.filter__select,onChangeOption:n,options:P.tables,required:!0,value:d}),h.permissions?.map(o=>e.jsxs("div",{className:N.workerPermission,children:[e.jsx("h4",{children:o.name}),e.jsx(M,{style:{width:"20px",marginTop:"15px"},type:"checkbox",checked:l.includes(o.name),onChange:i=>_(i,o.name)})]},o.id))]}),e.jsx("div",{className:N.buttonHome,children:e.jsx(A,{children:"Add",onClick:f})})]})})}),ze={tables:[],loading:!1,error:null};Z({name:"vacancyWorkerPermissionSlice",initialState:ze,reducers:{},extraReducers:t=>{t.addCase(E.pending,s=>{s.loading=!0}).addCase(E.fulfilled,(s,a)=>{s.loading=!1,s.tables=a.payload}).addCase(E.rejected,(s,a)=>{s.loading=!1,s.error=a.error.message})}});const Ue=()=>{const[t,s]=r.useState(!1),[a,d]=r.useState(!1),[c,l]=r.useState(!1),[u,h]=r.useState(!1),[w,C]=r.useState(!1),[x,b]=r.useState(1),[P,y]=r.useState(""),[n,_]=r.useState([]),[f,o]=r.useState(null),[i,m]=r.useState([]),[S,X]=r.useState(!1),Y=z();k(R);const q=r.useMemo(()=>20,[]),ee=k(G),se=k(O),T=k(G);r.useEffect(()=>{T&&T?.job&&X(T.job.includes("director"))},[T]),r.useEffect(()=>{_(c?be:pe)},[c]);const te=g=>{o(g),h(!0)},ae=g=>{_(j=>j.map(H=>H.id===g.id?g:H)),h(!1)},ne=()=>{_(g=>g.filter(j=>!i.includes(j.id))),m([])},re=async g=>{l(!c);const j={job:Number(g)};try{await Y(_e(j))}catch(H){console.error("An error occurred:",H)}},oe=g=>{_(j=>[...j,g])};return e.jsxs("div",{className:p.deletedGroups,children:[e.jsx("div",{className:p.mainContainer_filterPanelBox}),e.jsxs("div",{className:p.mainContainer_buttonPanelBox,children:[e.jsx("div",{className:p.mainContainer_buttonPanelBox_leftCreateButtons,children:S?e.jsx(me,{activeSwitch:c,onChangeSwitch:()=>re(se)}):null}),e.jsxs("div",{className:p.mainContainer_buttonPanelBox_leftCreateButton,children:[c?null:e.jsxs(e.Fragment,{children:[e.jsx(A,{extraClass:p.buttonHelper,children:e.jsx("i",{className:"fas fa-plus"}),onClick:()=>s(!t)}),e.jsx(A,{extraClass:p.buttonHelper,children:e.jsx("i",{className:"fas fa-pencil"}),onClick:()=>d(!a)})]}),!a&&i.length>0&&e.jsx(A,{extraClass:p.buttonHelpers,children:e.jsx("i",{style:{color:"white"},className:"fas fa-trash"}),onClick:ne})]})]}),e.jsx("div",{className:p.mainContainer_tablePanelBox,children:c?e.jsx(fe,{currentTableData:ee,currentPage:x,PageSize:q}):e.jsx(Te,{currentTableData:n,currentPage:x,PageSize:q,editMode:a,onEditClick:te,selectedItems:i,setSelectedItems:m})}),e.jsx(he,{setModal:h,modal:u,vacancy:f,onSave:ae}),e.jsx(Oe,{setActive:s,active:t,onAddVacancy:oe})]})};export{Ue as VacancyWorkPage};
